<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>Terminal - Simputer</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Welcome To My blog!"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/54e0ba1691a5a82162af.js" as="script"><link rel="preload" href="/_nuxt/cbe174ed2a30e037b060.js" as="script"><link rel="preload" href="/_nuxt/07d85a408eaceac3d30c.js" as="script"><link rel="preload" href="/_nuxt/e4387ea9e70d9626af75.css" as="style"><link rel="preload" href="/_nuxt/f51cc84e40c16151e281.js" as="script"><link rel="preload" href="/_nuxt/7bf7cf72fb874597fcc9.js" as="script"><link rel="stylesheet" href="/_nuxt/e4387ea9e70d9626af75.css">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="site-container"><nav><a href="/" class="nuxt-link-active center-item"><div class="logo"></div></a><!----></nav><div class="content-container"><div><article class="main"><header><a href="/terminal/2019/06/08/doing-site-mirroring-with-nginx-on-the-same-domain/">Doing site mirroring with nginx on the same domain</a></header><content><p>Hmm, found a way to do that.</p><p class="t-right"><a href="/terminal/2019/06/08/doing-site-mirroring-with-nginx-on-the-same-domain/">Continue Reading</a></p></content><footer><span><time datetime="Unix time:2019-06-08 22:08" class="published">June 8, 2019</time></span><span><time datetime="Unix time:2019-06-18 17:47" class="modified">June 18, 2019</time></span><span><a href="/terminal/2019/06/08/doing-site-mirroring-with-nginx-on-the-same-domain/#isso-thread">Leave A Comment</a></span></footer></article></div></div><footer class="footer">This site is proudly served by Nuxt.js. Simputer © 2009 - 2019</footer></div></div></div><script>window.__NUXT__=function(s,e,n,a,t,l,o,p,r,c,i,d,h,m,u,f,g,j,b,y,w,v,x,k,_,S,T,I,C,A,N,E,D,M,F,R,P,q,B,O,H,L,$,G,W,U,J,Y,z,V,X,K,Q,Z,ss,es,ns,as,ts,ls,os,ps,rs,cs,is,ds,hs,ms,us,fs,gs,js,bs,ys,ws,vs,xs,ks,_s,Ss,Ts,Is,Cs,As,Ns,Es,Ds,Ms,Fs,Rs,Ps,qs,Bs,Os,Hs,Ls,$s,Gs,Ws,Us,Js,Ys,zs,Vs,Xs,Ks,Qs,Zs,se,ee,ne,ae,te,le,oe,pe,re,ce,ie){return l.attributes={title:"Running email service on my own server!",date:"2018-12-27 13:00",modified:"2019-05-28 13:14",author:e,tags:[G,W,C,vs,I,xs,ks,Zs,se,_s,"spf",Ts,Is,U],status:a,summary:"I've done it! Yes!",category:n,published:s},l.html='<p><strong>Env:</strong> Debian Stretch<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p>\n<p>If u want to follow the procedures below, be sure to replace informations like URL with ur own choice of configuration,</p>\n<h2 id="update-hosts">Update Hosts</h2>\n<p>Verify that the <code>/etc/hosts</code> file contains lines for the server’s public IP address and is associated with the Fully Qualified Domain Name (FQDN). In the examples below, the public IP address of my VPS is <code>12.34.56.78</code> and <code>2aaa:bbb:dddd:eeee::1</code> and the FQDN is <code>mail.snorl.ax</code>.</p>\n<pre><code class="hljs">...\n12.34.56.78 mail.snorl.ax mail\n...\n2aaa:bbb:dddd:eeee::1\n</code></pre>\n<p>Be sure to add an A Record for it. If assigned, AAAA of IPV6 is also needed.</p>\n<pre><code class="hljs">mail.snorl.ax\tA 10 12.34.56.78\nmail.snorl.ax AAAA 10 2aaa:bbb:dddd:eeee::1\n</code></pre>\n<p>Change the hostname to it as well<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>.</p>\n<pre><code class="hljs">$ sudo hostname mail.snorl.ax\n</code></pre>\n<p>Be sure to configure Reverse DNS for the IP to point to <code>mail.snorl.ax</code>.</p>\n<h2 id="software-installation">Software Installation</h2>\n<p>I’m using Debian Stretch on my Linode VPS, so I installed from stretch-backports<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>. For backports to work, a line like the following one should be added to the <code>/etc/apt/sources.list</code>:</p>\n<pre><code class="hljs">deb http://ftp.debian.org/debian stretch-backports main\n</code></pre>\n<p>The address could be my choice of source containing the backports, what I added before installation is:</p>\n<pre><code class="hljs">deb http://mirrors.linode.com/debian stretch-backports main\n</code></pre>\n<p>Then I installed the packages using the command:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo apt -t stretch-backports install postfix-pgsql sasl2-bin libsasl2-modules postgresql libpam-pgsql dovecot-pgsql dovecot-imapd dovecot-pop3d</span>\n</code></pre>\n<h2 id="configuring-postgresql">Configuring PostgreSQL</h2>\n<p>Edit <code>/etc/postgresql/pg_hba.conf</code> to accept password authentication for localhost:</p>\n<pre><code class="hljs">host    all         all         <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>         <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.255</span>   password\n</code></pre>\n<p>Create the database:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo su postgres</span>\n<span class="hljs-meta">$</span><span class="bash"> createdb mails</span>\n<span class="hljs-meta">$</span><span class="bash"> psql mails</span>\n</code></pre>\n<p>Create tables:</p>\n<pre><code class="hljs language-PostgreSQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> transport (\n  <span class="hljs-keyword">domain</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,\n  transport <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,\n  <span class="hljs-keyword">PRIMARY KEY</span> (<span class="hljs-keyword">domain</span>)\n);\n<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (\n  userid <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,\n  <span class="hljs-keyword">password</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>),\n  realname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>),\n  uid <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,\n  gid <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,\n  home <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>),\n  mail <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),\n  <span class="hljs-keyword">PRIMARY KEY</span> (userid)\n);\n<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> virtual (\n  address <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,\n  userid <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,\n  <span class="hljs-keyword">PRIMARY KEY</span> (address)\n);\n<span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> postfix_mailboxes <span class="hljs-keyword">as</span>\n  <span class="hljs-keyword">select</span> userid, home||<span class="hljs-string">\'/\'</span> <span class="hljs-keyword">as</span> mailbox <span class="hljs-keyword">from</span> users\n  <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>\n  <span class="hljs-keyword">select</span> <span class="hljs-keyword">domain</span> <span class="hljs-keyword">as</span> userid, <span class="hljs-string">\'dummy\'</span> <span class="hljs-keyword">as</span> mailbox <span class="hljs-keyword">from</span> transport;\n<span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> postfix_virtual <span class="hljs-keyword">as</span>\n  <span class="hljs-keyword">select</span> userid, userid <span class="hljs-keyword">as</span> address <span class="hljs-keyword">from</span> users\n  <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>\n  <span class="hljs-keyword">select</span> userid, address <span class="hljs-keyword">from</span> virtual;\n</code></pre>\n<p>Create separate users for read and write accesses. Postfix and Dovecot needs only read access. I may want to use the writer user for your own purposes.</p>\n<pre><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> mailreader <span class="hljs-keyword">PASSWORD</span> <span class="hljs-string">\'secret\'</span>;\n<span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> transport, <span class="hljs-keyword">users</span>, <span class="hljs-keyword">virtual</span>, postfix_mailboxes, postfix_virtual <span class="hljs-keyword">to</span> mailreader;\n<span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> mailwriter <span class="hljs-keyword">password</span> <span class="hljs-string">\'secret\'</span>;\n<span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span>, <span class="hljs-keyword">insert</span>, <span class="hljs-keyword">update</span>, <span class="hljs-keyword">delete</span> <span class="hljs-keyword">on</span> transport, <span class="hljs-keyword">users</span>, <span class="hljs-keyword">virtual</span>, postfix_mailboxes, postfix_virtual <span class="hljs-keyword">to</span> mailwriter;\n</code></pre>\n<p>Add domain, user to the database. The examples below add the domain <code>snorl.ax</code> and a user with the mail address <code>kim@snorl.ax</code>:</p>\n<pre><code class="hljs language-sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> transport (<span class="hljs-keyword">domain</span>, transport) <span class="hljs-keyword">values</span> (<span class="hljs-string">\'snorl.ax\'</span>, <span class="hljs-string">\'virtual:\'</span>);\n<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span> (userid, uid, gid, home) <span class="hljs-keyword">values</span> (<span class="hljs-string">\'user@snorl.ax\'</span>, <span class="hljs-number">5000</span>, <span class="hljs-number">5000</span>, <span class="hljs-string">\'snorl.ax/mails/user\'</span>);\n<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span> (userid, uid, gid, home) <span class="hljs-keyword">values</span> (<span class="hljs-string">\'user2@snorl.ax\'</span>, <span class="hljs-number">5000</span>, <span class="hljs-number">5000</span>, <span class="hljs-string">\'snorl.ax/mails/user2\'</span>);\n<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">virtual</span> (address, userid) <span class="hljs-keyword">values</span> (<span class="hljs-string">\'kim@snorl.ax\'</span>, <span class="hljs-string">\'user@snorl.ax\'</span>);\n</code></pre>\n<p>The password for a user can be generated using <code>doveadm</code> utility<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> doveadm pw -s CRYPT</span>\n</code></pre>\n<p>It will prompt me to enter the password twice:</p>\n<pre><code class="hljs">Enter <span class="hljs-keyword">new</span> <span class="hljs-string">password:</span>\nRetype <span class="hljs-keyword">new</span> <span class="hljs-string">password:</span>\n</code></pre>\n<p>Then it will print a encrypted string like the one below for me to write into the database:</p>\n<pre><code class="hljs">{CRYPT}<span class="hljs-number">1</span>cElWVzS3.EVg\n</code></pre>\n<p>To do something with the password, access the <code>psql</code> utility again:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo su postgres</span>\n<span class="hljs-meta">$</span><span class="bash"> psql mails</span>\n</code></pre>\n<p>To update an existing user with the password:</p>\n<pre><code class="hljs language-sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">password</span>=<span class="hljs-string">\'{CRYPT}1cElWVzS3.EVg\'</span> <span class="hljs-keyword">WHERE</span> userid=<span class="hljs-string">\'user@snorl.ax\'</span>;\n</code></pre>\n<p>To set the password when creating the user:</p>\n<pre><code class="hljs language-sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span> (userid, <span class="hljs-keyword">password</span>, uid, gid, home) <span class="hljs-keyword">values</span> (<span class="hljs-string">\'user3@snorl.ax\'</span>, <span class="hljs-string">\'{CRYPT}1cElWVzS3.EVg\'</span>, <span class="hljs-number">5000</span>, <span class="hljs-number">5000</span>, <span class="hljs-string">\'snorl.ax/mails/user3\'</span>);\n</code></pre>\n<p>Self-check.</p>\n<p>To check the existing user:</p>\n<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>;\n</code></pre>\n<p>A table like this will be shown:</p>\n<pre><code class="hljs">     userid     |<span class="hljs-string">       password       </span>|<span class="hljs-string"> realname </span>|<span class="hljs-string"> uid  </span>|<span class="hljs-string"> gid  </span>|<span class="hljs-string">         home         </span>|<span class="hljs-string"> mail\n----------------+----------------------+----------+------+------+----------------------+------\n user1@snorl.ax </span>|<span class="hljs-string"> {CRYPT}xxxxxxxxxxxxx </span>|<span class="hljs-string">          </span>|<span class="hljs-string"> 5000 </span>|<span class="hljs-string"> 5000 </span>|<span class="hljs-string"> snorl.ax/mails/user1 </span>|\n user<span class="hljs-meta">@snorl.ax</span>  |<span class="hljs-string"> {CRYPT}xxxxxxxxxxxxx </span>|<span class="hljs-string">          </span>|<span class="hljs-string"> 5000 </span>|<span class="hljs-string"> 5000 </span>|<span class="hljs-string"> snorl.ax/mails/user  </span>|\n</code></pre>\n<p>To check the correspondence between username and mail address:</p>\n<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">virtual</span>;\n</code></pre>\n<p>A table similar to the following one will be shown:</p>\n<pre><code class="hljs">    address     |     userid     \n----------------+----------------\n kim@snorl.ax   | user@snorl.ax\n xxx@snorl.ax   | user2@snorl.ax\n xxxx@snorl.ax  | user1@snorl.ax\n</code></pre>\n<h2 id="create-the-folder-and-user-for-mail">Create the folder and user for mail</h2>\n<p>Create <code>/var/mail/vhosts/</code> and the folder named my domain:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo mkdir -p /var/mail/vhosts/snorl.ax</span>\n</code></pre>\n<p>Create the group and the user for it:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo groupadd -g 5000 vmail</span>\n<span class="hljs-meta">$</span><span class="bash"> sudo useradd -g vmail -u 5000 vmail -d /var/mail</span>\n</code></pre>\n<p>Change the owner of the <code>/var/mail/</code> folder and its contents to belong to <code>vmail</code>:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo chown -R vmail:vmail /var/mail</span>\n</code></pre>\n<h2 id="configuring-postfix">Configuring Postfix</h2>\n<p>Edit <code>/etc/postfix/main.cf</code> to set the following values<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup>:</p>\n<pre><code class="hljs"><span class="hljs-attr">transport_maps</span> = pgsql:/etc/postfix/transport.cf\n<span class="hljs-attr">virtual_uid_maps</span> = pgsql:/etc/postfix/uids.cf\n<span class="hljs-attr">virtual_gid_maps</span> = pgsql:/etc/postfix/gids.cf\n<span class="hljs-attr">virtual_mailbox_base</span> = /var/mail/vhosts\n<span class="hljs-attr">virtual_mailbox_maps</span> = pgsql:/etc/postfix/mailboxes.cf\n<span class="hljs-attr">virtual_maps</span> = pgsql:/etc/postfix/virtual.cf\n\n<span class="hljs-attr">mydestination</span> = localhost.<span class="hljs-variable">$mydomain</span>, <span class="hljs-variable">$myhostname</span>\n<span class="hljs-attr">smtpd_relay_restrictions</span> = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination\n<span class="hljs-attr">local_transport</span> = virtual\n<span class="hljs-attr">local_recipient_maps</span> = <span class="hljs-variable">$virtual_mailbox_maps</span>\n<span class="hljs-attr">smtpd_sasl_auth_enable</span> = <span class="hljs-literal">yes</span>\n<span class="hljs-attr">smtpd_sasl_security_options</span> = noanonymous\n<span class="hljs-attr">smtpd_sasl_local_domain</span> = mail.snorl.ax\n<span class="hljs-attr">smtp_sasl_auth_enable</span> = <span class="hljs-literal">no</span>\n<span class="hljs-attr">myorigin</span> = <span class="hljs-variable">$mydomain</span>\n</code></pre>\n<p>These defines mailbox domains and relevant settings such as sasl, mailbox location, rejecting unknown local recipients<sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup>.</p>\n<p>Edit <code>/etc/postfix/sasl/smtpd.conf</code> to include the following lines:</p>\n<pre><code class="hljs">pwcheck_method: saslauthd\nsaslauthd_path: /etc/mux\n</code></pre>\n<p><code>/etc/postfix/transport.cf</code></p>\n<pre><code class="hljs">user=mailreader\npassword=secret\ndbname=mails\ntable=transport\nselect_field=transport\nwhere_field=domain\nhosts=localhost\n</code></pre>\n<p><code>/etc/postfix/uids.cf</code></p>\n<pre><code class="hljs">user=mailreader\npassword=secret\ndbname=mails\ntable=users\nselect_field=uid\nwhere_field=userid\nhosts=localhost\n</code></pre>\n<p><code>/etc/postfix/gids.cf</code></p>\n<pre><code class="hljs">user=mailreader\npassword=secret\ndbname=mails\ntable=users\nselect_field=gid\nwhere_field=userid\nhosts=localhost\n</code></pre>\n<p><code>/etc/postfix/mailboxes.cf</code></p>\n<pre><code class="hljs">user=mailreader\npassword=secret\ndbname=mails\ntable=postfix_mailboxes\nselect_field=mailbox\nwhere_field=userid\nhosts=localhost\n</code></pre>\n<p><code>/etc/postfix/virtual.cf</code></p>\n<pre><code class="hljs">user=mailreader\npassword=secret\ndbname=mails\ntable=postfix_virtual\nselect_field=userid\nwhere_field=address\nhosts=localhost\n</code></pre>\n<p>By default, these two lines are included in <code>/etc/postfix/main.cf</code>:</p>\n<pre><code class="hljs">alias_maps = hash:/etc/aliases\nalias_database = hash:/etc/aliases\n</code></pre>\n<p>It’s for the local delivery, meant to be sent to the users on the computer. Since I have the virtual domain and mailboxes, it will be more convenient to forward it to the mailbox. Put the lines in <code>/etc/aliases</code>:</p>\n<pre><code class="hljs"># user:\tthe mail address\nkim:\tkim@snorl.ax\nroot:\troot@snorl.ax\n</code></pre>\n<p>Then update:</p>\n<pre><code class="hljs">$ sudo newaliases\n</code></pre>\n<p>In this case, local delivery will work. System messages to <code>kim </code> will be delivered to <code>kim@snorl.ax</code>.</p>\n<h2 id="configuring-sasl2">Configuring SASL2</h2>\n<p>Edit <code>/etc/default/saslauthd</code>:</p>\n<pre><code class="hljs">START=yes\nMECHANISMS=pam\nPARAMS=&quot;-r -m /var/spool/postfix/etc&quot;\n</code></pre>\n<p><code>/etc/pam_pgsql.conf</code></p>\n<pre><code class="hljs">database = mails\nhost = localhost\nuser = mailreader\npassword = secret\ntable = users\nuser_column = userid\npwd_column = password\n#expired_column = acc_expired\n#newtok_column = acc_new_pwreq\npw_type = crypt\n#debug\n</code></pre>\n<p>Create <code>/etc/pam.d/smtp</code>:</p>\n<pre><code class="hljs">auth        required    pam_pgsql.so\naccount     required    pam_pgsql.so\npassword    required    pam_pgsql.so\n</code></pre>\n<p>Put the following line to <code>/etc/postfix/sasl/smtpd.conf</code>:</p>\n<pre><code class="hljs">mech_list: login plain\n</code></pre>\n<h2 id="configuring-dovecot">Configuring Dovecot</h2>\n<p>Put the following lines in the <code>/etc/dovecot/dovecot.conf</code>:</p>\n<pre><code class="hljs">mail_location = maildir:~/\npassdb {\n  args = /usr/local/etc/dovecot-sql.conf\n  driver = sql\n}\nuserdb {\n  args = /usr/local/etc/dovecot-sql.conf\n  driver = sql\n}\nmail_privileged_group = vmail\n</code></pre>\n<p><code>/usr/local/etc/dovecot-sql.conf</code>:</p>\n<pre><code class="hljs">driver = pgsql\nconnect = host=localhost dbname=mails user=mailreader password=secret\ndefault_pass_scheme = CRYPT\npassword_query = SELECT userid as user, password FROM users WHERE userid = \'%u\'\nuser_query = SELECT \'/var/mail/vhosts/\'||home AS home, uid, gid FROM users WHERE userid = \'%u\'\n</code></pre>\n<p>Ensure the following line is included in <code>/etc/dovecot/conf.d/10-auth.conf</code><sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup>:</p>\n<pre><code class="hljs">disable_plaintext_auth = no\n</code></pre>\n<p>I’ll switch this back to <code>yes</code> or other options afterward. Plain text is for test.</p>\n<h2 id="configure-dns">Configure DNS</h2>\n<p>When I’m ready to send and receive mails from my server, I should edit the domain’s MX record so it points to the IP address of the server, similar to the examples below:</p>\n<pre><code class="hljs">mail.snorl.ax A 10 12.34.56.78\nmail.snorl.ax AAAA 10 2aaa:bbb:dddd:eeee::1\nsnorl.ax MX 10 mail.snorl.ax\n</code></pre>\n<h2 id="testing-imap">Testing Imap</h2>\n<p>Restart the relevant services before testing:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo systemctl restart saslauthd postgresql postfix dovecot</span>\n</code></pre>\n<p>Install the Mailutils package:</p>\n<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo apt-get install mailutils</span>\n</code></pre>\n<p>Log into an email account like gmail to send an email to <code>kim@snorl.ax</code>, then check if there’s any message:</p>\n<pre><code class="hljs language-console">sudo mail -f /var/mail/vhosts/snorl.ax/mails/user\n</code></pre>\n<p>Now test imap using an Email Client like ThunderBird:</p>\n<ul>\n<li><strong>Username:</strong> <code>user@snorl.ax</code>, the login name of <code>kim@snorl.ax</code>.</li>\n<li><strong>Password:</strong>  The one I just set, not the encrypted string. The one before being encrypted.</li>\n<li><strong>Server name:</strong> <code>mail.snorl.ax</code>, or the IP address of the server.</li>\n<li><strong>SSL:</strong> <code>None</code></li>\n<li><strong>Port:</strong> 143</li>\n</ul>\n<h2 id="smtp-method-1-smtp-relay">SMTP Method 1: SMTP Relay</h2>\n<p>An email sent from a server IP can easily go to Spam Folder if the IP reputation is bad or something is not configured correctly on the server, so it is safe to use an email delivery service.<br>\nI’ve used Amazon SES and Sendgrid. Both of them perform perfectly. Amazon SES charges $0.10 for every 1,000 emails you send. Sendgrid charges at least $14.95 monthly if u exceed 100 mails/day.<br>\nHowever u’ll need request for a sending quota increase to get started with Amazon SES, while u can start with it as soon as u register on Sendgrid.<br>\nThe documentations below r quite useful if u r using either of the email delivery services. They clarify how to configure the service and integrate it with Postfix and email client.</p>\n<p>Some documentations useful for using <strong>Sendgrid</strong>:</p>\n<ul>\n<li><a href="https://sendgrid.com/docs/ui/account-and-settings/how-to-set-up-domain-authentication/" target="_blank">How to set up domain authentication</a></li>\n<li><a href="https://sendgrid.com/docs/API_Reference/SMTP_API/integrating_with_the_smtp_api.html" target="_blank">Integrating With the SMTP API</a></li>\n<li><a href="https://sendgrid.com/docs/for-developers/sending-email/postfix/" target="_blank">Integrate SendGrid with Postfix</a></li>\n</ul>\n<p>Some documentations useful for using <strong>Amazon SES</strong>:</p>\n<ul>\n<li><a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/quick-start.html" target="_blank">Amazon SES Quick Start</a></li>\n<li><a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/postfix.html" target="_blank">Integrating Amazon SES with Postfix</a></li>\n<li><a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/configure-email-client.html" target="\n_blank">Configuring Email Clients to Send Through Amazon SES</a></li>\n<li><a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/mail-from.html" target="_blank">Using a Custom MAIL FROM Domain with Amazon SES</a></li>\n</ul>\n<h2 id="smtp-method-2-postfix-sasl">SMTP Method 2: Postfix SASL</h2>\n<p>It is generally better to use my own server to send mails if I wanna have my own business and the IP reputation starts at least neutral.</p>\n<p>To find out what SASL implementations are compiled into Postfix<sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup>, use the following commands:</p>\n<pre><code class="hljs">$ postconf -a (SASL support in the SMTP server)\n$ postconf -A (SASL support in the SMTP+LMTP client)\n</code></pre>\n<h3 id="configure-ssl">Configure SSL</h3>\n<p>Generate a certificate for the domain (I use certbot) and configure postfix and dovecot to use it.</p>\n<p>My ceritficate location:<br>\nCert: <code>/etc/letsencrypt/live/snorl.ax/fullchain.pem</code><br>\nKey: <code>/etc/letsencrypt/live/snorl.ax/privkey.pem</code></p>\n<p>Set the values in <code>/etc/postfix/main.cf</code>:</p>\n<pre><code class="hljs">smtpd_tls_cert_file=/etc/letsencrypt/live/snorl.ax/fullchain.pem\nsmtpd_tls_key_file=/etc/letsencrypt/live/snorl.ax/privkey.pem\n</code></pre>\n<p>Add the block into <code>/etc/dovecot/conf.d/10-ssl.conf</code><sup class="footnote-ref"><a href="#fn10" id="fnref10">[10]</a></sup>:</p>\n<pre><code class="hljs">local_name mail.snorl.ax {\n  ssl_cert = &lt;<span class="hljs-regexp">/etc/letsencrypt</span><span class="hljs-regexp">/live/snorl</span>.ax/fullchain.pem\n  ssl_key = &lt;<span class="hljs-regexp">/etc/letsencrypt</span><span class="hljs-regexp">/live/snorl</span>.ax/privkey.pem\n}\n</code></pre>\n<p>Restart them to see the effect:</p>\n<pre><code class="hljs">$ sudo systemctl restart dovecot postfix\n</code></pre>\n<h3 id="postfix-to-dovecot-sasl-communication">Postfix to Dovecot SASL communication</h3>\n<p>It saves hassle to configure Postfix to Dovecot SASL communication.</p>\n<p>Relevant block in <code>/etc/dovecot/conf.d/10-master.conf</code> (to place the Dovecot SASL socket in the path and make it writable and readable by user and group <code>postfix</code> only):</p>\n<pre><code class="hljs">service auth {\n  ...\n  unix_listener /var/spool/postfix/private/auth {\n    mode = 0660\n    # Assuming the default Postfix user and group\n    user = postfix\n    group = postfix        \n  }\n  ...\n}\n</code></pre>\n<p>Specify the following value in <code>/etc/dovecot/conf.d/10-auth.conf</code>:</p>\n<pre><code class="hljs">auth_mechanisms = plain login\n</code></pre>\n<h3 id="enabling-sasl-authentication-in-the-postfix-smtp-server">Enabling SASL authentication in the Postfix SMTP server</h3>\n<p>Specify the following value in <code>/etc/postfix/main.cf</code>:</p>\n<pre><code class="hljs">smtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_sasl_auth_enable = yes\nbroken_sasl_auth_clients = yes\n</code></pre>\n<h3 id="postfix-smtp-server-policy-sasl-mechanism-properties">Postfix SMTP Server policy - SASL mechanism properties</h3>\n<p>Set the desired values in <code>/etc/postfix/main.cf</code>.</p>\n<p>Deny anonymous authentication:</p>\n<pre><code class="hljs">smtpd_sasl_security_options = noanonymous\nsmtpd_sasl_tls_security_options = $smtpd_sasl_security_options\n</code></pre>\n<p>A more sophisticated policy allows plaintext mechanisms, but only over a TLS-encrypted connection:</p>\n<pre><code class="hljs">smtpd_sasl_security_options = noanonymous, noplaintext\nsmtpd_sasl_tls_security_options = noanonymous\n</code></pre>\n<p>To offer SASL authentication only after a TLS-encrypted session has been established specify this:</p>\n<pre><code class="hljs">smtpd_tls_auth_only = yes\n</code></pre>\n<h3 id="mail-relay-authorization">Mail relay authorization</h3>\n<p>Set the desired values in <code>/etc/postfix/main.cf</code>. With <code>permit_sasl_authenticated</code> the Postfix SMTP server can allow SASL-authenticated SMTP clients to send mail to remote destinations. Examples:</p>\n<pre>\n<code class=hljs>smtpd_relay_restrictions =\n    permit_mynetworks\n    <b>permit_sasl_authenticated</b>\n    reject_unauth_destination\n    ...other rules...\n</code>\n</pre>\n<h3 id="envelope-sender-address-authorization">Envelope sender address authorization</h3>\n<p>In <code>/etc/postfix/main.cf</code>, configure <code>smtpd_sender_login_maps</code> and add <code>reject_sender_login_mismatch</code> before <code>permit_sasl_authenticated</code> in <code>smtpd_recipient_restrictions</code>:</p>\n<pre>\n<code class=\'hljs\'><b>smtpd_sender_login_maps = hash:/etc/postfix/controlled_envelope_senders</b>\n\tsmtpd_relay_restrictions =\n    ...\n    <b>reject_sender_login_mismatch</b>\n    permit_sasl_authenticated\n    ...</code></pre>\n<p>The table in <code>/etc/postfix/controlled_envelope_senders</code> should be configured like this:</p>\n<pre><code class="hljs"># envelope sender           owners (SASL login names)\nkim@snorl.ax                user@snorl.ax\nsom@snorl.ax                user1@snorl.ax\n</code></pre>\n<p>On the left is the email address, on the right is the login name.</p>\n<p>Generate the database:</p>\n<pre><code class="hljs">$ sudo postmap /etc/postfix/controlled_envelope_senders\n</code></pre>\n<p>Now, the Postfix SMTP server knows who the sender is. Given a table of envelope sender addresses and SASL login names, the Postfix SMTP server can decide if the SASL authenticated client is allowed to use a particular envelope sender address.</p>\n<h3 id="testing-sasl-authentication-in-the-postfix-smtp-server">Testing SASL authentication in the Postfix SMTP Server</h3>\n<p>To test the server side, connect (for example, with <code>telnet</code>) to the Postfix SMTP server port and you should be able to have a conversation as shown below. Information sent by the client is shown in <code>bold</code> font.</p>\n<pre>\n<code class=\'hljs\'>$ <b>telnet server.example.com 25</b>\n...\n220 server.example.com ESMTP Postfix\n<b>EHLO client.example.com</b>\n250-server.example.com\n250-PIPELINING\n250-SIZE 10240000\n250-ETRN\n250-AUTH DIGEST-MD5 PLAIN CRAM-MD5\n250 8BITMIME\nAUTH PLAIN AHRlc3QAdGVzdHBhc3M=\n235 Authentication successful</code>\n</pre>\n<p>To test this over a connection that is encrypted with TLS, use openssl s_client instead of telnet:</p>\n<pre>\n<code class=\'hljs\'>$ <b>openssl s_client -connect server.example.com:25 -starttls smtp</b>\n...\n220 server.example.com ESMTP Postfix\n<b>EHLO client.example.com</b>\n...see above example for more...</code>\n</pre>\n<p>Use a recent version of <code>bash</code> shell and replace the <code>AHRlc3QAdGVzdHBhc3M=</code> above with the output of this command:</p>\n<pre><code class="hljs">echo -ne \'\\000username\\000password\' | openssl base64\n</code></pre>\n<h3 id="enabling-sasl-authentication-in-the-postfix-smtplmtp-client">Enabling SASL authentication in the Postfix SMTP/LMTP client</h3>\n<p>Set the values in <code>/etc/postfix/main.cf</code>:</p>\n<pre><code class="hljs">smtp_sasl_auth_enable = yes\nsmtp_tls_security_level = encrypt\nsmtp_sasl_password_maps = pgsql:/etc/postfix/password.cf\n</code></pre>\n<p>In <code>/etc/postfix/password.cf</code>:</p>\n<pre><code class="hljs">user=mailreader\npassword=secret\ndbname=mails\ntable=users\nselect_field=password\nwhere_field=userid\nhosts=localhost\n</code></pre>\n<p>Restart postfix to see the effect:</p>\n<pre><code class="hljs">$ sudo systemctl restart postfix\n</code></pre>\n<h3 id="open-the-submission-port">Open the submission port</h3>\n<p>The submission port is recommended to be used for smtp.</p>\n<p>Uncomment the following line in <code>/etc/postfix/master.cf</code>:</p>\n<pre><code class="hljs">submission inet n       -       y       -       -       smtpd\n</code></pre>\n<p>Restart postfix to see the effect:</p>\n<pre><code class="hljs">$ sudo systemctl restart postfix\n</code></pre>\n<h3 id="configure-spf-and-dkim">Configure SPF and DKIM</h3>\n<p>Install DKIM, SPF and Postfix-pcre<sup class="footnote-ref"><a href="#fn11" id="fnref11">[11]</a></sup>,</p>\n<pre><code class="hljs">$ sudo apt-get install opendkim opendkim-tools postfix-policyd-spf-python postfix-pcre\n</code></pre>\n<h4 id="spf">SPF</h4>\n<p>Add spf as a TXT Record to DNS:</p>\n<pre><code class="hljs">snorl.ax TXT &quot;v=spf1 mx -all&quot;\n</code></pre>\n<p>Add the following entry to <code>/etc/postfix/master.cf</code>:</p>\n<pre><code class="hljs">policyd-spf  unix  -       n       n       -       0       spawn\n    user=policyd-spf argv=/usr/bin/policyd-spf\n</code></pre>\n<p>Configure the following value in <code>/etc/postfix/main.cf</code>:</p>\n<pre><code class="hljs">policyd-spf_time_limit = 3600\n</code></pre>\n<p>In <code>/etc/postfix/main.cf</code>, edit the <code>smtpd_relay_restrictions</code> entry to add a <code>check_policy_service</code> entry:</p>\n<pre><code class="hljs">smtpd_relay_restrictions =\n    ...\n    reject_unauth_destination,\n    check_policy_service unix:private/policyd-spf,\n    ...\n</code></pre>\n<p>Make sure to add the <code>check_policy_service</code> entry after the <code>reject_unauth_destination</code> entry to avoid having your system become an open relay. If <code>reject_unauth_destination</code> is the last item in your restrictions list, add the comma after it and omit the comma at the end of the <code>check_policy_service</code> item above.</p>\n<p>Restart Postfix.</p>\n<pre><code class="hljs">$ sudo systemctl restart postfix\n</code></pre>\n<p>Check the operation of the policy agent by looking at raw headers on incoming email messages for the SPF results header. The header the policy agent adds to messages should look something like this:</p>\n<pre><code class="hljs language-txt">Received-SPF: Pass (sender SPF authorized) identity=mailfrom; client-ip=127.0.0.1; helo=mail.snorl.ax; envelope-from=text@snorl.ax; receiver=tknarr@silverglass.org\n</code></pre>\n<h4 id="dkim">DKIM</h4>\n<p>Edit <code>/etc/opendkim.conf</code> and uncomment or edit certain lines:</p>\n<pre><code class="hljs"># This is a basic configuration that can easily be adapted to suit a standard\n# installation. For more advanced options, see opendkim.conf(5) and/or\n# /usr/share/doc/opendkim/examples/opendkim.conf.sample.\n\n# Log to syslog\nSyslog          yes\n# Required to use local socket with MTAs that access the socket as a non-\n# privileged user (e.g. Postfix)\nUMask           002\n# OpenDKIM user\n# Remember to add user postfix to group opendkim\nUserID          opendkim\n\n# Map domains in From addresses to keys used to sign messages\nKeyTable        /etc/opendkim/key.table\nSigningTable        refile:/etc/opendkim/signing.table\n\n# Hosts to ignore when verifying signatures\nExternalIgnoreList  /etc/opendkim/trusted.hosts\nInternalHosts       /etc/opendkim/trusted.hosts\n\n# Commonly-used options; the commented-out versions show the defaults.\nCanonicalization    relaxed/simple\nMode            sv\nSubDomains      no\n#ADSPAction     continue\nAutoRestart     yes\nAutoRestartRate     10/1M\nBackground      yes\nDNSTimeout      5\nSignatureAlgorithm  rsa-sha256\n\n# Always oversign From (sign using actual From and a null From to prevent\n# malicious signatures header fields (From and/or others) between the signer\n# and the verifier.  From is oversigned by default in the Debian package\n# because it is often the identity key used by reputation systems and thus\n# somewhat security sensitive.\nOversignHeaders     From\n\n\n# Socket smtp://localhost\n#\n# ##  Socket socketspec\n# ##\n# ##  Names the socket where this filter should listen for milter connections\n# ##  from the MTA.  Required.  Should be in one of these forms:\n# ##\n# ##  inet:port@address           to listen on a specific interface\n# ##  inet:port                   to listen on all interfaces\n# ##  local:/path/to/socket       to listen on a UNIX domain socket\n#\nSocket                  local:/var/spool/postfix/opendkim/opendkim.sock\n\n##  PidFile filename\n###      default (none)\n###\n###  Name of the file where the filter should write its pid before beginning\n###  normal operations.\n#\nPidFile               /var/run/opendkim/opendkim.pid\n</code></pre>\n<p>Ensure the permission is correctly set:</p>\n<pre><code class="hljs">$ sudo chmod u=rw,go=r /etc/opendkim.conf\n</code></pre>\n<p>Create directory for the socket:</p>\n<pre><code class="hljs">$ sudo mkdir /var/spool/postfix/opendkim\n$ chown opendkim:postfix /var/spool/postfix/opendkim\n</code></pre>\n<p>Create directory for OpenDKIM’s data files:</p>\n<pre><code class="hljs">$ sudo mkdir -p /etc/opendkim/keys\n$ sudo chown -R opendkim:opendkim /etc/opendkim\n$ sudo chmod go-rw /etc/opendkim/keys\n</code></pre>\n<p>Create <code>/etc/opendkim/signing.table</code></p>\n<pre><code class="hljs">*@snorl.ax   sim\n</code></pre>\n<p>Create <code>/etc/opendkim/key.table</code></p>\n<pre><code class="hljs">sim     snorl.ax:YYYYMM:/etc/opendkim/keys/example.private\n</code></pre>\n<p>replace the <code>YYYYMM</code> with the current 4-digit year and 2-digit month (this is referred to as the selector)</p>\n<p>Create <code>/etc/opendkim/trusted.hosts</code></p>\n<pre><code class="hljs">127.0.0.1\n::1\nlocalhost\nsim\nsim.snorl.ax\nsnorl.ax\n</code></pre>\n<p>Set the permission:</p>\n<pre><code class="hljs">$ sudo chown -R opendkim:opendkim /etc/opendkim\n$ sudo chmod -R go-rwx /etc/opendkim/keys\n</code></pre>\n<p>Generate the key:</p>\n<pre><code class="hljs">$ sudo opendkim-genkey -b 2048 -h rsa-sha256 -r -s YYYYMM -d example.com -v\n</code></pre>\n<p>Move it to the set path:</p>\n<pre><code class="hljs">$ sudo mv YYYYMM.private /etc/opendkim/keys/example.private\n$ sudo mv YYYYMM.txt /etc/opendkim/keys/example.txt\n</code></pre>\n<p>Make sure all the files in the dir have correct permissions:</p>\n<pre><code class="hljs">$ cd /etc\n$ sudo chown -R opendkim:opendkim /etc/opendkim\n$ sudo chmod -R go-rw /etc/opendkim/keys\n</code></pre>\n<p>Restart to see if there’s any error:</p>\n<pre><code class="hljs">$ sudo systemctl restart opendkim\n</code></pre>\n<p>Check it if there’s any error:</p>\n<pre><code class="hljs">$ sudo systemctl status -l opendkim\n</code></pre>\n<p>For example, in <code>/etc/opendkim/keys/example.txt</code>:</p>\n<pre><code class="hljs">201510._domainkey  IN  TXT ( &quot;**v=DKIM1; h=rsa-sha256; k=rsa; s=email; &quot;\n    &quot;p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAu5oIUrFDWZK7F4thFxpZa2or6jBEX3cSL6b2TJdPkO5iNn9vHNXhNX31nOefN8FksX94YbLJ8NHcFPbaZTW8R2HthYxRaCyqodxlLHibg8aHdfa+bxKeiI/xABRuAM0WG0JEDSyakMFqIO40ghj/h7DUc/4OXNdeQhrKDTlgf2bd+FjpJ3bNAFcMYa3Oeju33b2Tp+PdtqIwXR&quot;\n    &quot;ZksfuXh7m30kuyavp3Uaso145DRBaJZA55lNxmHWMgMjO+YjNeuR6j4oQqyGwzPaVcSdOG8Js2mXt+J3Hr+nNmJGxZUUW4Uw5ws08wT9opRgSpn+ThX2d1AgQePpGrWOamC3PdcwIDAQAB**&quot; )  ; ----- DKIM key 201510 for example.com\n</code></pre>\n<p>The value inside the parentheses is needed. Select and copy the entire region from (but not including) the double-quote before v=DKIM1 on up to (but not including) the final double-quote before the closing parentheses. Then edit out the double-quotes within the copied text and the whitespace between them. Also change h=rsa-sha256 to h=sha256. From the above file the result would be:</p>\n<pre><code class="hljs">v=DKIM1; h=sha256; k=rsa; s=email; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAu5oIUrFDWZK7F4thFxpZa2or6jBEX3cSL6b2TJdPkO5iNn9vHNXhNX31nOefN8FksX94YbLJ8NHcFPbaZTW8R2HthYxRaCyqodxlLHibg8aHdfa+bxKeiI/xABRuAM0WG0JEDSyakMFqIO40ghj/h7DUc/4OXNdeQhrKDTlgf2bd+FjpJ3bNAFcMYa3Oeju33b2Tp+PdtqIwXRZksfuXh7m30kuyavp3Uaso145DRBaJZA55lNxmHWMgMjO+YjNeuR6j4oQqyGwzPaVcSdOG8Js2mXt+J3Hr+nNmJGxZUUW4Uw5ws08wT9opRgSpn+ThX2d1AgQePpGrWOamC3PdcwIDAQAB\n</code></pre>\n<p>Paste that into the value for the TXT record in DNS:</p>\n<pre><code class="hljs">201510._domainkey.snorl.ax\t TXT  The_Value\n</code></pre>\n<p>Test the key:</p>\n<pre><code class="hljs">$ opendkim-testkey -d snorl.ax -s YYYYMM\n</code></pre>\n<p>To hook it into the postfix, edit <code>/etc/postfix/main.cf</code>:</p>\n<pre><code class="hljs"># OpenDKIM\nmilter_default_action = accept\n# Postfix ≥ 2.6 milter_protocol = 6, Postfix ≤ 2.5 milter_protocol = 2\nmilter_protocol = 6\nsmtpd_milters = local:opendkim/opendkim.sock\nnon_smtpd_milters = $smtpd_milters\n</code></pre>\n<p>Add user postfix to group opendkim:</p>\n<pre><code class="hljs">$ sudo usermod -a -G opendkim postfix\n</code></pre>\n<p>Restart them.</p>\n<pre><code class="hljs">$ sudo systemctl restart opendkim postfix\n</code></pre>\n<p>Verify if everything’s working by sending a test e-mail to <code>check-auth@verifier.port25.com</code> using an email client configured to submit mail to the submission port on the mail server.</p>\n<h3 id="set-up-domain-message-authentication-reporting-conformance-dmarc">Set up Domain Message Authentication, Reporting &amp; Conformance (DMARC)</h3>\n<p>Add the following TXT record in DNS:</p>\n<pre><code class="hljs">_dmarc.snorl.ax\tTXT\tv=DMARC1;p=quarantine;sp=quarantine;adkim=r;aspf=r;fo=1;rf=afrf;rua=mailto:admin@snorl.ax\n</code></pre>\n<p>This requests mail servers to quarantine (do not discard, but separate from regular messages) any email that fails either SPF or DKIM checks. The report will be <code>admin@snorl.ax</code>.</p>\n<h3 id="optional-set-up-author-domain-signing-practices-adsp">Optional: Set up Author Domain Signing Practices (ADSP)</h3>\n<p>Add an ADSP policy to the domain saying that all emails from the domain should be DKIM-signed:</p>\n<pre><code class="hljs">_adsp._domainkey.snorl.ax\tTXT\tdkim=all\n</code></pre>\n<h3 id="key-rotation">Key Rotation</h3>\n<p>The reason the YYYYMM format is used for the selector is that best practice calls for changing the DKIM signing keys every so often (monthly is recommended, and no longer than every 6 months).</p>\n<p>Generate it in my home dir:</p>\n<pre><code class="hljs">$ opendkim-genkey -b 2048 -h rsa-sha256 -r -s YYYYMM -d snorl.ax -v\n</code></pre>\n<p>Set the DNS the way it is done above, test it:</p>\n<pre><code class="hljs">$ opendkim-testkey -d example.com -s YYYYMM -k example.private\n</code></pre>\n<p>Stop opendkim for a moment:</p>\n<pre><code class="hljs">$ sudo systemctl stop opendkim\n</code></pre>\n<p>Copy it to the path:</p>\n<pre><code class="hljs">cp *.private /etc/opendkim/keys/\nchown opendkim:opendkim /etc/opendkim/keys/*\nchmod go-rw /etc/opendkim/keys/*\n</code></pre>\n<p>Edit <code>/etc/opendkim/key.table</code> and change the old YYYYMM values to the new selector, reflecting the current year and month. Save the file. Then restart postfix and opendkim to see the effect. Be sure to delete the old <code>YYYYMM._domainkey</code> TXT record.</p>\n<h2 id="improve-the-password-encryption">Improve The Password Encryption</h2>\n<p><code>CRYPT</code> is weak, only uses the first 8 characters of the password, the rest are ignored.<br>\n<code>CRAM-MD5</code> protects the password in transit against eaves droppers and somewhat gets good support in clients.<br>\nSo it’s the default method doveadm uses<sup class="footnote-ref"><a href="#fn12" id="fnref12">[12]</a></sup><sup class="footnote-ref"><a href="#fn13" id="fnref13">[13]</a></sup>. To generate a CRAM-MD5 for a password:</p>\n<pre><code class="hljs">$ doveadm pw\n</code></pre>\n<p>Enter the password twice:</p>\n<pre><code class="hljs">Enter new password:\nRetype new password:\n</code></pre>\n<p>Then a hash like this will be generated and printed:</p>\n<pre><code class="hljs">{CRAM-MD5}26b633ec8bf9dd526293c5897400bddeef9299fad\n</code></pre>\n<p>To do something with the password, access the <code>psql</code> utility again:</p>\n<pre><code class="hljs">$ sudo su postgres\n$ psql mails\n</code></pre>\n<p>To check the existing user:</p>\n<pre><code class="hljs">SELECT * FROM users;\n</code></pre>\n<p>A table like this will be shown:</p>\n<pre><code class="hljs">     userid     |       password       | realname | uid  | gid  |         home         | mail\n----------------+----------------------------------------------------------------------------+----------+------+------+----------------------+------\n user1@snorl.ax | {CRYPT}xxxxxxxxxxxxx |          | 5000 | 5000 | snorl.ax/mails/user1 |\n user@snorl.ax  | {CRYPT}xxxxxxxxxxxxx |          | 5000 | 5000 | snorl.ax/mails/user  |\n</code></pre>\n<p>To check the correspondence between username and mail address:</p>\n<pre><code class="hljs">SELECT * FROM virtual;\n</code></pre>\n<p>A table similar to the following one will be shown:</p>\n<pre><code class="hljs">    address     |     userid     \n----------------+----------------\n xxxx@snorl.ax  | user@snorl.ax\n xxx@snorl.ax   | user2@snorl.ax\n xxxx@snorl.ax  | user@snorl.ax\n</code></pre>\n<p>To update an existing user with the password:</p>\n<pre><code class="hljs">UPDATE users SET password=\'{CRAM-MD5}26b633ec8bf9dd526293c5897400bddeef9299fad\' WHERE userid=\'user@snorl.ax\';\n</code></pre>\n<p>In <code>/etc/dovecot/conf.d/10-auth.conf</code>, disable plaintext login and add cram-md5 to the mechanisms:</p>\n<pre>\n<code class=\'hljs\'>...\n<b>disable_plaintext_auth = yes</b>\n...\nauth_mechanisms = plain login <b>cram-md5</b></code></pre>\n<p>In <code>/etc/postfix/sasl/smtpd.conf</code>, set the corresponding option to:</p>\n<pre>\n<code class=\'hljs\'>mech_list: login plain <b>cram-md5</b></code></pre>\n<p>In <code>/etc/pam_pgsql.conf</code>, set it to cram-md5:</p>\n<pre>\n<code class=\'hljs\'>...\npw_type = <b>cram-md5</b>\n...</code></pre>\n<p>In <code>/usr/local/etc/dovecot-sql.conf</code>, set it to cram-md5:</p>\n<pre>\n<code class=\'hljs\'>...\ndefault_pass_scheme = <b>CRAM-MD5</b>\n...</code></pre>\n<p>Then test logging in with <code>encrypted password</code> over SSL in imap and STARTTLS in smtp.</p>\n<h2 id="testing-smtp">Testing SMTP</h2>\n<p>Test sending mail outside of my mail server, like a Gmail account.</p>\n<pre><code class="hljs">echo &quot;Email body text&quot; | sudo mail -s &quot;Email subject line&quot; recipient@gmail.com -aFrom:kim@snorl.ax\n</code></pre>\n<p>Sometimes if I test sending while having the <code>@snorl.ax</code> omitted, like this:</p>\n<pre><code class="hljs">echo &quot;Email body text&quot; | sudo mail -s &quot;Email subject line&quot; recipient@gmail.com -aFrom:kim\n</code></pre>\n<p>The mail sender will be <code>kim@mail.snorl.ax</code> instaed, due to the default behaviour that mailutils append the hostname to usernames like this. Then the mail will be sent to <code>/var/mail/kim</code> instead. To change the appended domain to the desired <code>@snorl.ax</code>, create <code>/etc/mailutils.conf</code> with the setting:</p>\n<pre><code class="hljs">address {\n  email-domain snorl.ax;\n};\n</code></pre>\n<p>Other configurable options can be seen via <code>$ mail --config-help</code>.</p>\n<p>Now test SMTP using an Email Client like ThunderBird:</p>\n<ul>\n<li><strong>Username:</strong> <code>user@snorl.ax</code>, the login name of <code>kim@snorl.ax</code>.</li>\n<li><strong>Password:</strong>  The one I set above, not the encrypted string. The one before being encrypted.</li>\n<li><strong>Server name:</strong> <code>mail.snorl.ax</code>, or the IP address of the server.</li>\n<li><strong>SSL:</strong> <code>StartTls</code></li>\n<li><strong>Port:</strong> 587</li>\n</ul>\n<h2 id="block-some-brute-forcers">Block some Brute Forcers</h2>\n<p>Try looking into <code>/var/log/mail.log</code>:</p>\n<pre><code class="hljs">Jan 18 15:22:14 snorlax dovecot: auth-worker(5228): pam(tyler@snorl.ax,37.49.224.186): pam_authenticate() failed: Authentication failure (password mismatch?)\n</code></pre>\n<p>It’s normal that some IP I’ve never known keeps brute-forcing. Neither do I use any IP from that IP range.</p>\n<p>Install the package to make the change permanent.</p>\n<pre><code class="hljs">$ sudo apt-get install iptables-persistent\n</code></pre>\n<p>In this case, block the ip range might be a good idea:</p>\n<pre><code class="hljs">$ sudo iptables -A INPUT -s 37.49.224.0/24 -j DROP\n</code></pre>\n<h2 id="hide-senders-ip-in-the-sent-mails-header">Hide sender’s IP in the sent mail’s header</h2>\n<p>I’m using submission port. Uncomment and add and edit the relevant lines in <code>/etc/postfix/master.cf</code>, the relevant lines should look like this<sup class="footnote-ref"><a href="#fn14" id="fnref14">[14]</a></sup>:</p>\n<pre><code class="hljs">submission inet n       -       -       -       -       smtpd\n  -o smtpd_tls_security_level=encrypt\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_client_restrictions=permit_sasl_authenticated,reject\n  -o milter_macro_daemon_name=ORIGINATING\n  -o cleanup_service_name=subcleanup\n</code></pre>\n<p>Pass <code>header_checks</code> to the new cleanup service in <code>/etc/postfix/master.cf</code>, relevant lines look like this:</p>\n<pre><code class="hljs">cleanup   unix  n       -       -       -       0       cleanup\nsubcleanup unix n       -       -       -       0       cleanup\n  -o header_checks=regexp:/etc/postfix/submission_header_checks\n</code></pre>\n<p>Create the file <code>/etc/postfix/submission_header_checks</code>, which will contain the regex that filters offending Received header lines.</p>\n<p>If <code>smtpd_sasl_authenticated_header</code> is <code>yes</code>, then use this in the file:</p>\n<pre><code class="hljs">/^Received:.*\\(Authenticated sender:/ IGNORE\n</code></pre>\n<p>Otherwise(also by default when <code>smtpd_sasl_authenticated_header</code> is not set), use this in the file:</p>\n<pre><code class="hljs">/^Received:.*\\(Postfix/ IGNORE\n</code></pre>\n<p>Restart postfix to see the effect.</p>\n<h2 id="integrate-spamassassin">Integrate Spamassassin</h2>\n<p>It’s one of the most well-known mail spam filters. Speaking of spam filter, it can be regarded as the most mentioned<sup class="footnote-ref"><a href="#fn15" id="fnref15">[15]</a></sup><sup class="footnote-ref"><a href="#fn16" id="fnref16">[16]</a></sup>.</p>\n<p>Install Spamassassin and its dependencies and dovecot-sieve.</p>\n<pre><code class="hljs">$ sudo apt install spamassassin spamc dovecot-sieve\n</code></pre>\n<p>Start the service and enable it.</p>\n<pre><code class="hljs">$ sudo systemctl start spamassassin\n$ sudo systemctl enable spamassassin\n</code></pre>\n<p>Modify <code>/etc/postfix/master.cf</code>:</p>\n<ol>\n<li>\n<p>Change the smtp line to:</p>\n<pre><code class="hljs"> smtp      inet  n       -       -       -       -       smtpd -o content_filter=spamassassin\n</code></pre>\n</li>\n<li>\n<p>Add the following (a call to our newly-created spamfilter script) at the end:</p>\n<pre><code class="hljs"> spamassassin unix -     n   n   -   -   pipe\n     flags=ROhu user=vmail:vmail argv=/usr/bin/spamc -f -e\n     /usr/lib/dovecot/deliver -f ${sender} -d ${user}@${nexthop}\n</code></pre>\n<p>The flags flags=ROhu don’t add anything abnormal but they can be understood <a href="http://www.postfix.org/pipe.8.html">here</a>.</p>\n</li>\n</ol>\n<p>Modify <code>/etc/mail/spamassassin/local.cf</code> to include the following settings:</p>\n<pre><code class="hljs"># Just add an X-Spam-Report header to suspected spam, rather than rewriting the content of the e-mail\nreport_safe 0\n# Also we want to add a detailed ham report header to even e-mail that ISN\'T suspected to be spam\nadd_header ham HAM-Report _REPORT_\n# Set the threshold at which a message is considered spam (3 is usually sufficient)\nrequired_score 3.0\n</code></pre>\n<p>Modify <code>/etc/dovecot/conf.d/15-mailboxes.conf</code> to ensure the following lines are included(By default they are included):</p>\n<pre><code class="hljs">mailbox Junk {\n   special_use = \\Junk\n}\n</code></pre>\n<p>Edit <code>/etc/dovecot/conf.d/90-sieve.conf</code> and comment the line <code>sieve = ~/.dovecot.sieve</code>, like this:</p>\n<pre>\n<code class=\'hljs\'>...\nplugin {\n  ...\n  <b>#sieve = file:~/sieve;active=~/.dovecot.sieve</b></code></pre>\n<p>Edit <code>/etc/dovecot/conf.d/90-plugin.conf</code> as:</p>\n<pre>\n<code class=\'hljs\'>...\nplugin {\n\t...\n    <b>sieve = /etc/dovecot/sieve/default.sieve</b>\n}</code></pre>\n<p>Edit <code>/etc/dovecot/conf.d/15-lda.conf</code>:</p>\n<pre>\n<code class=\'hljs\'>protocol lda {\n  <b>mail_plugins = $mail_plugins sieve</b>\n}</code></pre>\n<p>Create folder <code>/etc/dovecot/sieve/</code>:</p>\n<pre><code class="hljs">$ mkdir /etc/dovecot/sieve/\n</code></pre>\n<p>Create file <code>/etc/dovecot/sieve/default.sieve</code> with this content:</p>\n<pre><code class="hljs">require &quot;fileinto&quot;;\nif header :contains &quot;X-Spam-Flag&quot; &quot;YES&quot; {\n    fileinto &quot;Junk&quot;;\n}\n</code></pre>\n<p>Change the folder permissions to the virtual email user and group like:</p>\n<pre><code class="hljs">$ chown vmail:vmail /etc/dovecot/sieve/ -R\n</code></pre>\n<p>Restart postfix, dovecot and spamassassin.</p>\n<pre><code class="hljs">$ sudo systemctl restart spamassassin dovecot postfix\n</code></pre>\n<p>Try sending a mail to the mail account. The output of <code>tail /var/log/mail.log</code> will be like:</p>\n<pre><code class="hljs">Jan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">47</span> pelipper postfix/qmgr[<span class="hljs-number">23283</span>]: <span class="hljs-number">9</span>C2C5DBBA7: <span class="hljs-keyword">from</span>=&lt;<span class="hljs-symbol">yumsnorlax@</span>gmail.com&gt;, size=<span class="hljs-number">3031</span>, nrcpt=<span class="hljs-number">1</span> (queue active)\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">47</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: connection <span class="hljs-keyword">from</span> ::<span class="hljs-number">1</span> [::<span class="hljs-number">1</span>]:<span class="hljs-number">33756</span> to port <span class="hljs-number">783</span>, fd <span class="hljs-number">5</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">47</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: setuid to vmail succeeded\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">47</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: creating default_prefs: /var/mail/.spamassassin/user_prefs\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">47</span> pelipper spamd[<span class="hljs-number">23286</span>]: config: created user preferences file: /var/mail/.spamassassin/user_prefs\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">47</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: processing message &lt;<span class="hljs-number">1548420881.1041</span><span class="hljs-number">.0</span>@gmail.com&gt; <span class="hljs-keyword">for</span> vmail:<span class="hljs-number">5000</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">47</span> pelipper postfix/smtpd[<span class="hljs-number">23313</span>]: disconnect <span class="hljs-keyword">from</span> mail-pg1-x530.google.com[<span class="hljs-number">2607</span>:f8b0:<span class="hljs-number">4864</span>:<span class="hljs-number">20</span>::<span class="hljs-number">530</span>] ehlo=<span class="hljs-number">2</span> starttls=<span class="hljs-number">1</span> mail=<span class="hljs-number">1</span> rcpt=<span class="hljs-number">1</span> data=<span class="hljs-number">1</span> quit=<span class="hljs-number">1</span> commands=<span class="hljs-number">7</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">49</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: clean message (<span class="hljs-number">0.9</span>/<span class="hljs-number">3.0</span>) <span class="hljs-keyword">for</span> vmail:<span class="hljs-number">5000</span> <span class="hljs-keyword">in</span> <span class="hljs-number">2.7</span> seconds, <span class="hljs-number">3164</span> bytes.\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">49</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: result: . <span class="hljs-number">0</span> - DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,TRACKER_ID,TVD_SPACE_RATIO scantime=<span class="hljs-number">2.7</span>,size=<span class="hljs-number">3164</span>,user=vmail,uid=<span class="hljs-number">5000</span>,required_score=<span class="hljs-number">3.0</span>,rhost=::<span class="hljs-number">1</span>,raddr=::<span class="hljs-number">1</span>,rport=<span class="hljs-number">33756</span>,mid=&lt;<span class="hljs-number">1548420881.1041</span><span class="hljs-number">.0</span>@gmail.com&gt;,<span class="hljs-built_in">auto</span>learn=no <span class="hljs-built_in">auto</span>learn_force=no\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">49</span> pelipper dovecot: lda(<span class="hljs-symbol">user2@</span>snorl.ax): sieve: msgid=&lt;<span class="hljs-number">1548420881.1041</span><span class="hljs-number">.0</span>@gmail.com&gt;: stored mail <span class="hljs-built_in">int</span>o mailbox <span class="hljs-string">\'INBOX\'</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">49</span> pelipper postfix/pipe[<span class="hljs-number">23326</span>]: <span class="hljs-number">9</span>C2C5DBBA7: to=&lt;<span class="hljs-symbol">user2@</span>snorl.ax&gt;, orig_to=&lt;<span class="hljs-symbol">kim@</span>snorl.ax&gt;, relay=spamassassin, delay=<span class="hljs-number">3.3</span>, delays=<span class="hljs-number">0.58</span>/<span class="hljs-number">0.01</span>/<span class="hljs-number">0</span>/<span class="hljs-number">2.7</span>, dsn=<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>, status=sent (delivered via spamassassin service)\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">49</span> pelipper postfix/qmgr[<span class="hljs-number">23283</span>]: <span class="hljs-number">9</span>C2C5DBBA7: removed\n</code></pre>\n<p>Try sending another mail with this subject: <code>XJS*C4JDBQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X</code>. The output of <code>tail /var/log/mail.log</code> will be like this:</p>\n<pre><code class="hljs">Jan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31</span> pelipper postfix/qmgr[<span class="hljs-number">23283</span>]: <span class="hljs-number">43</span>CFADBBA7: <span class="hljs-keyword">from</span>=&lt;<span class="hljs-symbol">yumsnorlax@</span>gmail.com&gt;, size=<span class="hljs-number">3103</span>, nrcpt=<span class="hljs-number">1</span> (queue active)\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: connection <span class="hljs-keyword">from</span> ::<span class="hljs-number">1</span> [::<span class="hljs-number">1</span>]:<span class="hljs-number">33770</span> to port <span class="hljs-number">783</span>, fd <span class="hljs-number">5</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: setuid to vmail succeeded\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: processing message &lt;<span class="hljs-number">1548420985.1041</span><span class="hljs-number">.1</span>@gmail.com&gt; <span class="hljs-keyword">for</span> vmail:<span class="hljs-number">5000</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">31</span> pelipper postfix/smtpd[<span class="hljs-number">23334</span>]: disconnect <span class="hljs-keyword">from</span> mail-pl1-x62d.google.com[<span class="hljs-number">2607</span>:f8b0:<span class="hljs-number">4864</span>:<span class="hljs-number">20</span>::<span class="hljs-number">62</span>d] ehlo=<span class="hljs-number">2</span> starttls=<span class="hljs-number">1</span> mail=<span class="hljs-number">1</span> rcpt=<span class="hljs-number">1</span> data=<span class="hljs-number">1</span> quit=<span class="hljs-number">1</span> commands=<span class="hljs-number">7</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">33</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: identified spam (<span class="hljs-number">999.8</span>/<span class="hljs-number">3.0</span>) <span class="hljs-keyword">for</span> vmail:<span class="hljs-number">5000</span> <span class="hljs-keyword">in</span> <span class="hljs-number">2.4</span> seconds, <span class="hljs-number">3235</span> bytes.\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">33</span> pelipper spamd[<span class="hljs-number">23286</span>]: spamd: result: Y <span class="hljs-number">999</span> - DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_FROM,GTUBE,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,TVD_SPACE_RATIO scantime=<span class="hljs-number">2.4</span>,size=<span class="hljs-number">3235</span>,user=vmail,uid=<span class="hljs-number">5000</span>,required_score=<span class="hljs-number">3.0</span>,rhost=::<span class="hljs-number">1</span>,raddr=::<span class="hljs-number">1</span>,rport=<span class="hljs-number">33770</span>,mid=&lt;<span class="hljs-number">1548420985.1041</span><span class="hljs-number">.1</span>@gmail.com&gt;,<span class="hljs-built_in">auto</span>learn=no <span class="hljs-built_in">auto</span>learn_force=no\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">33</span> pelipper dovecot: lda(<span class="hljs-symbol">user2@</span>snorl.ax): sieve: msgid=&lt;<span class="hljs-number">1548420985.1041</span><span class="hljs-number">.1</span>@gmail.com&gt;: stored mail <span class="hljs-built_in">int</span>o mailbox <span class="hljs-string">\'Junk\'</span>\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">34</span> pelipper postfix/pipe[<span class="hljs-number">23343</span>]: <span class="hljs-number">43</span>CFADBBA7: to=&lt;<span class="hljs-symbol">user2@</span>snorl.ax&gt;, orig_to=&lt;<span class="hljs-symbol">kim@</span>snorl.ax&gt;, relay=spamassassin, delay=<span class="hljs-number">2.9</span>, delays=<span class="hljs-number">0.46</span>/<span class="hljs-number">0.01</span>/<span class="hljs-number">0</span>/<span class="hljs-number">2.4</span>, dsn=<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>, status=sent (delivered via spamassassin service)\nJan <span class="hljs-number">25</span> <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">34</span> pelipper postfix/qmgr[<span class="hljs-number">23283</span>]: <span class="hljs-number">43</span>CFADBBA7: removed\n</code></pre>\n<p>The spam filter is now working. A spam will go directly into the Junk Folder.</p>\n<h3 id="solve-uribl_blocked">Solve URIBL_BLOCKED</h3>\n<pre><code class="hljs">X-Spam-HAM-Report:\n\t*  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was\n\t*      blocked.  See\n\t*      http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block\n\t*      for more information.\n</code></pre>\n<p>SpamAssassin will perform many DNS lookups for NetworkTests to significantly improve scoring of messages primarily by DNSBlocklists like Spamhaus, SORBS, etc. This information needs to be cached locally to improve performance and limit the number of external DNS queries since some DNSBlockLists have limits on free usage. A local DNS caching server should not forward to other DNS servers to ensure your queries are not combined with others. Forwarding to other DNS servers often results in URIBL_BLOCKED or similar rule hits meaning you have gone over their free usage limit.<sup class="footnote-ref"><a href="#fn17" id="fnref17">[17]</a></sup></p>\n<pre><code class="hljs">$ sudo apt-get update\n$ sudo apt-get install unbound\n</code></pre>\n<p>Then it is running and the corresponding service is enabled.<br>\nAdd this to <code>/etc/spamassassin/local.cf</code>:</p>\n<pre><code class="hljs">dns_available yes\ndns_server 127.0.0.1\n</code></pre>\n<p>Test it out. With these output it’s now working.</p>\n<p>Spamhaus Zen:</p>\n<pre><code class="hljs">$ dig +short 2.0.0.127.zen.spamhaus.org @127.0.0.1\n127.0.0.10\n127.0.0.4\n127.0.0.2\n</code></pre>\n<p>SORBS DUL:</p>\n<pre><code class="hljs">$ dig 2.0.0.127.dul.dnsbl.sorbs.net +short @127.0.0.1\n127.0.0.10\n</code></pre>\n<p>URIBL:</p>\n<pre><code class="hljs">$ dig test.uribl.com.multi.uribl.com txt +short @127.0.0.1\n&quot;permanent testpoint&quot;\n</code></pre>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://wiki2.dovecot.org/HowTo/DovecotPostgresql">HowTo/DovecotPostgresql - Dovecot Wiki</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://www.linode.com/docs/email/postfix/email-with-postfix-dovecot-and-mysql/">Email with Postfix, Dovecot, and MySQL - Linode</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn3" class="footnote-item"><p><a href="https://easyengine.io/tutorials/mail/fqdn-reverse-dns-ptr-mx-record-checks">Checking FQDN, Reverse-DNS/PTR, MX record</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn4" class="footnote-item"><p><a href="https://backports.debian.org/Instructions/">Debian Backports - Instructions</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn5" class="footnote-item"><p><a href="https://serverfault.com/a/440616">centos - How do I change Dovecot virtual user passwords? - Server Fault</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn6" class="footnote-item"><p><a href="http://www.postfix.org/postconf.5.html">Postfix Configuration Parameters</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn7" class="footnote-item"><p><a href="http://www.postfix.org/LOCAL_RECIPIENT_README.html#format">Rejecting Unknown Local Recipients with Postfix</a> <a href="#fnref7" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn8" class="footnote-item"><p><a href="https://wiki.dovecot.org/BasicConfiguration">BasicConfiguration - Dovecot Wiki</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn9" class="footnote-item"><p><a href="http://www.postfix.org/SASL_README.html">Postfix SASL Howto</a> <a href="#fnref9" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn10" class="footnote-item"><p><a href="https://wiki.dovecot.org/SSL/DovecotConfiguration">SSL/DovecotConfiguration - Dovecot Wiki</a> <a href="#fnref10" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn11" class="footnote-item"><p><a href="https://www.linode.com/docs/email/postfix/configure-spf-and-dkim-in-postfix-on-debian-9/">Configure SPF and DKIM With Postfix on Debian 9</a> <a href="#fnref11" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn12" class="footnote-item"><p><a href="https://wiki.dovecot.org/HowTo/CRAM-MD5">HowToCRAM/MD5 - Dovecot Wiki</a> <a href="#fnref12" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn13" class="footnote-item"><p><a href="https://wiki1.dovecot.org/Authentication/PasswordSchemes">Authentication/PasswordSchemes - Dovecot Wiki</a> <a href="#fnref13" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn14" class="footnote-item"><p><a href="https://askubuntu.com/a/78168">When sending email with Postfix, how can I hide the sender’s IP and username in the Received header?</a> <a href="#fnref14" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn15" class="footnote-item"><p><a href="https://wiki.apache.org/spamassassin/IntegratedSpamdInPostfix">IntegratedSpamdInPostfix - Spamassassin Wiki</a> <a href="#fnref15" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn16" class="footnote-item"><p><a href="https://stackoverflow.com/a/34571858/9850945">postfix mta - How to move spam to spam folder? - Stack Overflow</a> <a href="#fnref16" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn17" class="footnote-item"><p><a href="https://wiki.apache.org/spamassassin/CachingNameserver">CachingNameserver - Spamassassin Wiki</a> <a href="#fnref17" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',l.path="~/contents/Terminal/20181227-running-email-service-on-my-own-server.md",p.attributes={title:"Site Migration History",date:"2016-12-08 01:40",modified:"2019-11-17 12:51",author:e,tags:["KeyCDN","Gitlab","Github",ie,J,Es,ws,"CDN"],status:a,summary:"KeyCDN → Gitlab → Github + CloudFlare → Gitlab + Netlify → Github + Cloudflare → Firebase → Cloudflare+Firebase → Cloudflare+Gitlab → Github + Cloudflare → Firebase → My VPS + CloudFlare → My VPS → Firebase",category:n,published:s},p.html='<h2 id="summary">Summary</h2>\n<p>The site is hosted on my own VPS now.<br>\nJudging from my experience, my rank of my used hosting of static sites:</p>\n<ol>\n<li>Firebase Hosting</li>\n<li>Github Pages</li>\n<li>Gitlab Pages / Netlify</li>\n<li>KeyCDN</li>\n</ol>\n<p>Firebase is the champion \'cause its speed is on par with GitHub Pages (Both are using Fastly CDN) and it’s really customizable when it comes to things like 301 redirection and caching. BTW, Firebase Hosting also supports dynamic content through Cloud Functions and Cloud Run. As for shortcomings, the SSL cert issued by them have multiple domains from various customers. (I asked the support and they told me I can move to the clean cert with only my domains for free if I switch to Blaze plan which is their pay-as-you-go plan. So I am now on the clean cert several days after I made the switch. Their free usage is like overkill for this site so not a bad deal).<br>\nGithub Pages is second to Gitlab Pages due to the shortage of customizability in things like 301, caching and dynamic contents. However the cert of Github Pages is clean with only my own domain there.<br>\nThe rest of them are not the fastest. Gitlab Pages supports my own certs. Netlify is feature-rich and the bandwidth limit is 100GB for free. KeyCDN’s speed is just poor.</p>\n<p>My current choice is excluded from the list, \'cause VPS itself does much more than all of them and not in the same category.</p>\n<h2 id="2016-12-08-from-keycdn-to-gitlab">2016-12-08: From KeyCDN To Gitlab</h2>\n<p>Well the site had been hosted on KeyCDN for about weeks before I couldn’t bear the waiting time for even a minor file.<br>\nSee the result below:<br>\n<a href="/images/posts/keycdn1.png" title="Wait that long?"><img src="/images/posts/keycdn1-150x150.png" height="150" width="150"></a><a href="/images/posts/keycdn2.png" title="Wait that long?"><img src="/images/posts/keycdn2-150x150.png" height="150" width="150"></a><a href="/images/posts/keycdn3.png" title="Wait that long?"><img src="/images/posts/keycdn3-150x150.png" height="150" width="150"></a></p>\n<p>That lagging time is not worth the money, I decided to try on Gitlab cause there’s no need to spend much on other CDNs, whose SSL support is SNI and SAN support is rather expensive.</p>\n<p>After a while of cloning and pushing and assign SSL, I ran the tests below:<br>\n<a href="/images/posts/gitlab1.png" title="Much better now!"><img src="/images/posts/gitlab1-150x150.png" height="150" width="150"></a><a href="/images/posts/gitlab2.png" title="Much better now!"><img src="/images/posts/gitlab2-150x150.png" height="150" width="150"></a><a href="/images/posts/gitlab3.png" title="Despite the lagging Chinese spot, it\'s only 0.1 sec lower on avg time. And it defeats KeyCDN almost every spot, meaning KeyCDN sucks."><img src="/images/posts/gitlab3-150x150.png" height="150" width="150"></a></p>\n<p>It’s really a waste of money when it comes to KeyCDN, while Gitlab is an amazing choice, though the SSL things need manually updating on Gitlab.</p>\n<p>Goodbye KeyCDN! Hello Gitlab!</p>\n<p>I’ve just been using Gitlab for a while and begin to love it! All I need to do is write and update and the rest procedures r automatically done by the runner!</p>\n<p>To make things better, I just used CloudFlare’s CDN for it, the speed has improved dramatically, which is well worth the loss of the old browser users, meaning I am finally back to CloudFlare CDN!</p>\n<p><a href="/images/posts/cloudflare1.png" title="CloudFlare is AMAZING!"><img src="/images/posts/cloudflare1-150x150.png" height="150" width="150"></a><a href="/images/posts/cloudflare2.png" title="CloudFlare is AMAZING!"><img src="/images/posts/cloudflare2-150x150.png" height="150" width="150"></a><a href="/images/posts/cloudflare3.png" title="CloudFlare is AMAZING!"><img src="/images/posts/cloudflare3-150x150.png" height="150" width="150"></a></p>\n<h2 id="2016-12-30-moved-to-github">2016-12-30: Moved To Github</h2>\n<p>Just made some tests between Gitlab Pages and Github Pages about the speed. They were both sped up with Cloudflare. No need in uploading those things, \'cause it’s basically about data.</p>\n<p>On the same image 33 kb, in Stockholm Github pages performed better with the time of 450 ms while Gitlab spent 995 ms, in Melbourne Github did it again with 497 ms while Gitlab spent 1.54 s. Globally, Github is faster.</p>\n<p>Just moved to Github.</p>\n<h2 id="2018-01-12-stick-with-github">2018-01-12: Stick With Github</h2>\n<p>To migrate from a server to another, I have to restore my backup. Then today I tried Gitlab to backup and restore. Everything worked like a charm fastly and conveniently with a <strong>free gitlab private</strong> (which I hadn’t really care about when switching from Gitlab Pages to Github pages) repository in which there exists several branches. Then I realized how long I hadn’t used Github since the last time. Also, with Netlify, the cert will look much more decent and be auto-renewed. So I just migrated the blog to Gitlab. After speedtest, I finally couldn’t stand the speed loss again. 184.8kB in 2s or so almost everywhere. Is a Netlify page really using CDN? For the speed, I moved the blog back to Github PAGES + Cloudflare again.</p>\n<h2 id="2018-01-14-moved-to-firebase">2018-01-14: Moved To Firebase</h2>\n<p>Moved to Google Firebase.<br>\nIt’s not as fast as Github pages + Cloudflare, but the SSL time beats the CF.<br>\nI can have enough privacy with my files.</p>\n<h2 id="2018-01-15-~-2019-05-06-my-time-with-github-pages">2018-01-15 ~ 2019-05-06: My Time With Github Pages</h2>\n<p><strong>2018-01-15:</strong> No way. It’s a shared cert on Firebase. After the comparation below, I decided to move back to Gitlab+Cloudflare, \'cause I know I value more about privacy now. Gitlab+CloudFlare has an okay speed for larger files.</p>\n<p>Repeated Views Load Time Of a 220.7 kB image (With CloudFlare CDN):</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>Gitlab</th>\n<th>Firebase</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>San Jose</td>\n<td>300ms</td>\n<td>49ms</td>\n</tr>\n<tr>\n<td>New York</td>\n<td>374ms</td>\n<td>173ms</td>\n</tr>\n<tr>\n<td>Melbourne</td>\n<td>64ms</td>\n<td>52ms</td>\n</tr>\n<tr>\n<td>Stockholm</td>\n<td>115ms</td>\n<td>34ms</td>\n</tr>\n</tbody>\n</table>\n<p>More about Gitlab+CF:</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>DNS</th>\n<th>SSL</th>\n<th>Connect</th>\n<th>Send</th>\n<th>Wait</th>\n<th>Receive</th>\n<th>Total</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>San Jose</td>\n<td>2ms</td>\n<td>22ms</td>\n<td>23ms</td>\n<td>1ms</td>\n<td>268ms</td>\n<td>6ms</td>\n<td>322ms</td>\n</tr>\n<tr>\n<td>New York</td>\n<td>0ms</td>\n<td>79ms</td>\n<td>114ms</td>\n<td>1ms</td>\n<td>105ms</td>\n<td>150ms</td>\n<td>451ms</td>\n</tr>\n<tr>\n<td>Melbourne</td>\n<td>0ms</td>\n<td>18ms</td>\n<td>19ms</td>\n<td>0ms</td>\n<td>25ms</td>\n<td>19ms</td>\n<td>81ms</td>\n</tr>\n<tr>\n<td>Stockholm</td>\n<td>0ms</td>\n<td>18ms</td>\n<td>19ms</td>\n<td>0ms</td>\n<td>88ms</td>\n<td>7ms</td>\n<td>132ms</td>\n</tr>\n</tbody>\n</table>\n<p>More about Firebase+CF:</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>DNS</th>\n<th>SSL</th>\n<th>Connect</th>\n<th>Send</th>\n<th>Wait</th>\n<th>Receive</th>\n<th>Total</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>San Jose</td>\n<td>2ms</td>\n<td>34ms</td>\n<td>34ms</td>\n<td>0ms</td>\n<td>6ms</td>\n<td>6ms</td>\n<td>49ms</td>\n</tr>\n<tr>\n<td>New York</td>\n<td>0ms</td>\n<td>58ms</td>\n<td>77ms</td>\n<td>1ms</td>\n<td>22ms</td>\n<td>72ms</td>\n<td>230ms</td>\n</tr>\n<tr>\n<td>Melbourne</td>\n<td>0ms</td>\n<td>20ms</td>\n<td>21ms</td>\n<td>0ms</td>\n<td>9ms</td>\n<td>19ms</td>\n<td>69ms</td>\n</tr>\n<tr>\n<td>Stockholm</td>\n<td>0ms</td>\n<td>17ms</td>\n<td>18ms</td>\n<td>0ms</td>\n<td>9ms</td>\n<td>6ms</td>\n<td>50ms</td>\n</tr>\n</tbody>\n</table>\n<p>About first-time view? The difference is larger. For instance, in Australia, Gitlab is 1.2s and Firebase is 58ms.</p>\n<p>Also, just made a comparation between Gitlab, Github and Firebase on larger files:</p>\n<p>The First of Repeated Views Load Time Of a 4.8MB image (With Cloudflare CDN):</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>Github</th>\n<th>Firebase</th>\n<th>Gitlab</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>San Jose</td>\n<td>342ms</td>\n<td>1.27s</td>\n<td>839ms</td>\n</tr>\n<tr>\n<td>New York</td>\n<td>659ms</td>\n<td>1.17s</td>\n<td>677ms</td>\n</tr>\n<tr>\n<td>Melbourne</td>\n<td>2.36s</td>\n<td>3.85s</td>\n<td>2.87s</td>\n</tr>\n<tr>\n<td>Stockholm</td>\n<td>3.80s</td>\n<td>1.25s</td>\n<td>1.46s</td>\n</tr>\n</tbody>\n</table>\n<p>Github+CF:</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>DNS</th>\n<th>SSL</th>\n<th>Connect</th>\n<th>Send</th>\n<th>Wait</th>\n<th>Receive</th>\n<th>Total</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>San Jose</td>\n<td>2ms</td>\n<td>24ms</td>\n<td>25ms</td>\n<td>0ms</td>\n<td>247ms</td>\n<td>68ms</td>\n<td>366ms</td>\n</tr>\n<tr>\n<td>New York</td>\n<td>2ms</td>\n<td>47ms</td>\n<td>49ms</td>\n<td>1ms</td>\n<td>146ms</td>\n<td>459ms</td>\n<td>705ms</td>\n</tr>\n<tr>\n<td>Melbourne</td>\n<td>2ms</td>\n<td>19ms</td>\n<td>19ms</td>\n<td>0ms</td>\n<td>1.90s</td>\n<td>440ms</td>\n<td>2.38s</td>\n</tr>\n<tr>\n<td>Stockholm</td>\n<td>2ms</td>\n<td>19ms</td>\n<td>20ms</td>\n<td>0ms</td>\n<td>3.71s</td>\n<td>68ms</td>\n<td>3.81s</td>\n</tr>\n</tbody>\n</table>\n<p>Firebase+CF:</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>DNS</th>\n<th>SSL</th>\n<th>Connect</th>\n<th>Send</th>\n<th>Wait</th>\n<th>Receive</th>\n<th>Total</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>San Jose</td>\n<td>2ms</td>\n<td>30ms</td>\n<td>30ms</td>\n<td>0ms</td>\n<td>866ms</td>\n<td>373ms</td>\n<td>1.30s</td>\n</tr>\n<tr>\n<td>New York</td>\n<td>3ms</td>\n<td>61ms</td>\n<td>63ms</td>\n<td>1ms</td>\n<td>634ms</td>\n<td>468ms</td>\n<td>1.23s</td>\n</tr>\n<tr>\n<td>Melbourne</td>\n<td>2ms</td>\n<td>18ms</td>\n<td>19ms</td>\n<td>0ms</td>\n<td>3.37s</td>\n<td>455ms</td>\n<td>3.87s</td>\n</tr>\n<tr>\n<td>Stockholm</td>\n<td>2ms</td>\n<td>17ms</td>\n<td>18ms</td>\n<td>0ms</td>\n<td>1.15s</td>\n<td>74ms</td>\n<td>1.26s</td>\n</tr>\n</tbody>\n</table>\n<p>Gitlab+CF:</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>DNS</th>\n<th>SSL</th>\n<th>Connect</th>\n<th>Send</th>\n<th>Wait</th>\n<th>Receive</th>\n<th>Total</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>San Jose</td>\n<td>0ms</td>\n<td>30ms</td>\n<td>31ms</td>\n<td>0ms</td>\n<td>321ms</td>\n<td>486ms</td>\n<td>868ms</td>\n</tr>\n<tr>\n<td>New York</td>\n<td>0ms</td>\n<td>39ms</td>\n<td>41ms</td>\n<td>0ms</td>\n<td>112ms</td>\n<td>523ms</td>\n<td>715ms</td>\n</tr>\n<tr>\n<td>Melbourne</td>\n<td>0ms</td>\n<td>23ms</td>\n<td>24ms</td>\n<td>0ms</td>\n<td>1.04s</td>\n<td>1.80s</td>\n<td>2.89s</td>\n</tr>\n<tr>\n<td>Stockholm</td>\n<td>0ms</td>\n<td>21ms</td>\n<td>21ms</td>\n<td>0ms</td>\n<td>577ms</td>\n<td>862ms</td>\n<td>1.48s</td>\n</tr>\n</tbody>\n</table>\n<p><strong>2018-01-20:</strong> All the static assets on the site will be using the original CDN on the github.io domain.</p>\n<p><strong>2018-01-21:</strong> After testing and pondering, the assets of my blog, hosted on Github are now sped up by Cloudflare.</p>\n<p><strong>2018-05-01:</strong> <a href="https://blog.github.com/2018-05-01-github-pages-custom-domains-https/" target="_blank">The News: Custom domains on GitHub Pages gain support for HTTPS</a>, now the blog’s cert is automatically generated by Github. Even better!</p>\n<h2 id="2019-05-06-~-2019-06-06-back-to-firebase">2019-05-06 ~ 2019-06-06: Back To Firebase</h2>\n<p><strong>2019-05-06:</strong> I switched back to Firebase. There I could have control over caching, redirects, etc. No longer rely on soft link. I’m now directly using Firebase.</p>\n<p>Just made a speed test on GTMetrix about the isso loading speed on <a href="/terminal/2018/12/27/running-email-service-on-my-own-server/">the article</a>:</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>With CloudFlare</th>\n<th>Bare speed</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Canada</td>\n<td>1641.6ms</td>\n<td>1322ms</td>\n</tr>\n<tr>\n<td>USA</td>\n<td>1351.1ms</td>\n<td>1074.3ms</td>\n</tr>\n<tr>\n<td>UK</td>\n<td>430.5ms</td>\n<td>260.6ms</td>\n</tr>\n<tr>\n<td>Brazil</td>\n<td>2.72s</td>\n<td>1.75s</td>\n</tr>\n<tr>\n<td>Australia</td>\n<td>2.92s</td>\n<td>1.998s</td>\n</tr>\n<tr>\n<td>China</td>\n<td>3.12s</td>\n<td>1.83s</td>\n</tr>\n<tr>\n<td>India</td>\n<td>1.49s</td>\n<td>1.25s</td>\n</tr>\n</tbody>\n</table>\n<p>Not faster at all. So I’ll just stop CF it and make it run barely.</p>\n<p><strong>2019-05-07:</strong> I ran a test between Firebase and bare nginx about the static file loading speed on <a href="/terminal/2018/12/27/running-email-service-on-my-own-server/">the article</a>:</p>\n<table>\n<thead>\n<tr>\n<th>Area</th>\n<th>With Firebase</th>\n<th>Bare speed</th>\n<th>With Github</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Canada</td>\n<td>293ms</td>\n<td>1.4s</td>\n<td>0.6s</td>\n</tr>\n<tr>\n<td>USA</td>\n<td>0.8s</td>\n<td>1.0s</td>\n<td>308ms</td>\n</tr>\n<tr>\n<td>UK</td>\n<td>0.6s</td>\n<td>1.0s</td>\n<td>356ms</td>\n</tr>\n<tr>\n<td>Brazil</td>\n<td>1.2s</td>\n<td>1.7s</td>\n<td>0.8s</td>\n</tr>\n<tr>\n<td>Australia</td>\n<td>419ms</td>\n<td>2.2s</td>\n<td>0.5s</td>\n</tr>\n<tr>\n<td>China</td>\n<td>0.9s</td>\n<td>1.9s</td>\n<td>0.8s</td>\n</tr>\n<tr>\n<td>India</td>\n<td>0.6s</td>\n<td>1.3s</td>\n<td>1.2s</td>\n</tr>\n</tbody>\n</table>\n<p>This time Firebase outspeed the bare speed everywhere. Right choice on Firebase about static site. I put Github on the right on purpose. Seems like nowadays GIthub pages and Firebase are almost on par when it comes to speed. To me, it’s a right choice to switch to Firebase.</p>\n<p>Just did a lookup about github pages’ and Firebase’s IP, they are both using Fastly. No wonder the performances are similar. The tests past were totally wrong \'cause I didn’t take a look and check which time belonged to the CDN and they are generally affected by CF layer.</p>\n<p><strong>2019-05-27:</strong> Reused CloudFlare on isso for security purpose.</p>\n<h2 id="2019-06-06-~-2019-06-10-back-to-vps-cloudflare">2019-06-06 ~ 2019-06-10: Back To VPS + CloudFlare</h2>\n<p>Firebase ssl needs checking in every month, which is awful.<br>\nAlso, learning FLask recently, I want to tango with Nginx and CloudFlare.<br>\nThe contents will load fast if cached on CF’s server.<br>\nOtherwise meh…<br>\nBut Cf is a security company.<br>\nI use it for security purpose.</p>\n<h2 id="2019-06-10-~-2019-11-17-my-vps">2019-06-10 ~ 2019-11-17: My VPS</h2>\n<p>This site is now served by two servers without Cloudflare as a frontend.<br>\n(As I found out that Cloudflare CDN generally slows down the site speed).<br>\nHere’s <a href="/terminal/2019/06/10/performance-test-on-a-page-cloudflare-vs-bare-nginx/">the relevant results</a>.</p>\n<h2 id="2019-11-17-~-now-firebase-hosting">2019-11-17 ~ Now: Firebase Hosting</h2>\n<p>Back to CDN again. When it comes to Nuxt, nothing can beat CDN.<br>\nMeanwhile I could do backend things on my own server.<br>\nCheers.<br>\nAs for checking? Automate.</p>\n',p.path="~/contents/Terminal/20161208-hosted-by-gitlab.md",i.attributes={title:"Purchased a NAT VPS From CloudIPLC",date:"2019-06-22 17:55",modified:"2019-08-05 18:08",author:e,tags:[Ls,"VPS","NAT",Ws,"BBR","Proxy"],status:a,summary:"Whether living in China or not, that could be a must for me.",category:n,published:s},i.html='<p>Today I purchased a NAT VPS from <a href="https://www.cloudiplc.com/aff.php?aff=371">CloudIPLC</a>. The plan was <code>CN-XZ CT-NAT Micro</code>, the price was 39.99 RMB a month. Luckily that was the last one. Though I found out that it was not faster than a websocket v2ray proxy running through a Chinese CDN.</p>\n<h2 id="forwarding-the-traffic">Forwarding The Traffic</h2>\n<p>Thank the tutorial for the detailed information.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>\n<p>I reinstalled Debian Stretch so the following steps were done on it.</p>\n<h3 id="step-1-check-if-ipv4ip_forward-is-open">Step 1: Check if <code>ipv4.ip_forward</code> is open</h3>\n<p>Firstly, ensure ip forwarding feature of ipv4 is open.</p>\n<pre><code class="hljs">root<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sysctl net.ipv4.ip_forward\n</code></pre>\n<p>Good to go to the <code>Step 2</code> if the following output is shown:</p>\n<pre><code class="hljs">&gt; net<span class="hljs-selector-class">.ipv4</span><span class="hljs-selector-class">.ip_forward</span> = <span class="hljs-number">1</span>\n</code></pre>\n<p>Otherwise add the option to <code>/etc/sysctl.conf</code>:</p>\n<pre><code class="hljs">root<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>echo <span class="hljs-string">"net.ipv4.ip_forward = 1"</span> &gt;&gt; <span class="hljs-regexp">/etc/sysctl</span>.conf\nroot<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sysctl -p\n</code></pre>\n<h3 id="step-2-add-rules-to-iptables">Step 2: Add rules to iptables</h3>\n<p><code>[the local ip of this server]</code> can be seen from the admin panel of their site.</p>\n<p>Suppose I want to forward a port from the original server to a port with the same number from this server:</p>\n<pre><code class="hljs">root@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A PREROUTING -p tcp --dport [port] -j DNAT --to-destination [original<span class="hljs-built_in"> server </span>ip]\nroot@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A PREROUTING -p udp --dport [port] -j DNAT --to-destination [original<span class="hljs-built_in"> server </span>ip]\nroot@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A POSTROUTING -p tcp -d [original<span class="hljs-built_in"> server </span>ip] --dport [port] -j SNAT --to-source [the local<span class="hljs-built_in"> ip </span>of this server]\nroot@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A POSTROUTING -p udp -d [original<span class="hljs-built_in"> server </span>ip] --dport [port] -j SNAT --to-source [the local<span class="hljs-built_in"> ip </span>of this server]\n</code></pre>\n<p>Suppose I want to forward port 1111 from the original server to port 11111 from this server:</p>\n<pre><code class="hljs">root@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A PREROUTING -p tcp -m tcp --dport 11111 -j DNAT --to-destination [original<span class="hljs-built_in"> server </span>ip]:1111\nroot@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A PREROUTING -p udp -m udp --dport 11111 -j DNAT --to-destination [original<span class="hljs-built_in"> server </span>ip]:1111\nroot@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A POSTROUTING -d [original<span class="hljs-built_in"> server </span>ip] -p tcp -m tcp --dport 1111 -j SNAT --to-source [the local<span class="hljs-built_in"> ip </span>of this server]\nroot@server:~$ iptables -t<span class="hljs-built_in"> nat </span>-A POSTROUTING -d [original<span class="hljs-built_in"> server </span>ip] -p udp -m udp --dport 1111 -j SNAT --to-source [the local<span class="hljs-built_in"> ip </span>of this server]\n</code></pre>\n<h3 id="step-3-apply-the-changes">Step 3: Apply The Changes</h3>\n<pre><code class="hljs">root<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>iptables-save &gt; <span class="hljs-regexp">/etc/iptables</span>.up.rules\nroot<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>iptables-restore &lt; <span class="hljs-regexp">/etc/iptables</span>.up.rules\n</code></pre>\n<h2 id="speed-up-using-bbr">Speed Up Using BBR</h2>\n<p>It’s a must and helpful<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>.</p>\n<p>Install <code>speedtest-cli</code> and test the speed:</p>\n<pre><code class="hljs">root<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>apt install ca-certificates speedtest-cli &amp;&amp; speedtest-cli\n</code></pre>\n<p>Append the needed lines to <code>/etc/sysctl.conf</code>, then reload the changes:</p>\n<pre><code class="hljs">root<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>echo <span class="hljs-string">"net.core.default_qdisc=fq"</span> &gt;&gt; <span class="hljs-regexp">/etc/sysctl</span>.conf\nroot<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>echo <span class="hljs-string">"net.ipv4.tcp_congestion_control=bbr"</span> &gt;&gt; <span class="hljs-regexp">/etc/sysctl</span>.conf\nroot<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sysctl --system\n</code></pre>\n<p>Then test again:</p>\n<pre><code class="hljs">root<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>speedtest-cli\n</code></pre>\n<p>In my test, the download speed went up by around 1 MB/s. It’s only a value. I could feel the change when I was watching Youtube and seeing the debug info.</p>\n<h2 id="create-a-chinese-proxy">Create A Chinese Proxy</h2>\n<p>Since it’s a VPS with a domain with constantly changed <strong>Chinese IP</strong>, it’s possible to create a proxy on with with packages like V2Ray. With the Chinese IP it’s possible to unblock some Chinese-restricted contents like some contents in Bilibili. I think it’s the main use of it.</p>\n<p>I’m gonna skip the <code>How To</code> part here. There are enough tutorials about it. Since I’ve created V2Ray Proxy on servers and <code>git push</code> the config files to Gitlab, I just <code>git pull</code> the files and changed the port and got them into use.</p>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://www.cloudiplc.com/knowledgebase.php?action=displayarticle&amp;id=9">通过iptables实现IP端口数据包转发服务配置</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://www.cyberciti.biz/cloud-computing/increase-your-linux-server-internet-speed-with-tcp-bbr-congestion-control/">Increase your Linux server Internet speed with TCP BBR congestion control</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',i.path="~/contents/Terminal/20190622-cloudiplc-nat.md",d.attributes={title:"Tried ISSO and ......",date:"2016-07-12 01:00",modified:"2019-06-10 15:57",author:e,tags:[y,"CDN",Es,g,Ms,Fs],slug:r,status:a,summary:"WOW......",category:n,published:s},d.html='<div id="series">\n        <p>This post is a part of "<b>My Isso Style</b>" Series.</p>\n        <ol class="parts">\n\t\t\t\t\t<li id="i">\n\t\t\t\t\t<b>Installation</b>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t<a href="/terminal/2019/06/10/my-isso-configuration/">Configuration</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t<a href="/terminal/2019/06/10/inside-the-isso-database/">Inside the Database</a>\n\t\t\t\t\t</li>\n        </ol>\n</div>\n<p>Well, looking back from 2018 and I have got to say, it’s more than light-weight and keeps getting better.</p>\n<p>Now with isso u could send reply notifications to the subcribed commenters and isso officially supports gravatar.</p>\n<p>If u r following the things below, be sure to replace username, domain with ur own.</p>\n<p><strong>Environment:</strong> Debian Stretch, Python 2.7</p>\n<h2 id="installation">Installation</h2>\n<p>Don’t install a python package as root, the python packages in the package manager might be outdated and it might interfere with your globally installed packages.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> (My server running Debian is an example). So it is recommended to use a virtualenv to do it as a non-root user.</p>\n<p>I install isso using git below to make sure it’s up to date so everything in the official documentation<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> takes into effect.</p>\n<ol>\n<li>Switch to the non-root user if u aren’t logged in as it now. For example, I’m logged in as root and want to switch to sim:</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>su sim\n</code></pre>\n<ol start="2">\n<li>Get into the home directory:</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~</span>\n</code></pre>\n<ol start="3">\n<li>Install the relevant packages:</li>\n</ol>\n<pre><code class="hljs">$ sudo apt-<span class="hljs-built_in">get</span> install <span class="hljs-keyword">python</span>-setuptools <span class="hljs-keyword">python</span>-virtualenv <span class="hljs-keyword">python</span>-dev <span class="hljs-keyword">python</span>-pip sqlite3 git build-essential\n</code></pre>\n<ol start="4">\n<li>Install Nvm<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>.</li>\n</ol>\n<pre><code class="hljs">$ git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/creationix/nvm.git .nvm\n</code></pre>\n<ol start="5">\n<li>Open <code>~/.bashrc</code>, ensure the following lines r included in it and save it<sup class="footnote-ref"><a href="#fn3" id="fnref3:1">[3:1]</a></sup>:</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-built_in">export</span> NVM_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm"</span>\n [ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \\. <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span>  <span class="hljs-comment"># This loads nvm</span>\n [ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span> ] &amp;&amp; \\. <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span>  <span class="hljs-comment"># This loads nvm bash_completion</span>\n</code></pre>\n<p>Source it.</p>\n<pre><code class="hljs"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> ~/.bashrc</span>\n</code></pre>\n<ol start="6">\n<li>Install nodejs<sup class="footnote-ref"><a href="#fn3" id="fnref3:2">[3:2]</a></sup>.</li>\n</ol>\n<pre><code class="hljs">$ nvm install <span class="hljs-keyword">node</span>\n<span class="hljs-title"></span></code></pre>\n<ol start="7">\n<li>Install bower.</li>\n</ol>\n<pre><code class="hljs">$ npm <span class="hljs-keyword">install </span>-g <span class="hljs-keyword">bower\n</span></code></pre>\n<ol start="8">\n<li>Set virtualenv in a place.</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>virtualenv work\n</code></pre>\n<ol start="9">\n<li>Get into the environment:</li>\n</ol>\n<pre><code class="hljs">$ <span class="hljs-keyword">source</span> work<span class="hljs-regexp">/bin/</span>activate\n</code></pre>\n<ol start="10">\n<li>Fetch isso from source and install it.</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> https://github.com/posativ/isso.git</span>\n<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> isso</span>\n<span class="hljs-meta">$</span><span class="bash"> python setup.py develop <span class="hljs-comment"># or `install`</span></span>\n<span class="hljs-meta">$</span><span class="bash"> make init</span>\n<span class="hljs-meta">$</span><span class="bash"> npm install -g requirejs uglify-js jade</span>\n<span class="hljs-meta">$</span><span class="bash"> make js</span>\n</code></pre>\n<ol start="11">\n<li>Add a user to run isso exclusively:</li>\n</ol>\n<pre><code class="hljs">$ sudo useradd isso -d /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">isso</span></span>\n</code></pre>\n<ol start="12">\n<li>Make a directory for isso and assign it to the user:</li>\n</ol>\n<pre><code class="hljs">$ sudo mkdir /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">isso</span></span>\n$ sudo chown -R <span class="hljs-symbol">isso:</span>isso /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">isso</span></span>\n</code></pre>\n<ol start="13">\n<li>Now switch to the user:</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>sudo su isso\n</code></pre>\n<ol start="14">\n<li>Get into the directory:</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~</span>\n</code></pre>\n<h2 id="configuration">Configuration</h2>\n<p>Create <code>isso.conf</code>, the host should be ur URL (I only run the blog in SSL version, so in my case, it’s https://snorl.ax):</p>\n<pre><code class="hljs"><span class="hljs-section">[general]</span>\n<span class="hljs-attr">dbpath</span> = /var/lib/isso/comments.db\n<span class="hljs-attr">host</span> = https://snorl.ax/\n<span class="hljs-section">\n[server]</span>\n<span class="hljs-attr">listen</span> = http://localhost:<span class="hljs-number">8001</span>/\n</code></pre>\n<p>For other things like SMTP, reply notification and gravatar, u can refer to <a href="/terminal/2019/06/10/my-isso-configuration/">my config</a></p>\n<p>Exit to come back as the previous user (In my case, <code>sim</code>):</p>\n<pre><code class="hljs">$ <span class="hljs-keyword">exit</span>\n</code></pre>\n<p>Create a symlink to a location in my <code>PATH</code>:</p>\n<pre><code class="hljs">$ sudo ln -s <span class="hljs-meta-keyword">/home/</span>sim<span class="hljs-meta-keyword">/work/</span>bin/isso <span class="hljs-meta-keyword">/usr/</span>local<span class="hljs-meta-keyword">/bin/</span>isso\n</code></pre>\n<p>About Init Script, I’m using Debian which is using systemd, which is most Linux distributions’ choice for service management. Take it for example:</p>\n<p>Create a service <code>/etc/systemd/system/isso.service</code> with the following lines:</p>\n<pre><code class="hljs">[Unit]\nDescription=lightweight Disqus alternative\n\n[Service]\nUser=isso\nExecStart=<span class="hljs-regexp">/usr/local</span><span class="hljs-regexp">/bin/isso</span> -c /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">isso</span>/<span class="hljs-title">isso</span>.<span class="hljs-title">conf</span> <span class="hljs-title">run</span></span>\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>Run the thing and check the status</p>\n<pre><code class="hljs">$ sudo<span class="hljs-keyword"> system</span>ctl daemon-reload &amp;&amp; sudo<span class="hljs-keyword"> system</span>ctl start isso &amp;&amp; sudo<span class="hljs-keyword"> system</span>ctl status isso\n</code></pre>\n<p>When it’s active and running, enable it so it will start and run every time u reboot into the system:</p>\n<pre><code class="hljs">$ sudo systemctl <span class="hljs-builtin-name">enable</span> isso\n</code></pre>\n<h2 id="integrate-into-the-web-server">Integrate into the web server</h2>\n<p>I’m using Nginx, and running it in <code>/isso</code> of my subdomain <code>snorl.ax</code>, so the relevant server block in <code>/etc/nginx/conf.d/default.conf</code> is like this:</p>\n<pre><code class="hljs">server {\n\t<span class="hljs-string">...</span>\n\tserver_name snorl.ax;\n\n\t<span class="hljs-string">...</span>\n\n\tlocation <span class="hljs-string">/isso</span> {\n\tproxy_pass http:<span class="hljs-string">//localhost</span><span class="hljs-function">:8001</span>;\n\tproxy_<span class="hljs-keyword">set</span>_header X-Script-Name <span class="hljs-string">/isso</span>;\n\tproxy_<span class="hljs-keyword">set</span>_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\tproxy_<span class="hljs-keyword">set</span>_header Host $host;\n\tproxy_<span class="hljs-keyword">set</span>_header X-Forwarded-Proto $scheme;\n\t}\n\n\t<span class="hljs-string">...</span>\n\n}\n</code></pre>\n<p>The <code>location /isso</code> block is the things needed to be included.</p>\n<h2 id="insert-into-the-website">Insert into the website</h2>\n<p>The <code>https://isso.snorl.ax/js/embed.min.js</code> should be available.<br>\nTime to insert the code to comment area (If u get a 404 error it’s due to something like the cache settings of ur js files, delete certain lines of it will help):</p>\n<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">data-isso</span>=<span class="hljs-string">"https://isso.snorl.ax/"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://isso.snorl.ax/js/embed.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n\n<span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">id</span>=<span class="hljs-string">“isso-thread”</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>\n</code></pre>\n<p>Now it’s online. Try commenting in the browser. <a href="https://posativ.org/isso/docs/troubleshooting/" target="_blank">Troubleshoot</a> if it fails.</p>\n<h2 id="optional-deploy-with-gevent">[Optional] Deploy with gevent</h2>\n<p>Isso ships with a built-in web server, which is useful for the initial setup and may be used in production for low-traffic sites (up to 20 requests per second). Running a “real” WSGI server supports nice things such as UNIX domain sockets, daemonization and solid HTTP handler while being more stable, secure and web-scale than the built-in web server.<sup class="footnote-ref"><a href="#fn2" id="fnref2:1">[2:1]</a></sup></p>\n<p>Before deployment, edit the relevant part<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> in <code>~/isso/isso/wsgi.py</code>:</p>\n<pre><code class="hljs">...\nfrom werkzeug.wrappers <span class="hljs-keyword">import</span> Response\n...\n<span class="hljs-keyword">if</span> environ.<span class="hljs-keyword">get</span>(<span class="hljs-string">"REQUEST_METHOD"</span>) == <span class="hljs-string">"OPTIONS"</span>:\n    #add_cors_headers(b<span class="hljs-string">"200 Ok"</span>, [(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/plain"</span>)])\n    #<span class="hljs-keyword">return</span> []\n    response = Response(<span class="hljs-string">"Ok"</span>)\n    <span class="hljs-keyword">return</span> response(environ, add_cors_headers)\n...\n</code></pre>\n<p>Get into the environment:</p>\n<pre><code class="hljs"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> ~/work/bin/activate</span>\n</code></pre>\n<h3 id="way-1-gevent">Way 1: gevent</h3>\n<p>It’s the easiest deployment method. <sup class="footnote-ref"><a href="#fn2" id="fnref2:2">[2:2]</a></sup></p>\n<p>Install it.</p>\n<pre><code class="hljs">$ pip <span class="hljs-keyword">install</span> gevent\n</code></pre>\n<p>Run and debug:</p>\n<pre><code class="hljs">$ /usr/local/bin/isso -c /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">isso</span>/<span class="hljs-title">isso</span>.<span class="hljs-title">conf</span> <span class="hljs-title">run</span></span>\n</code></pre>\n<p>If it succeeds, restart the service:</p>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>sudo systemctl restart isso\n</code></pre>\n<h3 id="way-2-uwsgi">Way 2: uWSGI</h3>\n<p>Isso has special support for uWSGI, namely fast IPC caching, job spooling and delayed jobs. It’s isso’s author’s choice as well as my choice, install it:</p>\n<pre><code class="hljs">$ pip <span class="hljs-keyword">install</span> uwsgi\n</code></pre>\n<p>Create <code>/var/lib/isso/uwsgi.ini</code>:</p>\n<pre><code class="hljs"><span class="hljs-section">[uwsgi]</span>\n<span class="hljs-attr">socket</span> = /tmp/isso/%n.sock\n<span class="hljs-attr">master</span> = <span class="hljs-literal">true</span>\n<span class="hljs-attr">chmod-socket</span> = <span class="hljs-number">666</span>\n<span class="hljs-attr">uid</span> = isso\n<span class="hljs-attr">gid</span> = isso\n<span class="hljs-comment">; set to `nproc`</span>\n<span class="hljs-attr">processes</span> = <span class="hljs-number">2</span>\n<span class="hljs-attr">cache2</span> = name=hash,items=<span class="hljs-number">1024</span>,blocksize=<span class="hljs-number">32</span>\n<span class="hljs-comment">; you may change this</span>\n<span class="hljs-attr">spooler</span> = /tmp/isso\n<span class="hljs-attr">module</span> = isso.run\n<span class="hljs-comment">; uncomment if you use a virtual environment</span>\n<span class="hljs-attr">virtualenv</span> = /home/sim/work\n<span class="hljs-attr">env</span> = ISSO_SETTINGS=/var/lib/isso/isso.conf\n<span class="hljs-comment">;</span>\n</code></pre>\n<p>Delete or comment out the listen in the server block in <code>isso.conf</code> as it won’t work:</p>\n<pre><code class="hljs"><span class="hljs-section">[server]</span>\n<span class="hljs-comment">; The listen is now useless</span>\n<span class="hljs-comment">; listen = http://localhost:8001/</span>\n</code></pre>\n<p>Create the directory:</p>\n<pre><code class="hljs">$ mkdir <span class="hljs-regexp">/tmp/</span>isso\n$ chown -R <span class="hljs-string">isso:</span>isso <span class="hljs-regexp">/tmp/</span>isso\n</code></pre>\n<p>I’m using Nginx, and running it in the subdomain <code>/isso</code> of my domain <code>snorl.ax</code>, so the relevant server block in <code>/etc/nginx/conf.d/default.conf</code> is like this:</p>\n<pre><code class="hljs"><span class="hljs-attr">server</span> <span class="hljs-string">{</span>\n\t<span class="hljs-attr">...</span>\n\t<span class="hljs-attr">server_name</span> <span class="hljs-string">snorl.ax;</span>\n\n\t<span class="hljs-attr">...</span>\n\n\t<span class="hljs-attr">location</span> <span class="hljs-string">/isso {</span>\n\t\t<span class="hljs-attr">include</span>         <span class="hljs-string">uwsgi_params;</span>\n\t\t<span class="hljs-attr">uwsgi_pass</span> <span class="hljs-string">unix:/tmp/isso/uwsgi.sock;</span>\n\t\t<span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_X_SCRIPT_NAME /isso;</span>\n\t\t<span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_HOST $host;</span>\n\t<span class="hljs-attr">}</span>\n\n\t<span class="hljs-attr">...</span>\n\n<span class="hljs-attr">}</span>\n</code></pre>\n<p>The <code>location /isso</code> block is the things needed to be included.</p>\n<p>Restart my nginx:</p>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>sudo systemctl restart nginx\n</code></pre>\n<p>Switch to <code>isso</code> user and execute the ini file:</p>\n<pre><code class="hljs">$ /home/sim/work/bin/uwsgi /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">isso</span>/<span class="hljs-title">uwsgi</span>.<span class="hljs-title">ini</span> --<span class="hljs-title">enable</span>-<span class="hljs-title">threads</span></span>\n</code></pre>\n<p>Test and if it works perfectly.</p>\n<p>If everything’s okay, then edit <code>/etc/systemd/system/isso.service</code> and change the line of <code>ExecStart</code>:</p>\n<pre><code class="hljs"><span class="hljs-section">[Unit]</span>\n<span class="hljs-attr">Description</span>=lightweight Disqus alternative\n<span class="hljs-section">\n[Service]</span>\n<span class="hljs-attr">User</span>=isso\n<span class="hljs-attr">ExecStart</span>=/home/sim/work/bin/uwsgi /var/lib/isso/uwsgi.ini --enable-threads\n<span class="hljs-section">\n[Install]</span>\n<span class="hljs-attr">WantedBy</span>=multi-user.target\n</code></pre>\n<p>Run the thing and check the status</p>\n<pre><code class="hljs">$ sudo<span class="hljs-keyword"> system</span>ctl daemon-reload &amp;&amp; sudo<span class="hljs-keyword"> system</span>ctl start isso &amp;&amp; sudo<span class="hljs-keyword"> system</span>ctl status isso\n</code></pre>\n<h2 id="optional-cdn-integration">[Optional] CDN Integration</h2>\n<p>This is not recommended though, at least Cloudflare CDN slows the loading speed globally. I recommend setting loading balancers by myself. Here’s <a href="/terminal/2019/06/08/doing-site-mirroring-with-nginx-on-the-same-domain/">my way to do it</a>.</p>\n<p>I used to use Cloudflare with my isso. Since I ran isso on uwsgi through unix socket without the use of <code>X-Forwarded-For</code>, I could get the commenter’s IP directly from mail with the default configuration. So no need in doing extra config like the following.</p>\n<p>This is not the case with isso running through a TCP/IP port, where the IP from mail is one of the CDN’s IP. So to get the real IP of the commenter’s, extra configuration like following one is needed.</p>\n<p>CloudFlare Tutorial about solution: <a href="https://support.cloudflare.com/hc/en-us/articles/200170706-How-do-I-restore-original-visitor-IP-with-Nginx-" target="_blank">Nginx</a> | <a href="https://support.cloudflare.com/hc/en-us/articles/203656534-How-do-I-restore-original-visitor-IP-with-Apache-2-4-" target="_blank">Apache</a></p>\n<p>I’m using Nginx currently, in the conf the variable <code>X-Forwarded-For</code> is set for showing true IP.</p>\n<ol>\n<li>Edit <code>/etc/nginx/nginx.conf</code>, make sure the <code>http</code> section contains <code>set_real_ip_from</code> field with the IPs of Cloudflare and real_ip_header is set to <code>X-Forwarded-For</code>, just like this:</li>\n</ol>\n<pre><code class="hljs">http {\n...\nset_real_ip_from <span class="hljs-number">103.21</span><span class="hljs-number">.244</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">103.22</span><span class="hljs-number">.200</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">103.31</span><span class="hljs-number">.4</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">104.16</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">12</span>;\nset_real_ip_from <span class="hljs-number">108.162</span><span class="hljs-number">.192</span><span class="hljs-number">.0</span>/<span class="hljs-number">18</span>;\nset_real_ip_from <span class="hljs-number">131.0</span><span class="hljs-number">.72</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">141.101</span><span class="hljs-number">.64</span><span class="hljs-number">.0</span>/<span class="hljs-number">18</span>;\nset_real_ip_from <span class="hljs-number">162.158</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">15</span>;\nset_real_ip_from <span class="hljs-number">172.64</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">13</span>;\nset_real_ip_from <span class="hljs-number">173.245</span><span class="hljs-number">.48</span><span class="hljs-number">.0</span>/<span class="hljs-number">20</span>;\nset_real_ip_from <span class="hljs-number">188.114</span><span class="hljs-number">.96</span><span class="hljs-number">.0</span>/<span class="hljs-number">20</span>;\nset_real_ip_from <span class="hljs-number">190.93</span><span class="hljs-number">.240</span><span class="hljs-number">.0</span>/<span class="hljs-number">20</span>;\nset_real_ip_from <span class="hljs-number">197.234</span><span class="hljs-number">.240</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">198.41</span><span class="hljs-number">.128</span><span class="hljs-number">.0</span>/<span class="hljs-number">17</span>;\n\nreal_ip_header X-Forwarded-For;\n...\n}\n</code></pre>\n<p>If ur Nginx supports ipv6, try the following:</p>\n<pre><code class="hljs">http {\n...\nset_real_ip_from <span class="hljs-number">103.21</span><span class="hljs-number">.244</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">103.22</span><span class="hljs-number">.200</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">103.31</span><span class="hljs-number">.4</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">104.16</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">12</span>;\nset_real_ip_from <span class="hljs-number">108.162</span><span class="hljs-number">.192</span><span class="hljs-number">.0</span>/<span class="hljs-number">18</span>;\nset_real_ip_from <span class="hljs-number">131.0</span><span class="hljs-number">.72</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">141.101</span><span class="hljs-number">.64</span><span class="hljs-number">.0</span>/<span class="hljs-number">18</span>;\nset_real_ip_from <span class="hljs-number">162.158</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">15</span>;\nset_real_ip_from <span class="hljs-number">172.64</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">13</span>;\nset_real_ip_from <span class="hljs-number">173.245</span><span class="hljs-number">.48</span><span class="hljs-number">.0</span>/<span class="hljs-number">20</span>;\nset_real_ip_from <span class="hljs-number">188.114</span><span class="hljs-number">.96</span><span class="hljs-number">.0</span>/<span class="hljs-number">20</span>;\nset_real_ip_from <span class="hljs-number">190.93</span><span class="hljs-number">.240</span><span class="hljs-number">.0</span>/<span class="hljs-number">20</span>;\nset_real_ip_from <span class="hljs-number">197.234</span><span class="hljs-number">.240</span><span class="hljs-number">.0</span>/<span class="hljs-number">22</span>;\nset_real_ip_from <span class="hljs-number">198.41</span><span class="hljs-number">.128</span><span class="hljs-number">.0</span>/<span class="hljs-number">17</span>;\nset_real_ip_from <span class="hljs-number">2400</span>:cb00::/<span class="hljs-number">32</span>;\nset_real_ip_from <span class="hljs-number">2606</span>:<span class="hljs-number">4700</span>::/<span class="hljs-number">32</span>;\nset_real_ip_from <span class="hljs-number">2803</span>:f800::/<span class="hljs-number">32</span>;\nset_real_ip_from <span class="hljs-number">2405</span>:b500::/<span class="hljs-number">32</span>;\nset_real_ip_from <span class="hljs-number">2405</span>:<span class="hljs-number">8100</span>::/<span class="hljs-number">32</span>;\nset_real_ip_from <span class="hljs-number">2</span>c0f:f248::/<span class="hljs-number">32</span>;\nset_real_ip_from <span class="hljs-number">2</span>a06:<span class="hljs-number">98</span>c0::/<span class="hljs-number">29</span>;\n\nreal_ip_header X-Forwarded-For;\n...\n}\n</code></pre>\n<p>Notes that the CloudFlare IPs above were up to date when I modified the article, check for urself. If u use another CDN or find that any of the CloudFlare IPs outdated, replace the IPs with the correct ones.</p>\n<ol start="3">\n<li>Refresh and try commenting. The IP in the mail turns out to be the true IP of the commenter.</li>\n</ol>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://workaround.org/easy-install-debian">Why you should not use Python’s easy_install carelessly on Debian</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://posativ.org/isso/docs/">Isso Official Documentation</a> <a href="#fnref2" class="footnote-backref">↩︎</a> <a href="#fnref2:1" class="footnote-backref">↩︎</a> <a href="#fnref2:2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn3" class="footnote-item"><p><a href="https://www.npmjs.com/get-npm">How to install Npm</a> <a href="#fnref3" class="footnote-backref">↩︎</a> <a href="#fnref3:1" class="footnote-backref">↩︎</a> <a href="#fnref3:2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn4" class="footnote-item"><p><a href="https://github.com/posativ/isso/issues/347#issuecomment-347906155">Isso Forces CORS Preflight but is unable to handle CORS Preflight requests</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',d.path="~/contents/Terminal/20160712-start-to-use-isso.md",m.attributes={title:"Doing site mirroring with nginx on the same domain",date:"2019-06-08 22:08",modified:"2019-06-18 17:47",author:e,tags:[g,Ps,qs,cs],status:a,summary:"Hmm, found a way to do that.",category:n,published:s},m.html='<p>Since I have got two differnt servers (one in Finland, one in Los Angeles) I wanna load balance my site using nginx.</p>\n<h2 id="basic-settings">Basic settings</h2>\n<p>I don’t recommend proxying static files. Instead, upload the files to both servers and serve them directly from each server. (<a href="/terminal/2019/06/07/git-an-excellent-file-transferer/">My method of doing this</a> In this way no need in putting up with the latency from fetching files…</p>\n<p>The way here only applies to a backend needing updating dynamically.</p>\n<p>Having been searching a long way, I’ve found that it’s viable via a port.</p>\n<p><code>/etc/nginx/conf.d/default.conf</code>:</p>\n<pre><code class="hljs"><span class="hljs-attr">server</span> <span class="hljs-string">{</span>\n  <span class="hljs-attr">listen</span> <span class="hljs-string">443 ssl http2;</span>\n  <span class="hljs-attr">server_name</span> <span class="hljs-string">snorl.ax;</span>\n  <span class="hljs-attr">...site-configurations...</span>\n<span class="hljs-attr">}</span>\n</code></pre>\n<p>I could separate it into two parts, for example I’m gonna use port 123 on the main server:</p>\n<pre><code class="hljs"><span class="hljs-attr">server</span> <span class="hljs-string">{</span>\n  <span class="hljs-attr">listen</span> <span class="hljs-string">123;</span>\n  <span class="hljs-attr">server_name</span> <span class="hljs-string">_;</span>\n  <span class="hljs-attr">if</span> <span class="hljs-string">($host !~ snorl.ax) {</span>\n    <span class="hljs-attr">return</span> <span class="hljs-string">444;</span>\n  <span class="hljs-attr">}</span>\n  <span class="hljs-attr">if</span> <span class="hljs-string">($http_custom !~ acustomheader) {</span>\n    <span class="hljs-attr">return</span> <span class="hljs-string">444;</span>\n  <span class="hljs-attr">}</span>\n  <span class="hljs-meta">...site-configurations,</span> <span class="hljs-string">use $host variable where I originally use $server_name...</span>\n  <span class="hljs-attr">location</span> <span class="hljs-string">^~ /isso {</span>\n    <span class="hljs-attr">include</span>         <span class="hljs-string">uwsgi_params;</span>\n    <span class="hljs-attr">uwsgi_pass</span> <span class="hljs-string">unix:///tmp/isso/uwsgi.sock;</span>\n    <span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_X_SCRIPT_NAME /isso;</span>\n    <span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_HOST $host;</span>\n    <span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_X_REAL_IP $http_x_real_ip;</span>\n  <span class="hljs-attr">}</span>\n<span class="hljs-attr">}</span>\n\n<span class="hljs-attr">server</span> <span class="hljs-string">{</span>\n  <span class="hljs-attr">listen</span> <span class="hljs-string">443 ssl http2;</span>\n  <span class="hljs-attr">server_name</span> <span class="hljs-string">snorl.ax;</span>\n\n  <span class="hljs-attr">location</span> <span class="hljs-string">^~ / {</span>\n    <span class="hljs-attr">proxy_pass</span> <span class="hljs-string">http://localhost:123;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Host $host;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">X-Forwarded-For $proxy_add_x_forwarded_for;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">X-Forwarded-Proto $scheme;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Custom acustomheader;</span>\n  <span class="hljs-attr">}</span>\n\n  <span class="hljs-attr">location</span> <span class="hljs-string">^~ /isso {</span>\n    <span class="hljs-attr">uwsgi_pass</span> <span class="hljs-string">unix:///tmp/isso/uwsgi.sock;</span>\n    <span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_X_SCRIPT_NAME /isso;</span>\n    <span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_HOST $host;</span>\n    <span class="hljs-attr">uwsgi_param</span> <span class="hljs-string">HTTP_X_FORWARDED_FOR $proxy_add_x_forwarded_for;</span>\n    <span class="hljs-attr">include</span>         <span class="hljs-string">uwsgi_params;</span>\n  <span class="hljs-attr">}</span>\n\n<span class="hljs-attr">}</span>\n</code></pre>\n<p>The <code>^~</code> ensures that the static files are loaded correctly<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p>\n<p>The two <code>if</code><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> blocks ensure the <code>Host</code> header received<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> is <code>snorl.ax</code> and <code>Custom</code> is <code>acustomheader</code>. Otherwise the server will return an error page, denying the further access.</p>\n<p><code>X-Forwarded-For</code> is useful when it comes to the true IP of the client. Be sure to include the lines in the http block in <code>/etc/nginx/nginx.conf</code> on the main server:</p>\n<pre><code class="hljs"><span class="hljs-attr">http</span> <span class="hljs-string">{</span>\n  <span class="hljs-attr">...</span>\n  <span class="hljs-attr">set_real_ip_from</span> <span class="hljs-string">the_second_server_ip;</span>\n  <span class="hljs-attr">real_ip_header</span> <span class="hljs-string">X-Forwrded-For;</span>\n<span class="hljs-attr">}</span>\n</code></pre>\n<p>Be sure to include this in <code>/etc/nginx/nginx.conf</code> in the http block:</p>\n<pre><code class="hljs">http {\n  <span class="hljs-string">...</span>\n  port_in_redirect off;\n  <span class="hljs-string">...</span>\n}\n</code></pre>\n<p>Thus it’ll support adding a trailing slash through proxy_pass if there’s none, without redirecting the user to a url like <code>url:port/uri</code>.<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p>\n<p>Then reload on this server:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo systemctl reload nginx\n</code></pre>\n<p><code>/etc/nginx/conf.d/default.conf</code> on the second server:</p>\n<pre><code class="hljs"><span class="hljs-section">server</span> {\n  <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;\n  <span class="hljs-attribute">server_name</span> snorl.ax;\n\n  <span class="hljs-attribute">location</span><span class="hljs-regexp"> ^~</span> / {\n    <span class="hljs-attribute">proxy_pass</span> http://external_ip_of_main:123;\n    <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;\n    <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;\n    <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;\n    <span class="hljs-attribute">proxy_set_header</span> Custom acustomheader;\n  }\n}\n</code></pre>\n<p>It is allowed to proxy the the apps like isso in the first server block of the first server on this server. As I said above, <code>X-Forwarded-For</code> is useful when it comes to the true IP of the client.</p>\n<p><code>X-Forwarded-Proto</code> make the scheme the same with the proxy frontend (In this case, it’s <code>https</code> rather than the <code>http</code> of the backend).</p>\n<p>Be sure to include this in <code>/etc/nginx/nginx.conf</code> in the http block as well for the same reason above:</p>\n<pre><code class="hljs">http {\n  <span class="hljs-string">...</span>\n  port_in_redirect off;\n  <span class="hljs-string">...</span>\n}\n</code></pre>\n<p>Reload on this server:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo systemctl reload nginx\n</code></pre>\n<h2 id="proxy_cache-for-them"><code>proxy_cache</code> for them</h2>\n<p>This could improve site performance a lot if many static files from the backend need proxying. However as I said before, it’s recommended to upload the files to both servers and serve them directly from each server. Files from the same server can be more easy to control and enjoy features like <code>brotli_static</code>. So in a way <code>proxy_cache</code> kinda sucks for static files in my opinion.</p>\n<p>For example, on the second server, I want to use cache for the paths other than <code>/isso</code> with longer caching expiration period for <code>/img</code> folder, my settings will be like this:</p>\n<pre><code class="hljs"><span class="hljs-attr">proxy_cache_path</span>  <span class="hljs-string">/etc/nginx/cache  levels=1:2    keys_zone=snorlax:10m</span>\n<span class="hljs-attr">inactive</span>=<span class="hljs-string">24h  max_size=1g;</span>\n<span class="hljs-attr">server</span> <span class="hljs-string">{</span>\n  <span class="hljs-attr">...</span>\n  <span class="hljs-attr">server_name</span> <span class="hljs-string">snorl.ax;</span>\n  <span class="hljs-attr">...</span>\n<span class="hljs-comment"># Default: expires in 1 hour</span>\n<span class="hljs-attr">location</span> <span class="hljs-string">^~ / {</span>\n    <span class="hljs-attr">proxy_pass</span> <span class="hljs-string">http://external_ip_of_main:123;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Host $host;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Custom acustomheader;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">X-Forwarded-For $proxy_add_x_forwarded_for;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">X-Forwarded-Proto $scheme;</span>\n    <span class="hljs-attr">proxy_buffering</span>        <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache_revalidate</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache</span>            <span class="hljs-string">snorlax;</span>\n    <span class="hljs-attr">proxy_cache_valid</span>      <span class="hljs-string">200  1h;</span>\n    <span class="hljs-attr">proxy_cache_use_stale</span>  <span class="hljs-string">error timeout invalid_header updating</span>\n                           <span class="hljs-attr">http_500</span> <span class="hljs-string">http_502 http_503 http_504;</span>\n    <span class="hljs-attr">proxy_cache_background_update</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache_lock</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">add_header</span> <span class="hljs-string">X-Cache-Status $upstream_cache_status;</span>\n\n<span class="hljs-attr">}</span>\n<span class="hljs-comment">\n# /isso path: Micro-caching for faster speed and less loads on the origin</span>\n<span class="hljs-attr">location</span> <span class="hljs-string">^~ /isso {</span>\n    <span class="hljs-attr">proxy_pass</span> <span class="hljs-string">http://external_ip_of_main:123;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Host $host;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Custom acustomheader;</span>\n    <span class="hljs-attr">proxy_buffering</span>        <span class="hljs-string">off;</span>\n    <span class="hljs-attr">proxy_cache_revalidate</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache</span>            <span class="hljs-string">snorlax;</span>\n    <span class="hljs-attr">proxy_cache_valid</span>      <span class="hljs-string">200 404 1s;</span>\n    <span class="hljs-attr">proxy_cache_use_stale</span>  <span class="hljs-string">updating;</span>\n    <span class="hljs-attr">proxy_cache_background_update</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache_lock</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Host $host;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">X-Forwarded-For $proxy_add_x_forwarded_for;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">X-Forwarded-Proto $scheme;</span>\n<span class="hljs-attr">}</span>\n<span class="hljs-comment">\n# /img path: expires in 1 year.</span>\n\n<span class="hljs-attr">location</span> <span class="hljs-string">^~ /img {</span>\n    <span class="hljs-attr">proxy_pass</span> <span class="hljs-string">http://external_ip_of_main:123;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Host $host;</span>\n    <span class="hljs-attr">proxy_set_header</span> <span class="hljs-string">Custom acustomheader;</span>\n    <span class="hljs-attr">proxy_buffering</span>        <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache_revalidate</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache</span>            <span class="hljs-string">snorlax;</span>\n    <span class="hljs-attr">proxy_cache_valid</span>      <span class="hljs-string">200  1y;</span>\n    <span class="hljs-attr">proxy_cache_use_stale</span>  <span class="hljs-string">error timeout invalid_header updating</span>\n                           <span class="hljs-attr">http_500</span> <span class="hljs-string">http_502 http_503 http_504;</span>\n    <span class="hljs-attr">proxy_cache_background_update</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">proxy_cache_lock</span> <span class="hljs-string">on;</span>\n    <span class="hljs-attr">add_header</span> <span class="hljs-string">X-Cache-Status $upstream_cache_status;</span>\n<span class="hljs-attr">}</span>\n<span class="hljs-attr">...</span>\n<span class="hljs-attr">}</span>\n</code></pre>\n<p>For the details about these settings, check the official guide<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>.</p>\n<p>Then create a directory for it and reload:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo mkdir /etc/nginx/cache\nsim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo chown -R <span class="hljs-symbol">nginx:</span>nginx /etc/nginx/cache\nsim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo systemctl reload nginx\n</code></pre>\n<h2 id="load-balancing-the-servers">Load Balancing the servers</h2>\n<p>Two choices for it: Load Balancer CNAME, GeoDNS.</p>\n<h3 id="load-balancer-cname">Load Balancer CNAME</h3>\n<p>Cloudflare has this and charges it for at least 5 dollars a month just for subscription fee. Then they will charge according to the bandwidth usage.</p>\n<p>Another choice<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup> is a free alternative <a href="https://perfops.net/">PerfOps</a>. I highly recommend this. Their free tier usage (100,000,000  Queries, 3 FlexBalancers) can be good enough. I added answers to various locations according to the result of the App Synthetic Monitor Ping Tool<sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup>. I have to say, works like a charm.</p>\n<h3 id="geodns">GeoDNS</h3>\n<p>However CNAME have its shortages:</p>\n<ol>\n<li>They could be slower than A records.</li>\n<li>Root CNAME Flattening is not that accurate.</li>\n</ol>\n<p>That’s where GeoDNS comes in, with which there’s no need in resolving a hostname into an IP, adding an additional request.</p>\n<p><a href="https://ns1.com/">NS1</a> has a free tier with a limit of 500,000 queries, 50 Records. So it’s my go-to solution for load balancing. I’m waiting for DNS propagation to complete. But it’s not cost-efficient when overages are billed at $8/million queries.</p>\n<p><a href="https://aws.amazon.com/route53/pricing/">Route53</a> is cost-efficient and charges for $1.2 a month if the domain uses their GeoDNS and has 1 million DNS queries. So once I have more than 500,000 queries I will switch to this.</p>\n<p><strong>A Note:</strong> I followed nginxconfig.io<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup> to enhance and simplify my nginx config. After doing that, I found TLS speed was slow, the lines of the nginx config from letsencrypt helped and boosted the TLS speed greatly:</p>\n<pre><code class="hljs"><span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="hljs-comment"># generated by Certbot when their nginx plugin is used</span>\n\n<span class="hljs-comment"># The two lines below are from their config /etc/letsencrypt/options-ssl-nginx.conf</span>\n<span class="hljs-attribute">ssl_session_cache</span> shared:le_nginx_SSL:<span class="hljs-number">50m</span>; <span class="hljs-comment"># I modified the original 1m to 50m</span>\n<span class="hljs-attribute">ssl_ciphers</span> <span class="hljs-string">"ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS"</span>;\n</code></pre>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://stackoverflow.com/questions/25187817/nginx-reverse-proxy-images-and-css-are-not-loaded/35065881#35065881">nginx reverse proxy images and css are not loaded - Stack Overflow</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if">conditional within an “if” in Nginx | DigitalOcean</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn3" class="footnote-item"><p><a href="https://stackoverflow.com/questions/18970620/nginx-reject-request-if-header-is-not-present-or-wrong/18972508#18972508">Nginx: Reject request if header is not present or wrong - Stack Overflow</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn4" class="footnote-item"><p><a href="https://forum.nginx.org/read.php?2,234131,234141">Re: nginx add trailing slash</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn5" class="footnote-item"><p><a href="https://www.nginx.com/blog/nginx-caching-guide/">A Guide to Caching with NGINX and NGINX Plus - NGINX</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn6" class="footnote-item"><p><a href="https://www.reddit.com/r/sysadmin/comments/by6lnh/how_to_make_an_a_record_load_balancer_with_haproxy/eqdiyib/">How to make an A record load balancer with HAProxy? : sysadmin</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn7" class="footnote-item"><p><a href="https://asm.ca.com/en/ping.php">CA App Synthetic Monitor website monitoring service - Ping - IPv6 now supported, give it a shot!</a> <a href="#fnref7" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn8" class="footnote-item"><p><a href="https://nginxconfig.io/">nginxconfig.io</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',m.path="~/contents/Terminal/20190608-nginx-mirror.md",f.attributes={title:"Permission issues with dovecot stats-writer",date:"2019-07-11 17:00",author:e,tags:[G,W,C,I,U],status:a,summary:"Today I encountered an error when trying to receive new messages from my mailbox.",category:n,published:s},f.html='<p><strong>Env:</strong> Debian 10</p>\n<p>Today I encountered an error when trying to receive new messages from my mailbox.<br>\nThen I checked <code>/var/log/mail.log</code> and found this:</p>\n<pre><code class="hljs language-ini">Jul 11 10:54:00 mail postfix/pipe[27149]: 0A3FBDBE26: to=&lt;xxx@snorl.ax&gt;, orig_to=&lt;sim@snorl.ax&gt;, relay=spamassassin, delay=1.4, delays=0.45/0.02/0/0.98, dsn=2.0.0, status=sent (delivered via spamassassin service (lda(xxx@snorl.ax,)Error: net_connect_unix(/var/run/dovecot/stats-writer) failed: Permission denied))\n</code></pre>\n<p>I googled and found this solution<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> work well. Just append the following settings to <code>/etc/dovecot/dovecot.conf</code>:</p>\n<pre><code class="hljs language-ini">service stats {\n    unix_listener stats-reader {\n        user = vmail\n        group = vmail\n        mode = 0660\n    }\n\n    unix_listener stats-writer {\n        user = vmail\n        group = vmail\n        mode = 0660\n    }\n}\n</code></pre>\n<p>Then restart dovecot:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@mail</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo systemctl restart dovecot\n</code></pre>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://forum.iredmail.org/post67035.html#p67035">net_connect_unix(/var/run/dovecot/stats-writer) failed (Page 1) — iRedMail Support — iRedMail</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',f.path="~/contents/Terminal/20190711-dovecot-permission.md",b.attributes={title:"Updated to Debian Buster",date:"2019-06-17 13:30",modified:"2019-08-05 17:49",author:e,tags:[I,"Buster",ds,C],status:a,summary:"Some packages changed and needed some changes.",category:n,published:s},b.html='<h2 id="update-to-debian-buster">Update To Debian Buster</h2>\n<p><code>/etc/apt/sources.list</code>:</p>\n<pre><code class="hljs">deb http:<span class="hljs-regexp">//</span>debian-mirror.westus.cloudapp.azure.com<span class="hljs-regexp">/debian/</span> buster main\ndeb-src http:<span class="hljs-regexp">//</span>debian-mirror.westus.cloudapp.azure.com<span class="hljs-regexp">/debian/</span> buster main\n\ndeb http:<span class="hljs-regexp">//</span>security.debian.org<span class="hljs-regexp">/ buster/u</span>pdates main\ndeb-src http:<span class="hljs-regexp">//</span>security.debian.org<span class="hljs-regexp">/ buster/u</span>pdates main\n\ndeb http:<span class="hljs-regexp">//</span>debian-mirror.westus.cloudapp.azure.com<span class="hljs-regexp">/debian/</span> buster-backports main\n\ndeb http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/packages/m</span>ainline<span class="hljs-regexp">/debian/</span> buster nginx\ndeb-src http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/packages/m</span>ainline<span class="hljs-regexp">/debian/</span> buster nginx\n\ndeb http:<span class="hljs-regexp">//</span>debian-mirror.westus.cloudapp.azure.com<span class="hljs-regexp">/debian/</span> buster-updates main\ndeb-src http:<span class="hljs-regexp">//</span>debian-mirror.westus.cloudapp.azure.com<span class="hljs-regexp">/debian/</span> buster-updates main\n</code></pre>\n<p>In the configuration file above I replaced <code>stretch</code> with buster.</p>\n<p>In my case I found files in <code>/etc/apt/sources.list.d/</code> too so I did similar changes there.</p>\n<p>Then upgrade:</p>\n<pre><code class="hljs">sim@server:~$ sudo apt update &amp;&amp; sudo apt<span class="hljs-built_in"> upgrade </span>&amp;&amp; sudo apt dist-upgrade\n</code></pre>\n<p>Answer to the prompts in the process. Then it’s done.</p>\n<h2 id="dovecot-dh-key-too-small">Dovecot: dh key too small</h2>\n<p>Upon update, I can’t log in to my imap anymore with the following log:</p>\n<pre><code class="hljs">Jun 17 06:37:01<span class="hljs-built_in"> server </span>dovecot: imap-login: Error: Failed <span class="hljs-keyword">to</span> initialize SSL<span class="hljs-built_in"> server </span>context: Can<span class="hljs-string">\'t load DH parameters: error:1408518A:SSL routines:ssl3_ctx_ctrl:dh key too small: user=&lt;&gt;, rip=*.*.*.*, lip=*.*.*.*, session=&lt;eUofjH2LSO2wer5W&gt;\n</span></code></pre>\n<p>It’s because from version 2.3 I must specify path to DH parameters file using<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>:</p>\n<pre><code class="hljs"><span class="hljs-attr">ssl_dh</span>=&lt;/path/to/dh.pem\n</code></pre>\n<p>So to resolve this:</p>\n<pre><code class="hljs"><span class="hljs-symbol">sim@</span>server:~$ su\n<span class="hljs-symbol">root@</span>server:~$ openssl dhparam <span class="hljs-number">4096</span> &gt; /var/mail/dh.pem\n</code></pre>\n<p>In <code>/etc/dovecot/conf.d/10-ssl.conf</code>, specidy this:</p>\n<pre><code class="hljs"><span class="hljs-built_in">..</span>.\n<span class="hljs-attribute">ssl_dh</span>=&lt;/var/mail/dh.pem\n<span class="hljs-built_in">..</span>.\n</code></pre>\n<p>Specifying this is recommended as well:</p>\n<pre><code class="hljs"><span class="hljs-built_in">..</span>.\n<span class="hljs-attribute">ssl_prefer_server_ciphers</span>=<span class="hljs-literal">yes</span>\n<span class="hljs-built_in">..</span>.\n</code></pre>\n<p>Then restart:</p>\n<pre><code class="hljs">root<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>systemctl restart dovecot\n</code></pre>\n<p>Now I’m able to log in to my imap again.</p>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://wiki.dovecot.org/SSL/DovecotConfiguration">SSL/DovecotConfiguration - Dovecot Wiki</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',b.path="~/contents/Terminal/20190617-updated-to-buster.md",v.attributes={title:"Refresh The Browser",date:"2019-05-10 12:57",author:e,tags:[Ks,y,ys,ws],summary:"Time to refresh the browser.",category:x,published:s},v.html='<p>Uh, it’s half a year or so since I last updated the Browser. I’ve done many things actually, regardless of essentiality. Here are some of them:</p>\n<ol>\n<li>Watched “The Meg”, “Mission: Impossible – Fallout”, “Spider-Man: Into the Spider-Verse”. All of them are fierce. The third is the warmest among them. The most scary one is the first, where the meg is definitely a nightmire. About the second, I have got to say, Tom Cruise is so capable of jumping…</li>\n<li>Uploaded some recordings about games Pokemon Red Rescue Team<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> and Pokemon Magikarp Jump<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> to Youtube. I just uploaded three and they can be seen from my Twitter. I have to do some uploads \'cause my home partition is low on space.<br>\n<img src="/img/posts/home_low.png" alt="My home partition is low on space."></li>\n<li>Made a pull request to isso. The pull request<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> is about customize the mail it sends to users and the admin address. With the branch, the language of the default template and the <code>&quot;Anonymous&quot;</code> can be set. Also, the mail format can be changed to <code>multipart</code>, with both <code>plain</code> and <code>html</code> part. The reviser has somewhat not replied for a while. You are welcome to try it and provide the templates (html and plain) of the language that has not been provided. Any fixes or feedbacks are also welcome.</li>\n<li>Migrated the site from Github pages to Firebase<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>. They are both using Fstly while the latter allows many other things like 301 redirect, cache settings. Meanwhile I have also learned more about how to use markdown. Most of the time they just get the job easily done. Maybe I’ll make use of the Firebase Function once I’ve learned YDKJS once?</li>\n<li>Revived my suspended Twitter account. And now I take notes more frequently on it.</li>\n<li>Started to run email services on my server<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>.</li>\n</ol>\n<p>In the future, my plan:</p>\n<ol>\n<li>My Shuffle plan<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup><sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup><sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup><sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup>, might change. I might upload some about Pokemon Shuffle in the future. As a newbie who started farming several weeks ago when Winking Turtwig was around, I’m now shuffling everyday.</li>\n<li>Learn JS and do something on Firebase…</li>\n<li>Meanwhile, keep the site updated.</li>\n</ol>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://www.youtube.com/watch?v=40EzmRyRljQ&amp;list=PL4K_wymbiyCHtuvN_Mem1E6R-Qc1AnY3S">My Journey in Pokemon Red Rescue Team - Youtube</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://www.youtube.com/watch?v=8__hr6kYR2c&amp;list=PL4K_wymbiyCHRs4bXpElzIFagD50gJ0K4">My Journey in Pokemon Magikarp Jump - Youtube</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn3" class="footnote-item"><p><a href="https://github.com/posativ/isso/pull/518">Email Notification Customization by SnorlaxYum · Pull Request #518 · posativ/isso</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn4" class="footnote-item"><p><a href="/terminal/2016/12/08/site-migration-history/">Site Migration History - Terminal In A Simputer</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn5" class="footnote-item"><p><a href="/terminal/2018/12/27/running-email-service-on-my-own-server/">Running email service on my own server! - Terminal In A Simputer</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn6" class="footnote-item"><p><a href="https://twitter.com/Snorl_ax/status/1126279265907929088">Shuffle Plan - Week 17~18</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn7" class="footnote-item"><p><a href="https://twitter.com/Snorl_ax/status/1126279978381799424">Shuffle Plan - Week 19~20</a> <a href="#fnref7" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn8" class="footnote-item"><p><a href="https://twitter.com/Snorl_ax/status/1126281922022232064">Shuffle Plan - Week 21~22</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn9" class="footnote-item"><p><a href="https://twitter.com/Snorl_ax/status/1126285456520278016">Shuffle Plan - Week 22~23</a> <a href="#fnref9" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',v.path="~/contents/Browser/20190510-refresh-the-browser.md",_.attributes={title:"Mania in Shanghai",date:"2018-05-02 23:02",tags:[As,Ns,"Tour",oe],authors:e,summary:"Heat in a windy night!",ogimage:"/images/og/fobmania-tour-twitter.png",category:x,published:s},_.html='<ol>\n<li>Pheonix</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/FiNnd1YLJKM" frameborder="0"></iframe>  \n<p>Passionate start!😋</p>\n<ol start="2">\n<li>Irresistable</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/gs9bmQ_6Rf0" frameborder="0"></iframe>  \n<ol start="3">\n<li>Sugar, we’re goin’ down</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/C90WfVq8Slw" frameborder="0"></iframe>  \n<ol start="4">\n<li>Immortals</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/SDH7aVU99Do" frameborder="0"></iframe>  \n<ol start="5">\n<li>Young Volcanos</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/QWpgItMA4Ik" frameborder="0"></iframe>  \n<ol start="6">\n<li>Ameican Beauty / American Psycho</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/aJA62hkbgdw" frameborder="0"></iframe>  \n<ol start="7">\n<li>The kids ain’t alright</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/-cKyAhQff-E" frameborder="0"></iframe>  \n<ol start="8">\n<li>Centuries</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/CPzZ81TYXj0" frameborder="0"></iframe>  \n<ol start="9">\n<li>The Last Of The Real Ones</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/XKEH9XjTFzk" frameborder="0"></iframe>  \n<ol start="10">\n<li>Young And Menace</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/XesIinRdXlE" frameborder="0"></iframe>  \n<p>This time he gave up on trying that electro part!😆 Well done!</p>\n<ol start="11">\n<li>Dance, dance</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/62vbb4zBgpg" frameborder="0"></iframe>  \n<ol start="12">\n<li>Wilson (Expensive Mistakes)</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/0V0efLK32bU" frameborder="0"></iframe>  \n<p>One of my favourites in the mania album! I’ll stop wearing black when they make darker color~</p>\n<ol start="13">\n<li>Jet Pack Blue</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/D8MJa1EmOo8" frameborder="0"></iframe>  \n<ol start="14">\n<li>This Ain’t The Scene</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/eyc6c_TbAUw" frameborder="0"></iframe>  \n<ol start="15">\n<li>Hold Me Tight Or Don’t</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/EsnhEsMZWkE" frameborder="0"></iframe>  \n<p>One of my favourites in the mania album! Hold me tight!😃</p>\n<ol start="16">\n<li>Where Is Your Boy</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/W-QVUrIJpd4" frameborder="0"></iframe>  \n<p>Nice try before singing🤣Oldie but still goodie!</p>\n<ol start="17">\n<li>Thnks fr th mmrs</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/Vke-We29xx8" frameborder="0"></iframe>  \n<p>Thnks fr th mmrs!🤗</p>\n<ol start="18">\n<li>Champion</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/ZGGtlGlLpcM" frameborder="0"></iframe>  \n<p>They took a break for a while after this song.</p>\n<ol start="19">\n<li>Uma Thurman</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/rspRyRIvyAk" frameborder="0"></iframe>  \n<ol start="20">\n<li>Light \'Em Up</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/SZ9FvwPuqa0" frameborder="0"></iframe>  \n<p>The camera dimmed their torchlights. It was much brighter on the scene!🤠</p>\n<ol start="21">\n<li>Saturday</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/GyAoU5dsQLI" frameborder="0"></iframe>    \n<p>The show is really impressive with Patrick’s powerful voice and the music part of Andy, Pete and Joe’s.<br>\nThe hit album <strong>AB/AP</strong> is not my piece of cake. But it’s not bad to hear the track <strong>Uma Thurman</strong> from it.<br>\nIt ended with <strong>Saturday</strong>. It’s really a pity that they didn’t play <strong>What A Catch, Donnie</strong> or any other songs from <strong>Folie à Deux</strong>. That is a really awesome and underrated album, in a way, better than their reunion hit album <strong>Save Rock And Roll</strong>.</p>\n',_.path="~/contents/Browser/20180502-mania-in-shanghai.md",T.attributes={title:"Just switched to nuxt",date:"2019-11-17 20:49",author:e,tags:[is,"Vue",Os],status:a,summary:"Just started my first frontend developer job as an intern worker. And to learn vue better, I rewrote my blog using nuxt.",category:n,published:s},T.html='<p>The blog is now powered by nuxt.js, I just posted the source code on <a href="https://github.com/SnorlaxYum/Simputer">Github</a><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p>\n<h2 id="populate-vuex-store-with-posts">Populate Vuex store with posts</h2>\n<p>Thanks to hmsk’s plugin<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>, I could write my posts in markdown and process it really efficiently. However to use the posts across several pages like Tag or Category it’s a must to populate Vuex Store with them. The implementation is in my source code. To sort the posts or tags by a certain standard, I have to save them to <code>Map</code>, then define the behaviour of its iterator.</p>\n<h2 id="abandon-embedminjs-from-isso">Abandon embed.min.js from isso</h2>\n<p>I already abandoned it since I can do the same thing with <code>axios</code> with my own styles. The implementation is in my source code<sup class="footnote-ref"><a href="#fn1" id="fnref1:1">[1:1]</a></sup>.<br>\nWith <code>axios</code> we could also interact with commenting systems like <code>Discus</code> with our own styles, which can be a cool solution of serverless commenting.<br>\nIn the future I might write my own commenting system along with API to learn more about backend things.</p>\n<h2 id="the-paths-that-need-to-be-taken-care-of">The paths that need to be taken care of</h2>\n<p>I don’t have to worry about this until I decides to deploy the blog as a static site<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>.<br>\nNormally the nested routes won’t be generated if not set in the <code>generate</code> block of <code>nuxt.config.js</code>.<br>\nAlso I should configure <code>fallback: true</code> option in the same block for Firebase Hosting to take care of.</p>\n<h2 id="error-t-is-undefined">Error: t is undefined</h2>\n<p>On pages like this post of this blog, I just came across a problem when using <code>nuxt generate</code>. The page loads fine if I initially arrives at a page rather than any post. In the console log it just showed:</p>\n<pre><code class="hljs"><span class="hljs-string">TypeError:</span> <span class="hljs-string">"t is undefined"</span> [nuxt] Error <span class="hljs-keyword">while</span> initializing app\n<span class="hljs-string">DOMException:</span> <span class="hljs-string">"Node cannot be inserted at the specified point in the hierarchy"</span>\n</code></pre>\n<p>This error is caused because data differs on server vs client.<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p>\n<p>When I inspected, I found that the error will disappear if the page don’t have any components. Eventually, I solved this by adding <code>&lt;client-only&gt;</code> out of the post things.</p>\n<h2 id="playing-with-firebase-cli-and-deploy-to-firebase">Playing with Firebase CLI and Deploy To Firebase</h2>\n<ol>\n<li>Install Firebase CLI and login</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>sudo npm install -g firebase-tools\n<span class="hljs-variable">$ </span>firebase login\n</code></pre>\n<ol start="2">\n<li>Initiate the project directory with Firebase settings</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>firebase init\n</code></pre>\n<p>Select <code>Hosting</code>, connect to a Firebase project, set default public root directory to <code>dist</code> (it’s where <code>nuxt generate</code> put the static site by default.)</p>\n<ol start="3">\n<li>Edit <code>nuxt.config.js</code></li>\n</ol>\n<pre><code class="hljs"><span class="hljs-string">...</span>\n  <span class="hljs-string">"scripts"</span>: {\n    <span class="hljs-string">...</span>\n    <span class="hljs-string">"generate:firebase"</span>: <span class="hljs-string">"yarn clean &amp;&amp; yarn generate"</span>,\n    <span class="hljs-string">"clean"</span>: <span class="hljs-string">"rm -rf dist/*"</span>,\n    <span class="hljs-string">"start:firebase"</span>: <span class="hljs-string">"firebase serve"</span>,\n    <span class="hljs-string">"deploy"</span>: <span class="hljs-string">"firebase deploy"</span>\n  },\n<span class="hljs-string">...</span>\n</code></pre>\n<ol start="4">\n<li>Generate and preview the site.</li>\n</ol>\n<pre><code class="hljs">$ yarn <span class="hljs-keyword">generate</span>:firebase &amp;&amp; yarn start:firebase\n</code></pre>\n<p>The static version could be different from SSR version, I found some problems I didn’t find when using <code>yarn dev</code> when I previewed using Firebase CLI.</p>\n<ol start="5">\n<li>Deploy to Firebase.</li>\n</ol>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>yarn deploy\n</code></pre>\n<h2 id="why-i-dont-use-firebase-functions-or-my-own-server">Why I don’t use Firebase Functions or my own server</h2>\n<p>Firebase Functions are way too slow…</p>\n<p>I took some screenshots:</p>\n<ol>\n<li><a href="https://static.snorl.ax/nuxt-speed/fb-functions.webp">Firebase Functions</a></li>\n<li><a href="https://static.snorl.ax/nuxt-speed/my-server.webp">My Server</a></li>\n<li><a href="https://static.snorl.ax/nuxt-speed/fb-hosting.webp">Firebase Hosting</a></li>\n</ol>\n<p>I’d rather use my own server when it comes to SSR. But nothing compares to Fastly CDN used by Firebase Hosting.</p>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://github.com/SnorlaxYum/Simputer">The source code of the blog</a> <a href="#fnref1" class="footnote-backref">↩︎</a> <a href="#fnref1:1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://github.com/hmsk/frontmatter-markdown-loader">hmsk/frontmatter-markdown-loader: 📝 Webpack Loader for: FrontMatter (.md) -&gt; HTML + Attributes (+ React/Vue Component)</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn3" class="footnote-item"><p><a href="https://nuxtjs.org/api/configuration-generate">API: The generate Property - NuxtJS</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn4" class="footnote-item"><p><a href="https://stackoverflow.com/questions/54010529/nuxt-js-app-doesnt-load-charts-or-maps-when-copying-and-pasting-a-link-into-a-n">Nuxt.js app doesn’t load charts or maps when copying and pasting a link into a new browser tab, otherwise works</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',T.path="~/contents/Terminal/20191117-deploy-nuxt.md",N.attributes={title:"Performance Test on a page - Cloudflare VS Bare Nginx",date:"2019-06-10 22:00",modified:"2019-06-11 09:34",author:e,tags:[g,cs,J],status:a,summary:"Well, nowadays, more and more people says that CloudFlare sucks and slows the website speed. But how slow? I made a test today after I've built my own load balancers with my two servers.",category:n,published:s},N.html='<h2 id="summary">Summary</h2>\n<p>After doing the load balancing in the <a href="/terminal/2019/06/08/doing-site-mirroring-with-nginx-on-the-same-domain/">last post</a>, I pointed the domain to the CNAME record of the balancer and did some Web Speed Tests<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p>\n<p>Tried comparing the site speed with and without Clouflare CDN using an older version of that post. I have to say, Cloudflare makes the site slower with longer waiting time resulting in a longer TTFB. With the <code>proxy_cache</code> in Nginx, the site without Cloudflare CDN is generally faster. So the site is now running without Cloudflare CDN.</p>\n<p>I ran the tests of the old version of the last post on KeyCDN<sup class="footnote-ref"><a href="#fn1" id="fnref1:1">[1:1]</a></sup>, the test results I need is shown below. The meaning of the table headers:</p>\n<ul>\n<li><code>CF Dev</code>: The page under Cloudflare Development Mode, where the CDN is used without its caching feature, thus the speed is similar to a site on the CDN visited for the first time when the caching is happening.</li>\n<li><code>CF Cache</code>: The page visited from cloudflare cache.</li>\n<li><code>Nginx 1st</code>: The page served directly by the nginx on the server without cached content.</li>\n<li><code>Nginx Cache</code>: The page served directly by the nginx on the server with saved caches.</li>\n<li><code>The page</code>: The loading time of the tested post page, in the other words, the html code of the post. This time includes the time of <code>Blocked</code>, <code>DNS</code>, <code>Connect</code>, <code>SSL</code>, <code>Wait</code> and <code>Receive</code> of the domain per request.</li>\n<li><code>CSS</code>: The loading time of the stylesheet <code>all.css</code>.</li>\n<li><code>The images</code>: The loading time of the image taking the longest time to load.</li>\n<li><code>Isoo data 1</code>: The loading time of the first data request of the isso responded with (a json).</li>\n<li><code>Isoo data 2</code>: The loading time of the second data request of the isso responded with (html code).</li>\n<li><code>Total Time</code>: The total loading time of the whole page with all the elements.</li>\n<li><code>Total Time Without Woff2</code>: <code>Total Time</code> minus the loading time of the two google font woff2 files.</li>\n</ul>\n<h2 id="tests">Tests</h2>\n<h3 id="amsterdam">Amsterdam</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">249.6 ms</td>\n<td style="text-align:left">279.3 ms</td>\n<td style="text-align:left">202.44 ms</td>\n<td style="text-align:left">479.2 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">174.2 ms</td>\n<td style="text-align:left">203.6 ms</td>\n<td style="text-align:left">52.5 ms</td>\n<td style="text-align:left">145.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">194.956 ms</td>\n<td style="text-align:left">227.1 ms</td>\n<td style="text-align:left">192.2 ms</td>\n<td style="text-align:left">590.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">34.5 ms</td>\n<td style="text-align:left">145.7 ms</td>\n<td style="text-align:left">46.6 ms</td>\n<td style="text-align:left">466.9 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">37.3 ms</td>\n<td style="text-align:left">143.823 ms</td>\n<td style="text-align:left">47.2 ms</td>\n<td style="text-align:left">486.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">6.6 s</td>\n<td style="text-align:left">942.8 ms</td>\n<td style="text-align:left">9.6 s</td>\n<td style="text-align:left">4.3 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without woff2</td>\n<td style="text-align:left">0.7 s</td>\n<td style="text-align:left">879.7 ms</td>\n<td style="text-align:left">0.6 s</td>\n<td style="text-align:left">1.75 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-amsterdam.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-amsterdam.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-amsterdam.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-amsterdam.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>This region…Hmm… Some occasional things happened in it multiple times. Long loading time for google fonts, slow response from Nginx cache.<br>\nRegardless, in this region CloudFlare won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">1</td>\n<td style="text-align:left">0</td>\n</tr>\n</tbody>\n</table>\n<h3 id="bangalore">Bangalore</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.5 s</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">1 s</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">1.5 s</td>\n<td style="text-align:left">111 ms</td>\n<td style="text-align:left">792.0 ms</td>\n<td style="text-align:left">227.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.7 s</td>\n<td style="text-align:left">213 ms</td>\n<td style="text-align:left">1.5 s</td>\n<td style="text-align:left">940.1 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">594.7 ms</td>\n<td style="text-align:left">565.4 ms</td>\n<td style="text-align:left">561.5 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">560.974 ms</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">565.7 ms</td>\n<td style="text-align:left">551.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">4.4 s</td>\n<td style="text-align:left">2.8 s</td>\n<td style="text-align:left">2.8 s</td>\n<td style="text-align:left">2.5 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without woff2</td>\n<td style="text-align:left">4.4 s</td>\n<td style="text-align:left">2.7 s</td>\n<td style="text-align:left">2.8 s</td>\n<td style="text-align:left">2.5 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-bangalore.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-bangalore.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-bangalore.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-bangalore.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>Clearly in this region Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">1</td>\n<td style="text-align:left">1</td>\n</tr>\n</tbody>\n</table>\n<h3 id="dallas">Dallas</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">900.8 ms</td>\n<td style="text-align:left">797.4 ms</td>\n<td style="text-align:left">610.9 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">912.2 ms</td>\n<td style="text-align:left">72.9 ms</td>\n<td style="text-align:left">510.3 ms</td>\n<td style="text-align:left">79.4 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">89.5 ms</td>\n<td style="text-align:left">953.0 ms</td>\n<td style="text-align:left">327.8 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">469.2 ms</td>\n<td style="text-align:left">594.2 ms</td>\n<td style="text-align:left">414.2 ms</td>\n<td style="text-align:left">424.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">602.2 ms</td>\n<td style="text-align:left">429.0 ms</td>\n<td style="text-align:left">417.4 ms</td>\n<td style="text-align:left">417.5 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">2.9 s</td>\n<td style="text-align:left">1.7 s</td>\n<td style="text-align:left">2 s</td>\n<td style="text-align:left">1.4 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without woff2</td>\n<td style="text-align:left">2.9 s</td>\n<td style="text-align:left">1.67 s</td>\n<td style="text-align:left">2 s</td>\n<td style="text-align:left">1.4 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-dallas.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-dallas.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-dallas.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-dallas.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>In this region Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">1</td>\n<td style="text-align:left">2</td>\n</tr>\n</tbody>\n</table>\n<h3 id="frankfurt">Frankfurt</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">283.1 ms</td>\n<td style="text-align:left">278.9 ms</td>\n<td style="text-align:left">309.5 ms</td>\n<td style="text-align:left">257.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">124.4 ms</td>\n<td style="text-align:left">12.6 ms</td>\n<td style="text-align:left">39.0 ms</td>\n<td style="text-align:left">35.2 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">156.7 s</td>\n<td style="text-align:left">12.5 ms</td>\n<td style="text-align:left">154.5 ms</td>\n<td style="text-align:left">137.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">95.3 ms</td>\n<td style="text-align:left">98.0 ms</td>\n<td style="text-align:left">34.1 ms</td>\n<td style="text-align:left">34.2 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">101.1 ms</td>\n<td style="text-align:left">31.5 ms</td>\n<td style="text-align:left">36.0 ms</td>\n<td style="text-align:left">34.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">709.1ms</td>\n<td style="text-align:left">623.0 ms</td>\n<td style="text-align:left">684.0 ms</td>\n<td style="text-align:left">704.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">644 ms</td>\n<td style="text-align:left">579.7 ms</td>\n<td style="text-align:left">628 ms</td>\n<td style="text-align:left">557 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-frankfurt.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-frankfurt.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-frankfurt.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-frankfurt.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">1</td>\n<td style="text-align:left">3</td>\n</tr>\n</tbody>\n</table>\n<h3 id="london">London</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">405.2 ms</td>\n<td style="text-align:left">390.2 ms</td>\n<td style="text-align:left">250.8 ms</td>\n<td style="text-align:left">229.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">200.2 ms</td>\n<td style="text-align:left">11.1 ms</td>\n<td style="text-align:left">52.1 ms</td>\n<td style="text-align:left">47.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">227.5 ms</td>\n<td style="text-align:left">38.4 ms</td>\n<td style="text-align:left">198.6 ms</td>\n<td style="text-align:left">194.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">39.5 ms</td>\n<td style="text-align:left">152.2 ms</td>\n<td style="text-align:left">48.6 ms</td>\n<td style="text-align:left">46.5 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">145.9 ms</td>\n<td style="text-align:left">156.5 ms</td>\n<td style="text-align:left">49.5 ms</td>\n<td style="text-align:left">47.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">1 s</td>\n<td style="text-align:left">879.5 ms</td>\n<td style="text-align:left">749.5 ms</td>\n<td style="text-align:left">641.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">960 ms</td>\n<td style="text-align:left">829.5 ms</td>\n<td style="text-align:left">723.5 ms</td>\n<td style="text-align:left">594.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-london.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-london.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-london.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-london.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">1</td>\n<td style="text-align:left">4</td>\n</tr>\n</tbody>\n</table>\n<h3 id="miami">Miami</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">959.0 ms</td>\n<td style="text-align:left">638.3 ms</td>\n<td style="text-align:left">554.8 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">951.1 ms</td>\n<td style="text-align:left">8.8 ms</td>\n<td style="text-align:left">527.0 ms</td>\n<td style="text-align:left">70.71 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">16.0 ms</td>\n<td style="text-align:left">937.4 ms</td>\n<td style="text-align:left">300.1 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">427.7 ms</td>\n<td style="text-align:left">600.9 ms</td>\n<td style="text-align:left">461.6 ms</td>\n<td style="text-align:left">408.8 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">415.8 ms</td>\n<td style="text-align:left">614.4 ms</td>\n<td style="text-align:left">458.0 ms</td>\n<td style="text-align:left">413.2 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">2.7 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.9 s</td>\n<td style="text-align:left">1.4 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">2.7 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.9 s</td>\n<td style="text-align:left">1.4 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-miami.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-miami.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-miami.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-miami.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>That awfully long waiting time to receive the page can’t be saved by the fast speed of static cache… Clearly Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">1</td>\n<td style="text-align:left">5</td>\n</tr>\n</tbody>\n</table>\n<h3 id="new-york">New York</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1 s</td>\n<td style="text-align:left">1 s</td>\n<td style="text-align:left">699 ms</td>\n<td style="text-align:left">225.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">943.3 ms</td>\n<td style="text-align:left">12.0 ms</td>\n<td style="text-align:left">399.2 ms</td>\n<td style="text-align:left">67.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">18.3 ms</td>\n<td style="text-align:left">945.5 ms</td>\n<td style="text-align:left">274.1 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">426.3 ms</td>\n<td style="text-align:left">418.4 ms</td>\n<td style="text-align:left">403.2 ms</td>\n<td style="text-align:left">394.8 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">421.9 ms</td>\n<td style="text-align:left">613.1 ms</td>\n<td style="text-align:left">395.2 ms</td>\n<td style="text-align:left">411.9 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.7 s</td>\n<td style="text-align:left">1 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.7 s</td>\n<td style="text-align:left">1 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-newyork.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-newyork.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-newyork.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-newyork.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>CloudFlare behaved like a shit on the initial waiting time again which the impressive caching speed can’t save… Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">1</td>\n<td style="text-align:left">6</td>\n</tr>\n</tbody>\n</table>\n<h3 id="paris">Paris</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">319.8 ms</td>\n<td style="text-align:left">284.9 ms</td>\n<td style="text-align:left">187.5 ms</td>\n<td style="text-align:left">501.5 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">244.0 ms</td>\n<td style="text-align:left">10.6 ms</td>\n<td style="text-align:left">46.9 ms</td>\n<td style="text-align:left">148.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">305.9 ms</td>\n<td style="text-align:left">38.7 ms</td>\n<td style="text-align:left">174.1 ms</td>\n<td style="text-align:left">611.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">47.4 ms</td>\n<td style="text-align:left">174.9 ms</td>\n<td style="text-align:left">43.9 ms</td>\n<td style="text-align:left">478.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">185.11 ms</td>\n<td style="text-align:left">189.7 ms</td>\n<td style="text-align:left">44.3 ms</td>\n<td style="text-align:left">490.5 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">810.66 ms</td>\n<td style="text-align:left">635.29 ms</td>\n<td style="text-align:left">1.7 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">755.46 ms</td>\n<td style="text-align:left">569.5 ms</td>\n<td style="text-align:left">1.7 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-paris.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-paris.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-paris.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-paris.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>Considering something occasional happened to the Nginx Cache, CloudFlare won this round.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">6</td>\n</tr>\n</tbody>\n</table>\n<h3 id="san-francisco">San Francisco</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">892.2 ms</td>\n<td style="text-align:left">741.0 ms</td>\n<td style="text-align:left">414.5 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">741.2 ms</td>\n<td style="text-align:left">752.9 ms</td>\n<td style="text-align:left">349.8 ms</td>\n<td style="text-align:left">13.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">920.4 ms</td>\n<td style="text-align:left">988.4 ms</td>\n<td style="text-align:left">892.0 ms</td>\n<td style="text-align:left">58.4 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">350.1 ms</td>\n<td style="text-align:left">392.6 ms</td>\n<td style="text-align:left">362.0 ms</td>\n<td style="text-align:left">357.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">370.1 ms</td>\n<td style="text-align:left">386.9 ms</td>\n<td style="text-align:left">355.6 ms</td>\n<td style="text-align:left">345.1 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">2.2 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.1 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">2.2 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.093 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-san-francisco.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-san-francisco.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-san-francisco.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-san-francisco.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>This round something occasional happened to CloudFlare. Nginx hit Cloudflare so hard and won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">7</td>\n</tr>\n</tbody>\n</table>\n<h3 id="seattle">Seattle</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">918.3 ms</td>\n<td style="text-align:left">902.7 ms</td>\n<td style="text-align:left">741.0 ms</td>\n<td style="text-align:left">469.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">852.1 ms</td>\n<td style="text-align:left">13.6 ms</td>\n<td style="text-align:left">349.8 ms</td>\n<td style="text-align:left">48.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">38.5 ms</td>\n<td style="text-align:left">892.0 ms</td>\n<td style="text-align:left">199.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">513.8 ms</td>\n<td style="text-align:left">522.9 ms</td>\n<td style="text-align:left">362.0 ms</td>\n<td style="text-align:left">393.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">398.3 ms</td>\n<td style="text-align:left">395.5 ms</td>\n<td style="text-align:left">355.6 ms</td>\n<td style="text-align:left">384.4 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.6 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.2 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.6 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.18 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-seattle.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-seattle.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-seattle.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-seattle.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>Nginx won 1 score in a similar way as usual.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">8</td>\n</tr>\n</tbody>\n</table>\n<h3 id="singapore">Singapore</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1.7 s</td>\n<td style="text-align:left">1.7 s</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">1.2 s</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">1.4 s</td>\n<td style="text-align:left">13.2 ms</td>\n<td style="text-align:left">530.5 ms</td>\n<td style="text-align:left">189.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.6 s</td>\n<td style="text-align:left">23.4 ms</td>\n<td style="text-align:left">1.3 s</td>\n<td style="text-align:left">777.1 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">529.6 ms</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">520.2 ms</td>\n<td style="text-align:left">515.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">1 s</td>\n<td style="text-align:left">532.8 ms</td>\n<td style="text-align:left">511.5 ms</td>\n<td style="text-align:left">525.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">4.4 s</td>\n<td style="text-align:left">3 s</td>\n<td style="text-align:left">2.8 s</td>\n<td style="text-align:left">2.5 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">4.4 s</td>\n<td style="text-align:left">2.97 s</td>\n<td style="text-align:left">2.8 s</td>\n<td style="text-align:left">2.5 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-singapore.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-singapore.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-singapore.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-singapore.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>When it comes to the global speed, CloudFlare slows down it even more… Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">9</td>\n</tr>\n</tbody>\n</table>\n<h3 id="sydney">Sydney</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1.4 s</td>\n<td style="text-align:left">1.4 s</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">1 s</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">1.4 s</td>\n<td style="text-align:left">9.6 ms</td>\n<td style="text-align:left">730.6 ms</td>\n<td style="text-align:left">176.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.5 s</td>\n<td style="text-align:left">17.6 ms</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">738.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">509.6 ms</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">498.9 ms</td>\n<td style="text-align:left">497.6 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">491.7 ms</td>\n<td style="text-align:left">1 s</td>\n<td style="text-align:left">517.4 ms</td>\n<td style="text-align:left">507.7 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">3.5 s</td>\n<td style="text-align:left">4.1 s</td>\n<td style="text-align:left">2.6 s</td>\n<td style="text-align:left">2.3 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">3.5 s</td>\n<td style="text-align:left">4.0 s</td>\n<td style="text-align:left">2.6 s</td>\n<td style="text-align:left">2.3 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-sydney.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-sydney.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-sydney.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-sydney.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>Something occasional happened to Cloudflare again. Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">10</td>\n</tr>\n</tbody>\n</table>\n<h3 id="tokyo">Tokyo</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">1.2 s</td>\n<td style="text-align:left">800.5 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">585.8 ms</td>\n<td style="text-align:left">129.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.3 s</td>\n<td style="text-align:left">1.3 s</td>\n<td style="text-align:left">1 s</td>\n<td style="text-align:left">529.3 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">456.0 ms</td>\n<td style="text-align:left">468.4 ms</td>\n<td style="text-align:left">459.8 ms</td>\n<td style="text-align:left">461.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">781.7 ms</td>\n<td style="text-align:left">794.8 ms</td>\n<td style="text-align:left">473.7 ms</td>\n<td style="text-align:left">451.9 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">3.2 s</td>\n<td style="text-align:left">3.2 s</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.8 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">3.2 s</td>\n<td style="text-align:left">3.2 s</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.8 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-tokyo.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-tokyo.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-tokyo.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-tokyo.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>CloudFlare cache seems not working in Tokyo? Nginx won 1 score.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">11</td>\n</tr>\n</tbody>\n</table>\n<h3 id="toronto">Toronto</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left"></th>\n<th style="text-align:left">CF Dev</th>\n<th style="text-align:left">CF Cache</th>\n<th style="text-align:left">Nginx 1st</th>\n<th style="text-align:left">Nginx Cache</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">The page</td>\n<td style="text-align:left">918.3 ms</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">703.6 ms</td>\n<td style="text-align:left">494.2 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">CSS</td>\n<td style="text-align:left">852.1 ms</td>\n<td style="text-align:left">10.0 ms</td>\n<td style="text-align:left">401.6 ms</td>\n<td style="text-align:left">71.8 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">The images</td>\n<td style="text-align:left">1.1 s</td>\n<td style="text-align:left">25.2 ms</td>\n<td style="text-align:left">924.8 ms</td>\n<td style="text-align:left">279.0 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 1</td>\n<td style="text-align:left">513.8 ms</td>\n<td style="text-align:left">619.7 ms</td>\n<td style="text-align:left">412.5 ms</td>\n<td style="text-align:left">412.4 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Isso data 2</td>\n<td style="text-align:left">398.3 ms</td>\n<td style="text-align:left">629.4 ms</td>\n<td style="text-align:left">395.4 ms</td>\n<td style="text-align:left">404.9 ms</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.9 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.2 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Total Time Without Woff2</td>\n<td style="text-align:left">2.4 s</td>\n<td style="text-align:left">1.83 s</td>\n<td style="text-align:left">1.8 s</td>\n<td style="text-align:left">1.2 s</td>\n</tr>\n<tr>\n<td style="text-align:left">Original result</td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-dev-toronto.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/cf-cache-toronto.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-dev-toronto.webp">The image</a></td>\n<td style="text-align:left"><a href="%7Bstatic%7D/img/20190610-cf-vs-bare/bare-cache-toronto.webp">The image</a></td>\n</tr>\n</tbody>\n</table>\n<p>Nginx won 1 score again in a usual way.</p>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">12</td>\n</tr>\n</tbody>\n</table>\n<h2 id="result">Result</h2>\n<p>Score Table:</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">CloudFlare</th>\n<th style="text-align:left">Nginx</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">2</td>\n<td style="text-align:left">12</td>\n</tr>\n</tbody>\n</table>\n<p>CloudFlare only won two rounds, when something occasional happened. So that result is, almost a total win for bare Nginx. I believe with only one server behind the CloudFlare, Cloudflare will behave worse since there will be some longer paths for CloudFlare to receive responses from thus resulting in a longer waiting time. But CloudFlare is okay as a free service, while I can’t expect too much from it with so many users on it. I’m still a user of their DNS. Their DNS is famous for its fast speed.</p>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://tools.keycdn.com/speed">Website Speed Test | Full Page Performance Check</a> <a href="#fnref1" class="footnote-backref">↩︎</a> <a href="#fnref1:1" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',N.path="~/contents/Terminal/20190610-cf-vs-bare-nginx.md",D.attributes={title:"Git - An Excellent File Transferer",date:"2019-06-07 22:08",modified:"2019-07-31 18:28",author:e,tags:[K,us,"ssh"],status:a,summary:"I recently found that git is an excellent file transferer.",category:n,published:s},D.html='<p>I did migration of my site from firebase to my server. And then I found out that git is far more better than scp. Normally scp transfer files one by one to the server, while git glues all files together, speeding up the process. Afterwards, the version control will take care of the changes of the whole git project and only process the changes to the server.</p>\n<p>I did through the official guide 4.3<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> and 4.4<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> and created a user <code>git</code> for doing git.</p>\n<p>However doing without a git account is also possible.</p>\n<h2 id="working-with-a-remote">Working with a remote</h2>\n<p>Generate my own SSH public key on my local computer:</p>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>ssh-keygen\n</code></pre>\n<p>Upload my ~/.ssh/id_rsa.pub to somewhere on the server:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@localhost</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>scp -P port ~<span class="hljs-regexp">/.ssh/id</span>_rsa.pub sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:/home/sim/id_rsa</span>.sim.pub\n</code></pre>\n<p>On the server in the home, make dir for ssh if <code>.ssh</code> hasn’t been created:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>mkdir .ssh\n</code></pre>\n<p>append the key to <code>authorized_keys</code>:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cat id_rsa.sim.pub &gt;&gt; .ssh/authorized_keys\n</code></pre>\n<p>Initialize a new dir for new git project:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>git init --bare new_dir.git\n</code></pre>\n<p>On my local computer:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@localhost</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cd project\nsim<span class="hljs-variable">@localhost</span><span class="hljs-symbol">:~/project</span><span class="hljs-variable">$ </span>git init &amp;&amp; git add . &amp;&amp; git commit -m <span class="hljs-string">"initial commit"</span> &amp;&amp; git remote add origin <span class="hljs-symbol">ssh:</span>/<span class="hljs-regexp">/sim@server:port:/home</span><span class="hljs-regexp">/sim/new</span>_dir.git &amp;&amp; git push origin master\n</code></pre>\n<p>Then on the server, I can do this:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>git clone ~<span class="hljs-regexp">/new_dir.git ~/new</span>_dir\n</code></pre>\n<p><code>new_dir</code> is a new dir with all files checked out from the git project <code>new_dir.git</code> and the git settings.</p>\n<p>I could create <code>~/new_dir.git/hooks/post-receive</code>:</p>\n<pre><code class="hljs language-bash"><span class="hljs-meta">#!/bin/sh</span>\n<span class="hljs-built_in">cd</span> /home/sim/new_dir || <span class="hljs-built_in">exit</span>\n<span class="hljs-built_in">unset</span> GIT_DIR\ngit pull origin master\n</code></pre>\n<p>The <code>unset</code> is needed \'cause git uses the variable <code>GIT_DIR</code> instead of <code>PWD</code>, <code>cd</code> changes <code>PWD</code> instead of <code>GIT_DIR</code>. There must be a fallback from <code>GIT_DIR</code> to <code>PWD</code><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>.</p>\n<p>Make it executable:</p>\n<pre><code class="hljs">sim<span class="hljs-meta">@server</span>:~$ chmod +x <span class="hljs-regexp">~/new_dir.git/</span>hooks/post-receive\n</code></pre>\n<p>Everytime I need update files on the server, I could do it via a bash:</p>\n<pre><code class="hljs"><span class="hljs-meta">#!/bin/bash</span>\n<span class="hljs-built_in">cd</span> /home/sim/project\n<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Enter the commit message: "</span>\n<span class="hljs-built_in">read</span> message\ngit add .\ngit commit -m <span class="hljs-string">"<span class="hljs-variable">${message}</span>"</span>\ngit push origin master\n</code></pre>\n<p>Then everytime I push to the git project, the <code>new_dir</code> will be also updated with new contents.</p>\n<h2 id="working-with-multiple-remotes">Working with multiple remotes</h2>\n<p>Sometimes I need to work with serveral remotes, for example, I need to upload to multiple servers, then I have to do some extra things.</p>\n<p>Upload my ~/.ssh/id_rsa.pub to somewhere on another server:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@localhost</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>scp -P port ~<span class="hljs-regexp">/.ssh/id</span>_rsa.pub sim<span class="hljs-variable">@server2</span><span class="hljs-symbol">:/home/sim/id_rsa</span>.sim.pub\n</code></pre>\n<p>On the server in the home, make dir for ssh if <code>.ssh</code> hasn’t been created:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server2</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>mkdir .ssh\n</code></pre>\n<p>Append the key to <code>authorized_keys</code>:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server2</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cat id_rsa.sim.pub &gt;&gt; .ssh/authorized_keys\n</code></pre>\n<p>Initialize a new dir for new git project:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server2</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>git init --bare new_dir.git\n</code></pre>\n<p>On my local computer:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@localhost</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cd project\nsim<span class="hljs-variable">@localhost</span><span class="hljs-symbol">:~/project</span><span class="hljs-variable">$ </span>git remote add origin2 <span class="hljs-symbol">ssh:</span>/<span class="hljs-regexp">/sim@server2:port:/home</span><span class="hljs-regexp">/sim/new</span>_dir.git\nsim<span class="hljs-variable">@localhost</span><span class="hljs-symbol">:~/project</span><span class="hljs-variable">$ </span>git push origin2 master\n</code></pre>\n<p>Then on the server, I can do this:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server2</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>git clone ~<span class="hljs-regexp">/new_dir.git ~/new</span>_dir\n</code></pre>\n<p><code>new_dir</code> is a new dir with all files checked out from the git project <code>new_dir.git</code> and the git settings.</p>\n<p>I could create <code>~/new_dir.git/hooks/post-receive</code>:</p>\n<pre><code class="hljs language-sh"><span class="hljs-meta">#!/bin/sh</span>\n<span class="hljs-built_in">cd</span> /home/sim/new_dir || <span class="hljs-built_in">exit</span>\n<span class="hljs-built_in">unset</span> GIT_DIR\ngit stash\ngit pull origin master\n</code></pre>\n<p>Make it executable:</p>\n<pre><code class="hljs">sim<span class="hljs-meta">@server</span><span class="hljs-string">2:</span>~$ chmod +x <span class="hljs-regexp">~/new_dir.git/</span>hooks/post-receive\n</code></pre>\n<p>Everytime I need update files on both servers, I could do it via a bash:</p>\n<pre><code class="hljs language-bash"><span class="hljs-meta">#!/bin/bash</span>\n<span class="hljs-built_in">cd</span> /home/sim/project\n<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Enter the commit message: "</span>\n<span class="hljs-built_in">read</span> message\ngit add .\ngit commit -m <span class="hljs-string">"<span class="hljs-variable">${message}</span>"</span>\ngit push origin master\ngit push origin2 master\n</code></pre>\n<p>Then everytime I push to both git projects, the <code>new_dir</code> on both servers will be also updated with new contents.</p>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key">Git - Generating Your SSH Public Key</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server">Git - Setting Up the Server</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn3" class="footnote-item"><p><a href="https://stackoverflow.com/a/4100577/9850945">githooks - getting “fatal: not a git repository: ‘.’” when using post-update hook to execute ‘git pull’ on another repo - Stack Overflow</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',D.path="~/contents/Terminal/20190607-git-file-management.md",F.attributes={title:"Notes on MDN Web Docs Javascript Guide",date:"2019-05-23 22:08",modified:"2019-05-27 12:28",author:e,tags:["MDN",js,ss],status:a,summary:"Looks like that it suits me much when it comes to learning js.",category:n,published:s},F.html='<p>After learning from YDJS for a while, I did some practice. At first I searched for some ideas, and then I decided to do a clock<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p>\n<p>Then you can see it on the home page of the site<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>, with the image changing every 5 seconds randomly. In the origin project, <code>setTimeout</code> seems to be a viable choice. But when it comes to two different elements that need different intervals, <code>setInterval</code> comes in handy. <code>setTimeout</code> won’t support two functions with different intervals. That’s what I experienced. They both serve as js timing functions<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>. Now I prefer <code>setInterval</code>.</p>\n<p>Anyway, it might be too early for me to start with YDJS, though it’s a good book. So I decided to switch to MDN Web Docs<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> instead.</p>\n<p>I only takes what seems new to me \'cause it seems that I’ve been acquiainted with many of the contents.</p>\n<h2 id="grammer-and-types">Grammer and Types</h2>\n<p>Multiple lines usage in string literals:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> poem =\n<span class="hljs-string">\'Roses are red,\\n\\\nViolets are blue.\\n\\\nSugar is sweet,\\n\\\nand so is foo.\'</span>\n</code></pre>\n<p>Template Literals<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup> from ECMAScript 2015 as a new way for multiple lines string literals:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> poem =\n<span class="hljs-string">`Roses are red,\nViolets are blue.\nSugar is sweet,\nand so is foo.`</span>\n</code></pre>\n<h2 id="control-flow-and-error-handling">Control flow and error handling</h2>\n<h3 id="block-statement">Block statement</h3>\n<p>Starting with ECMAScript2015, the <code>let</code> and <code>const</code> variable declarations are block scoped.</p>\n<h3 id="switch-statement"><code>switch</code> statement</h3>\n<p>It’s almost the same as C.</p>\n<p>An exceptional example is located at <code>switch</code> section at Chapter 5 in this note<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup>.</p>\n<h3 id="exception-handling-statements">Exception handling statements</h3>\n<p>Throw exceptions: <code>throw</code> statement<br>\nHandle exceptions: <code>try...catch</code> statement</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">try</span> {\n  something;\n} <span class="hljs-keyword">catch</span> (e) {\n  something;\n} <span class="hljs-keyword">finally</span> {\n  finalthing;\n}\n\n</code></pre>\n<p>It’s similar to this in Python:</p>\n<pre><code class="hljs language-python"><span class="hljs-keyword">try</span>:\n    something\n<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:\n    something\n<span class="hljs-keyword">finally</span>:\n    finalthing\n</code></pre>\n<p><code>e</code> is an identifier for the error thrown. <code>finally</code> will be executed whether the <code>e</code> happens.</p>\n<p><code>e</code> has properties <code>name</code> amd <code>message</code> in js, similar to <code>type(e)</code> and <code>e.args</code> in Python.</p>\n<h3 id="promises">Promises</h3>\n<p>Starting with ECMAScript2015, JavaScript gains support for Promise objects<sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup> allowing you to control the flow of deferred and asynchronous operations.</p>\n<p><code>imgLoad</code> example:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imgLoad</span>(<span class="hljs-params">url</span>) </span>{\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) </span>{\n    <span class="hljs-keyword">var</span> request = <span class="hljs-keyword">new</span> XMLHttpRequest();\n    request.open(<span class="hljs-string">\'GET\'</span>, url);\n    request.responseType = <span class="hljs-string">\'blob\'</span>;\n    request.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{\n      <span class="hljs-keyword">if</span> (request.status === <span class="hljs-number">200</span>) {\n        resolve(request.response);\n      } <span class="hljs-keyword">else</span> {\n        reject(<span class="hljs-built_in">Error</span>(<span class="hljs-string">\'Image didn\\\'t load successfully; error code:\'</span>\n                     + request.statusText));\n      }\n    };\n    request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{\n      reject(<span class="hljs-built_in">Error</span>(<span class="hljs-string">\'There was a network error.\'</span>));\n    };\n    request.send();\n  });\n}\n</code></pre>\n<p><code>resolve</code> when the task succeeds, <code>reject</code> otherwise. <sup class="footnote-ref"><a href="#fn7" id="fnref7:1">[7:1]</a></sup></p>\n<h2 id="loops-and-iteration">Loops and iteration</h2>\n<p>Loops in js:</p>\n<ul>\n<li>for statement</li>\n<li>do…while statement</li>\n<li>while statement</li>\n<li>labeled statement</li>\n<li>break statement</li>\n<li>continue statement</li>\n<li>for…in statement</li>\n<li>for…of statement</li>\n</ul>\n<p>The first 6: Similar to C.<br>\n<code>for .. in</code>: When used on objects, return all the property names(keys). WHen used in arrays, return from 0 to (array.length - 1)<br>\n<code>for .. of</code>: When used on objects, return all the property values(values). When used in arrays return from array[0] to array[array.length-1]</p>\n<h2 id="functions">Functions</h2>\n<p>declarations: name, paramters, statements inside curly brackets. In js, functions can be defined in var form:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> fun_name = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{statements;}\n</code></pre>\n<p>As I learned from YDJS, function is also a object. With <code>this</code>, a var assignment from a function can be assigned property keys and values.</p>\n<p>With the needed parameters a function can be executed and complete what has been defined in it.</p>\n<p>Vars defined inside a function has its scope of execution inside.</p>\n<p>Things like recursion, nests, no difference from C.</p>\n<p><code>arguments</code> is a function-scope var containing a list of parameters passed to the function.</p>\n<p>Default parameters: <code>undefined</code>, can be set to other values.</p>\n<h3 id="rest-parameters">Rest parameters</h3>\n<p>Example says everything:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span>(<span class="hljs-params">multiplier, ...theArgs</span>) </span>{\n  <span class="hljs-keyword">return</span> theArgs.map(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> multiplier * x);\n}\n\n<span class="hljs-keyword">var</span> arr = multiply(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);\n<span class="hljs-built_in">console</span>.log(arr); <span class="hljs-comment">// [2, 4, 6]</span>\n</code></pre>\n<h3 id="shorter-functions">Shorter functions</h3>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = [\n  <span class="hljs-string">\'Hydrogen\'</span>,\n  <span class="hljs-string">\'Helium\'</span>,\n  <span class="hljs-string">\'Lithium\'</span>,\n  <span class="hljs-string">\'Beryllium\'</span>\n];\n\n<span class="hljs-keyword">var</span> a2 = a.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{ <span class="hljs-keyword">return</span> s.length; });\n\n<span class="hljs-built_in">console</span>.log(a2); <span class="hljs-comment">// logs [8, 6, 7, 9]</span>\n\n<span class="hljs-keyword">var</span> a3 = a.map(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.length);\n\n<span class="hljs-built_in">console</span>.log(a3); <span class="hljs-comment">// logs [8, 6, 7, 9]</span>\n</code></pre>\n<h3 id="no-seperate-this">No seperate <code>this</code></h3>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Person</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-comment">// The Person() constructor defines `this` as itself.</span>\n  <span class="hljs-keyword">this</span>.age = <span class="hljs-number">0</span>;\n\n  setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">growUp</span>(<span class="hljs-params"></span>) </span>{\n    <span class="hljs-comment">// In nonstrict mode, the growUp() function defines `this`</span>\n    <span class="hljs-comment">// as the global object, which is different from the `this`</span>\n    <span class="hljs-comment">// defined by the Person() constructor.</span>\n    <span class="hljs-keyword">this</span>.age++;\n  }, <span class="hljs-number">1000</span>);\n}\n\n<span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> Person();\n</code></pre>\n<p>Solution:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Person</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>; <span class="hljs-comment">// Some choose `that` instead of `self`.</span>\n                   <span class="hljs-comment">// Choose one and be consistent.</span>\n  self.age = <span class="hljs-number">0</span>;\n\n  setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">growUp</span>(<span class="hljs-params"></span>) </span>{\n    <span class="hljs-comment">// The callback refers to the `self` variable of which</span>\n    <span class="hljs-comment">// the value is the expected object.</span>\n    self.age++;\n  }, <span class="hljs-number">1000</span>);\n}\n</code></pre>\n<p>Arrow function doesn’t have its own <code>this</code>, so viable directly:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Person</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">this</span>.age = <span class="hljs-number">0</span>;\n\n  setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {\n    <span class="hljs-keyword">this</span>.age++; <span class="hljs-comment">// |this| properly refers to the person object</span>\n  }, <span class="hljs-number">1000</span>);\n}\n\n<span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> Person();\n</code></pre>\n<h3 id="predefined-functions">Predefined functions</h3>\n<p><code>eval()</code>: The eval() method evaluates JavaScript code represented as a string.</p>\n<p><code>uneval()</code>: The uneval() method creates a string representation of the source code of an Object.</p>\n<p><code>isFinite()</code>: The global isFinite() function determines whether the passed value is a finite number. If needed, the parameter is first converted to a number.</p>\n<p><code>isNaN()</code>: The isNaN() function determines whether a value is NaN or not. Note: coercion inside the isNaN function has interesting rules; you may alternatively want to use Number.isNaN(), as defined in ECMAScript 2015, or you can use typeof to determine if the value is Not-A-Number.</p>\n<p><code>parseFloat()</code>: The parseFloat() function parses a string argument and returns a floating point number.</p>\n<p><code>parseInt()</code>: The parseInt() function parses a string argument and returns an integer of the specified radix (the base in mathematical numeral systems).</p>\n<p><code>decodeURI()</code>: The decodeURI() function decodes a Uniform Resource Identifier (URI) previously created by encodeURI or by a similar routine.</p>\n<p><code>decodeURIComponent()</code>: The decodeURIComponent() method decodes a Uniform Resource Identifier (URI) component previously created by encodeURIComponent or by a similar routine.</p>\n<p><code>encodeURI()</code>: The encodeURI() method encodes a Uniform Resource Identifier (URI) by replacing each instance of certain characters by one, two, three, or four escape sequences representing the UTF-8 encoding of the character (will only be four escape sequences for characters composed of two “surrogate” characters).</p>\n<p><code>encodeURIComponent()</code>: The encodeURIComponent() method encodes a Uniform Resource Identifier (URI) component by replacing each instance of certain characters by one, two, three, or four escape sequences representing the UTF-8 encoding of the character (will only be four escape sequences for characters composed of two “surrogate” characters).</p>\n<p><code>escape()</code>: The deprecated escape() method computes a new string in which certain characters have been replaced by a hexadecimal escape sequence. Use encodeURI or encodeURIComponent instead.</p>\n<p><code>unescape()</code>: The deprecated unescape() method computes a new string in which hexadecimal escape sequences are replaced with the character that it represents. The escape sequences might be introduced by a function like escape. Because unescape() is deprecated, use decodeURI() or decodeURIComponent instead.</p>\n<h2 id="expressions-and-operators">Expressions and operators</h2>\n<p>Assignment Operator: <code>=</code><br>\nCompound operators:  <code>+=</code>, <code>&lt;&lt;=</code>, <code>&gt;&gt;&gt;=</code>, <code>|=</code> etc.</p>\n<h3 id="destructuring-in-assignment">Destructuring in assignment</h3>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> foo = [<span class="hljs-string">\'one\'</span>, <span class="hljs-string">\'two\'</span>, <span class="hljs-string">\'three\'</span>];\n\n<span class="hljs-comment">// without destructuring</span>\n<span class="hljs-keyword">var</span> one   = foo[<span class="hljs-number">0</span>];\n<span class="hljs-keyword">var</span> two   = foo[<span class="hljs-number">1</span>];\n<span class="hljs-keyword">var</span> three = foo[<span class="hljs-number">2</span>];\n\n<span class="hljs-comment">// with destructuring</span>\n<span class="hljs-keyword">var</span> [one, two, three] = foo;\n</code></pre>\n<p>Comparison operators: <code>==</code>, <code>&gt;=</code>, <code>===</code>, etc.</p>\n<p>Arithmetic operators: <code>%</code>, <code>++</code>, etc.</p>\n<p>Bitwise operators: <code>|</code>, <code>&amp;</code>, <code>&lt;&lt;</code> etc.</p>\n<p>Logical operators: <code>&amp;&amp;</code>, <code>||</code>, <code>!</code></p>\n<p>String operators: <code>+</code></p>\n<p>Conditional operator: <code>?</code></p>\n<p>Coma operator:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> x = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>]\n<span class="hljs-keyword">var</span> a = [x, x, x, x, x];\n\n<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">9</span>; i &lt;= j; i++, j--)\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">\'a[\'</span> + i + <span class="hljs-string">\'][\'</span> + j + <span class="hljs-string">\']= \'</span> + a[i][j]);\n</code></pre>\n<p>Unary operators: <code>delete</code>, <code>typeof</code>, <code>void</code>.</p>\n<pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:void(0)"</span>&gt;</span>Click here to do nothing<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>\n\n<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:void(document.form.submit())"</span>&gt;</span>\nClick here to submit<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>\n</code></pre>\n<h4 id="relational-operators">Relational operators</h4>\n<h5 id="in"><code>in</code></h5>\n<pre><code class="hljs language-js"><span class="hljs-comment">// Arrays</span>\n<span class="hljs-keyword">var</span> trees = [<span class="hljs-string">\'redwood\'</span>, <span class="hljs-string">\'bay\'</span>, <span class="hljs-string">\'cedar\'</span>, <span class="hljs-string">\'oak\'</span>, <span class="hljs-string">\'maple\'</span>];\n<span class="hljs-number">0</span> <span class="hljs-keyword">in</span> trees;        <span class="hljs-comment">// returns true</span>\n<span class="hljs-number">3</span> <span class="hljs-keyword">in</span> trees;        <span class="hljs-comment">// returns true</span>\n<span class="hljs-number">6</span> <span class="hljs-keyword">in</span> trees;        <span class="hljs-comment">// returns false</span>\n<span class="hljs-string">\'bay\'</span> <span class="hljs-keyword">in</span> trees;    <span class="hljs-comment">// returns false (you must specify the index number,</span>\n                   <span class="hljs-comment">// not the value at that index)</span>\n<span class="hljs-string">\'length\'</span> <span class="hljs-keyword">in</span> trees; <span class="hljs-comment">// returns true (length is an Array property)</span>\n\n<span class="hljs-comment">// built-in objects</span>\n<span class="hljs-string">\'PI\'</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">Math</span>;          <span class="hljs-comment">// returns true</span>\n<span class="hljs-keyword">var</span> myString = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">\'coral\'</span>);\n<span class="hljs-string">\'length\'</span> <span class="hljs-keyword">in</span> myString;  <span class="hljs-comment">// returns true</span>\n\n<span class="hljs-comment">// Custom objects</span>\n<span class="hljs-keyword">var</span> mycar = { <span class="hljs-attr">make</span>: <span class="hljs-string">\'Honda\'</span>, <span class="hljs-attr">model</span>: <span class="hljs-string">\'Accord\'</span>, <span class="hljs-attr">year</span>: <span class="hljs-number">1998</span> };\n<span class="hljs-string">\'make\'</span> <span class="hljs-keyword">in</span> mycar;  <span class="hljs-comment">// returns true</span>\n<span class="hljs-string">\'model\'</span> <span class="hljs-keyword">in</span> mycar; <span class="hljs-comment">// returns true</span>\n</code></pre>\n<h5 id="instanceof"><code>instanceof</code></h5>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> theDay = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1995</span>, <span class="hljs-number">12</span>, <span class="hljs-number">17</span>);\n<span class="hljs-keyword">if</span> (theDay <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span>) {\n  <span class="hljs-comment">// statements to execute</span>\n}\n</code></pre>\n<h4 id="expressions">Expressions</h4>\n<p>Arithmetic: evaluates to a number, for example 3.14159. (Generally uses arithmetic operators.)<br>\nString: evaluates to a character string, for example, “Fred” or “234”. (Generally uses string operators.)<br>\nLogical: evaluates to true or false. (Often involves logical operators.)</p>\n<h5 id="primary-expressions">Primary expressions</h5>\n<p>Basic keywords and general expressions in JavaScript.</p>\n<p><code>this</code>: current object<br>\n<code>()</code>: control precedence.</p>\n<h5 id="left-hand-side-expressions">Left-hand-side expressions</h5>\n<p>Left values are the destination of an assignment.</p>\n<p><code>new</code>: create an instance.<br>\n<code>super</code>: call on objects’ parent<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup></p>\n<h6 id="spread-operator">Spread Operator</h6>\n<p>Use with array:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> parts = [<span class="hljs-string">\'shoulders\'</span>, <span class="hljs-string">\'knees\'</span>];\n<span class="hljs-keyword">var</span> lyrics = [<span class="hljs-string">\'head\'</span>, ...parts, <span class="hljs-string">\'and\'</span>, <span class="hljs-string">\'toes\'</span>];\n</code></pre>\n<p>Use with function calls:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params">x, y, z</span>) </span>{ }\n<span class="hljs-keyword">var</span> args = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>];\nf(...args);\n</code></pre>\n<h2 id="numbers-and-dates">Numbers and dates</h2>\n<h3 id="numbers">Numbers</h3>\n<h4 id="decimal-numbers">Decimal numbers</h4>\n<pre><code class="hljs language-js"><span class="hljs-number">1234567890</span>\n<span class="hljs-number">42</span>\n\n<span class="hljs-comment">// Caution when using leading zeros:</span>\n\n<span class="hljs-number">0888</span> <span class="hljs-comment">// 888 parsed as decimal</span>\n<span class="hljs-number">0777</span> <span class="hljs-comment">// parsed as octal in non-strict mode (511 in decimal)</span>\n</code></pre>\n<h4 id="binary-numbers">Binary numbers</h4>\n<p>Leading with <code>0b</code> and <code>0B</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> FLT_SIGNBIT  = <span class="hljs-number">0b10000000000000000000000000000000</span>; <span class="hljs-comment">// 2147483648</span>\n<span class="hljs-keyword">var</span> FLT_EXPONENT = <span class="hljs-number">0b01111111100000000000000000000000</span>; <span class="hljs-comment">// 2139095040</span>\n<span class="hljs-keyword">var</span> FLT_MANTISSA = <span class="hljs-number">0B00000000011111111111111111111111</span>; <span class="hljs-comment">// 8388607</span>\n</code></pre>\n<h4 id="octal-numbers">Octal Numbers</h4>\n<p>Leading with zeros:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> n = <span class="hljs-number">0755</span>; <span class="hljs-comment">// 493</span>\n<span class="hljs-keyword">var</span> m = <span class="hljs-number">0644</span>; <span class="hljs-comment">// 420</span>\n</code></pre>\n<p>Leading with <code>0o</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">0o10</span>; <span class="hljs-comment">// ES2015: 8</span>\n</code></pre>\n<h4 id="hexadecimal-numbers">Hexadecimal numbers</h4>\n<p>Leading with <code>0x</code> or <code>0X</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-number">0xFFFFFFFFFFFFFFFFF</span> <span class="hljs-comment">// 295147905179352830000</span>\n<span class="hljs-number">0x123456789ABCDEF</span>   <span class="hljs-comment">// 81985529216486900</span>\n<span class="hljs-number">0XA</span>                 <span class="hljs-comment">// 10</span>\n</code></pre>\n<h4 id="exponentiation">Exponentiation</h4>\n<pre><code class="hljs language-js"><span class="hljs-number">1E3</span>   <span class="hljs-comment">// 1000</span>\n<span class="hljs-number">2e6</span>   <span class="hljs-comment">// 2000000</span>\n<span class="hljs-number">0.1e2</span> <span class="hljs-comment">// 10</span>\n</code></pre>\n<h4 id="number-object"><code>Number</code> object</h4>\n<p>Different built-in properties and functions are listed with their links, respectively <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates#Number_object">there</a>.</p>\n<h4 id="math-object"><code>Math</code> object</h4>\n<p>Built-in properties: Math.PI<br>\nBuilt-in Functions: Math.floor(), Math.min(), etc. (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates#Math_object">Information</a>)</p>\n<h4 id="date-object"><code>Date</code> object</h4>\n<p>Create a new one:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> dateObjectName = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>([parameters]);\n</code></pre>\n<p>Example 1:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> today = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();\n<span class="hljs-keyword">var</span> endYear = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1995</span>, <span class="hljs-number">11</span>, <span class="hljs-number">31</span>, <span class="hljs-number">23</span>, <span class="hljs-number">59</span>, <span class="hljs-number">59</span>, <span class="hljs-number">999</span>); <span class="hljs-comment">// Set day and month</span>\nendYear.setFullYear(today.getFullYear()); <span class="hljs-comment">// Set year to this year</span>\n<span class="hljs-keyword">var</span> msPerDay = <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>; <span class="hljs-comment">// Number of milliseconds per day</span>\n<span class="hljs-keyword">var</span> daysLeft = (endYear.getTime() - today.getTime()) / msPerDay;\n<span class="hljs-keyword">var</span> daysLeft = <span class="hljs-built_in">Math</span>.round(daysLeft); <span class="hljs-comment">//returns days left in the year</span>\n</code></pre>\n<p>Example 2:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">JSClock</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">var</span> time = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();\n  <span class="hljs-keyword">var</span> hour = time.getHours();\n  <span class="hljs-keyword">var</span> minute = time.getMinutes();\n  <span class="hljs-keyword">var</span> second = time.getSeconds();\n  <span class="hljs-keyword">var</span> temp = <span class="hljs-string">\'\'</span> + ((hour &gt; <span class="hljs-number">12</span>) ? hour - <span class="hljs-number">12</span> : hour);\n  <span class="hljs-keyword">if</span> (hour == <span class="hljs-number">0</span>)\n    temp = <span class="hljs-string">\'12\'</span>;\n  temp += ((minute &lt; <span class="hljs-number">10</span>) ? <span class="hljs-string">\':0\'</span> : <span class="hljs-string">\':\'</span>) + minute;\n  temp += ((second &lt; <span class="hljs-number">10</span>) ? <span class="hljs-string">\':0\'</span> : <span class="hljs-string">\':\'</span>) + second;\n  temp += (hour &gt;= <span class="hljs-number">12</span>) ? <span class="hljs-string">\' P.M.\'</span> : <span class="hljs-string">\' A.M.\'</span>;\n  <span class="hljs-keyword">return</span> temp;\n}\n</code></pre>\n<h2 id="text-formatting">Text Formatting</h2>\n<h3 id="strings">Strings</h3>\n<h4 id="string-literals">String literals</h4>\n<p>Simple:</p>\n<pre><code class="hljs language-js"><span class="hljs-string">\'foo\'</span>\n<span class="hljs-string">"bar"</span>\n</code></pre>\n<p>Hexadecimal escape sequences:</p>\n<pre><code class="hljs language-js"><span class="hljs-string">\'\\xA9\'</span> <span class="hljs-comment">// "©"</span>\n</code></pre>\n<p>Unicode escape sequences:</p>\n<pre><code class="hljs language-js"><span class="hljs-string">\'\\u00A9\'</span> <span class="hljs-comment">// "©"</span>\n</code></pre>\n<p>Unicode code point escapes:</p>\n<pre><code class="hljs language-js"><span class="hljs-string">\'\\u{2F804}\'</span>\n\n<span class="hljs-comment">// the same with simple Unicode escapes</span>\n<span class="hljs-string">\'\\uD87E\\uDC04\'</span>\n</code></pre>\n<h4 id="string-objects">String Objects</h4>\n<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">\'foo\'</span>); <span class="hljs-comment">// Creates a String object</span>\n<span class="hljs-built_in">console</span>.log(foo); <span class="hljs-comment">// Displays: [String: \'foo\']</span>\n<span class="hljs-keyword">typeof</span> foo; <span class="hljs-comment">// Returns \'object\'</span>\n<span class="hljs-keyword">const</span> firstString = <span class="hljs-string">\'2 + 2\'</span>; <span class="hljs-comment">// Creates a string literal value</span>\n<span class="hljs-keyword">const</span> secondString = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">\'2 + 2\'</span>); <span class="hljs-comment">// Creates a String object</span>\n<span class="hljs-built_in">eval</span>(firstString); <span class="hljs-comment">// Returns the number 4</span>\n<span class="hljs-built_in">eval</span>(secondString); <span class="hljs-comment">// Returns the string "2 + 2"</span>\n</code></pre>\n<p>No need to create a String object, \'cause its <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Text_formatting#Methods_of_String">methods</a> could be called on String literals (js auto converts it to a String object and execute the methods, then discards that temporary object).</p>\n<h4 id="multi-line-template-literals">Multi-line template literals</h4>\n<h5 id="multi-lines">Multi-lines</h5>\n<p>Traditional:</p>\n<pre><code class="hljs language-js"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">\'string text line 1\\n\\\nstring text line 2\'</span>);\n<span class="hljs-comment">// "string text line 1</span>\n<span class="hljs-comment">// string text line 2"</span>\n</code></pre>\n<p>Now:</p>\n<pre><code class="hljs language-js"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">`string text line 1\nstring text line 2`</span>);\n<span class="hljs-comment">// "string text line 1</span>\n<span class="hljs-comment">// string text line 2"</span>\n</code></pre>\n<h5 id="embedded-expressions">Embedded expressions</h5>\n<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> five = <span class="hljs-number">5</span>;\n<span class="hljs-keyword">const</span> ten = <span class="hljs-number">10</span>;\n<span class="hljs-built_in">console</span>.log(<span class="hljs-string">\'Fifteen is \'</span> + (five + ten) + <span class="hljs-string">\' and not \'</span> + (<span class="hljs-number">2</span> * five + ten) + <span class="hljs-string">\'.\'</span>);\n<span class="hljs-comment">// "Fifteen is 15 and not 20."</span>\n</code></pre>\n<h3 id="internationalization">Internationalization</h3>\n<h4 id="date-and-time-formatting">Date and time formatting</h4>\n<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> msPerDay = <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;\n\n<span class="hljs-comment">// July 17, 2014 00:00:00 UTC.</span>\n<span class="hljs-keyword">const</span> july172014 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(msPerDay * (<span class="hljs-number">44</span> * <span class="hljs-number">365</span> + <span class="hljs-number">11</span> + <span class="hljs-number">197</span>));\n\n<span class="hljs-keyword">const</span> options = { <span class="hljs-attr">year</span>: <span class="hljs-string">\'2-digit\'</span>, <span class="hljs-attr">month</span>: <span class="hljs-string">\'2-digit\'</span>, <span class="hljs-attr">day</span>: <span class="hljs-string">\'2-digit\'</span>,\n                <span class="hljs-attr">hour</span>: <span class="hljs-string">\'2-digit\'</span>, <span class="hljs-attr">minute</span>: <span class="hljs-string">\'2-digit\'</span>, <span class="hljs-attr">timeZoneName</span>: <span class="hljs-string">\'short\'</span> };\n<span class="hljs-keyword">const</span> americanDateTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">\'en-US\'</span>, options).format;\n\n<span class="hljs-built_in">console</span>.log(americanDateTime(july172014)); <span class="hljs-comment">// 07/16/14, 5:00 PM PDT</span>\n</code></pre>\n<h4 id="number-formatting">Number formatting</h4>\n<pre><code class="hljs"><span class="hljs-keyword">const</span> gasPrice = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.NumberFormat(<span class="hljs-string">\'en-US\'</span>,\n                        { <span class="hljs-attr">style</span>: <span class="hljs-string">\'currency\'</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">\'USD\'</span>,\n                          <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">3</span> });\n\n<span class="hljs-built_in">console</span>.log(gasPrice.format(<span class="hljs-number">5.259</span>)); <span class="hljs-comment">// $5.259</span>\n\n<span class="hljs-keyword">const</span> hanDecimalRMBInChina = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.NumberFormat(<span class="hljs-string">\'zh-CN-u-nu-hanidec\'</span>,\n                        { <span class="hljs-attr">style</span>: <span class="hljs-string">\'currency\'</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">\'CNY\'</span> });\n\n<span class="hljs-built_in">console</span>.log(hanDecimalRMBInChina.format(<span class="hljs-number">1314.25</span>)); <span class="hljs-comment">// ￥ 一,三一四.二五</span>\n</code></pre>\n<h4 id="collation">Collation</h4>\n<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator">Collator</a> object is useful for comparing and sorting strings.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> names = [<span class="hljs-string">\'Hochberg\'</span>, <span class="hljs-string">\'Hönigswald\'</span>, <span class="hljs-string">\'Holzman\'</span>];\n\n<span class="hljs-keyword">const</span> germanPhonebook = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.Collator(<span class="hljs-string">\'de-DE-u-co-phonebk\'</span>);\n\n<span class="hljs-comment">// as if sorting ["Hochberg", "Hoenigswald", "Holzman"]:</span>\n<span class="hljs-built_in">console</span>.log(names.sort(germanPhonebook.compare).join(<span class="hljs-string">\', \'</span>));\n<span class="hljs-comment">// logs "Hochberg, Hönigswald, Holzman"</span>\n</code></pre>\n<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> germanDictionary = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.Collator(<span class="hljs-string">\'de-DE-u-co-dict\'</span>);\n\n<span class="hljs-comment">// as if sorting ["Hochberg", "Honigswald", "Holzman"]:</span>\n<span class="hljs-built_in">console</span>.log(names.sort(germanDictionary.compare).join(<span class="hljs-string">\', \'</span>));\n<span class="hljs-comment">// logs "Hochberg, Holzman, Hönigswald"</span>\n</code></pre>\n<h3 id="regular-expressions">Regular Expressions</h3>\n<ul>\n<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Creating_a_regular_expression">Creating a regular expression</a></li>\n<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Using_special_characters">Special Chars</a></li>\n</ul>\n<h2 id="indexed-collections">Indexed collections</h2>\n<h3 id="arrays">Arrays</h3>\n<p>Similar to array I know.<br>\n<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections#Populating_an_array">Can be populated with own Property</a>.<br>\nHas <code>forEach</code> function to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">do a set function on each element</a>.</p>\n<h3 id="typed-arrays">Typed Arrays</h3>\n<p>They have self descriptive names and provide views for all the usual numeric types like <code>Int8</code>, <code>Uint32</code>, <code>Float64</code> and so forth.</p>\n<h2 id="keyed-collections">Keyed collections</h2>\n<ul>\n<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Keyed_collections#WeakSet_object">Guide</a></li>\n<li>Map: Similar to dictionaries in python.</li>\n<li>Weakmap: Keys of WeakMaps are of the type Object only. Primitive data types as keys are not allowed (e.g. a Symbol can’t be a WeakMap key). One difference to Map objects is that WeakMap keys are not enumerable (i.e., there is no method giving you a list of the keys). If they were, the list would depend on the state of garbage collection, introducing non-determinism.</li>\n<li>Set: A value in a Set may only occur once; it is unique in the Set’s collection.</li>\n<li>Weakset: In contrast to Sets, WeakSets are collections of objects only and not of arbitrary values of any type. The WeakSet is weak: References to objects in the collection are held weakly. If there is no other reference to an object stored in the WeakSet, they can be garbage collected. That also means that there is no list of current objects stored in the collection. WeakSets are not enumerable.</li>\n</ul>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://skillcrush.com/2018/06/18/projects-you-can-do-with-javascript/">Here Are 10 Projects You Can Do To Build Your JavaScript Skills</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://snorl.ax">The homepage of the site</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn3" class="footnote-item"><p><a href="https://www.w3schools.com/js/js_timing.asp">JavaScript Timing Events</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn4" class="footnote-item"><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide">JavaScript Guide - JavaScript | MDN</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn5" class="footnote-item"><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template literals (Template strings) - JavaScript | MDN</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn6" class="footnote-item"><p><a href="/terminal/2019/05/07/notes-on-types-grammer-ydjs/">Notes on Types &amp; Grammer (YDJS)</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn7" class="footnote-item"><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise - JavaScript | MDN</a> <a href="#fnref7" class="footnote-backref">↩︎</a> <a href="#fnref7:1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn8" class="footnote-item"><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/super">super - JavaScript | MDN</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',F.path="~/contents/Terminal/20190523-notes-on-mdn-web-docs-js.md",P.attributes={title:"Notes on Async & Performance (YDJS)",author:e,tags:["js",bs,ss],status:a,summary:"Notes on You Don't Know JS: Async & Performance.",date:"2019-05-17 17:00",modified:"2019-05-19 22:00",Series:Xs,category:n,published:s},P.html='<p>Seems I’ve taken rather complicated note one the last one.</p>\n<h2 id="chapter-1-asynchrony-now-later">Chapter 1: Asynchrony: Now &amp; Later</h2>\n<p>One of the most essential parts in language like ja is about how to express and manipulate program over time. Before getting there, it’s helpful to understand much more deeply what asynchrony is and how it operates in JS.</p>\n<h3 id="a-program-in-chunks">A Program in Chunks</h3>\n<p><em>now</em> chunk: stuff that runs now.<br>\n<em>later</em> chunk: stuff that runs later.</p>\n<h4 id="async-console">Async Console</h4>\n<p><code>console.log</code> differs between different browsers. Some doesn’t output the result immediately.</p>\n<h3 id="event-loop">Event Loop</h3>\n<p>It acts as a queue, first-in, first-out.</p>\n<h3 id="parallel-threading">Parallel Threading</h3>\n<p>In a parallel system, avoid the different actions on the same variable, which might lead to unexpected results (different orders, different results on the same codes).</p>\n<p><code>race condition</code>: function ordering nondeterminism.</p>\n<h3 id="concurrency">Concurrency</h3>\n<p>The single-threaded event loop is one expression of concurrency with sequential results.</p>\n<h4 id="noninteracting">Noninteracting</h4>\n<p>If two concurrent processes act independently, the code will behave right regardless of ordering.</p>\n<h4 id="interaction">Interaction</h4>\n<p>Do things to coordinate interactions between processes:</p>\n<ol>\n<li>Push two individuals into the array(<code>arrvar.push(thing)</code>) and make sure the order: determine the order in advance</li>\n<li>Assign value to var a and var b in different processes and need them both at the same time: make sure <code>a &amp;&amp; b</code> returns true in <code>if</code>.</li>\n<li>Different call on the same variable <code>a</code> and may cause unexpected result: <code>if (a == undefined)</code></li>\n</ol>\n<h4 id="cooperation">Cooperation</h4>\n<p>An Ajax response handler that needs to run through a long list of results to transform the values:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> res = [];\n\n<span class="hljs-comment">// `response(..)` receives array of results from the Ajax call</span>\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">response</span>(<span class="hljs-params">data</span>) </span>{\n\t<span class="hljs-comment">// let\'s just do 1000 at a time</span>\n\t<span class="hljs-keyword">var</span> chunk = data.splice( <span class="hljs-number">0</span>, <span class="hljs-number">1000</span> );\n\n\t<span class="hljs-comment">// add onto existing `res` array</span>\n\tres = res.concat(\n\t\t<span class="hljs-comment">// make a new transformed array with all `chunk` values doubled</span>\n\t\tchunk.map( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>)</span>{\n\t\t\t<span class="hljs-keyword">return</span> val * <span class="hljs-number">2</span>;\n\t\t} )\n\t);\n\n\t<span class="hljs-comment">// anything left to process?</span>\n\t<span class="hljs-keyword">if</span> (data.length &gt; <span class="hljs-number">0</span>) {\n\t\t<span class="hljs-comment">// async schedule next batch</span>\n\t\tsetTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n\t\t\tresponse( data );\n\t\t}, <span class="hljs-number">0</span> );\n\t}\n}\n\n<span class="hljs-comment">// ajax(..) is some arbitrary Ajax function given by a library</span>\najax( <span class="hljs-string">"http://some.url.1"</span>, response );\najax( <span class="hljs-string">"http://some.url.2"</span>, response );\n</code></pre>\n<p><code>setTimeout(..0)</code> is not technically inserting an item directly onto the event loop queue. The timer will insert the event at its next opportunity. Not guaranteed to process in call order. There’s not a single direct way (at least yet) across all environments to ensure async event ordering. This topic will be covered in more detail in the next section.</p>\n<h3 id="jobs">Jobs</h3>\n<p><code>Job Queue</code>: New concept in ES6. Make the job implemented <strong>later, but as soon as possible</strong>.</p>\n<h3 id="statement-ordering">Statement Ordering</h3>\n<p>The order in which we express statements in our code is not necessarily the same order as the JS engine will execute them. That may seem like quite a strange assertion to make.</p>\n<h2 id="chapter-2-callbacks">Chapter 2: Callbacks</h2>\n<p><code>callback</code>: the target for the event loop to “call back into” the program, whenever that item in the queue is processed.</p>\n<p>The callback function is the async work horse for JavaScript, and it does its job respectably. A couple of these is explored in the chapter.</p>\n<h3 id="continuations">Continuations</h3>\n<p>First half executes immediately, then pause at the callback function to get the response, then continue with the second half.</p>\n<h3 id="sequential-brain">Sequential Brain</h3>\n<p>JS would probably feel like a sequential brain, switching to various different processes constantly.</p>\n<h4 id="doing-versus-planning">Doing Versus Planning</h4>\n<p>The reason it’s so hard to accrately author and reason about async JS code with callbacks: it’s not how our brain works.</p>\n<h4 id="nestedchained-callbacks">Nested/Chained Callbacks</h4>\n<p><code>callback hells</code>: callback continuations are happening <em>simultaneously</em>.</p>\n<h3 id="trust-issues">Trust Issues</h3>\n<p><code>inversion of control</code>: you take part of your program and give over control of its execution to another third party</p>\n<h4 id="tale-of-five-callbacks">Tale of Five Callbacks</h4>\n<p>Investing an awful lot of ad hoc logic <strong>in every and single callback</strong> leads to <code>callback hell</code>.</p>\n<h4 id="not-just-others-code">Not Just Others’ Code</h4>\n<p>Necessary to do <em>inversion of control</em>.</p>\n<h3 id="trying-to-save-callbacks">Trying to Save Callbacks</h3>\n<p>trust issues:</p>\n<ol>\n<li>There’s nothing about either callback that prevents or filters unwanted repeated invocations.</li>\n<li>Being never called</li>\n<li>Too Early</li>\n</ol>\n<p>ES6 has arrived on the scene with some great answers to these trust issues.</p>\n<h3 id="review">Review</h3>\n<p>We need a generalized solution to <strong>all of the trust issues</strong>, one that can be reused for as many callbacks as we create without all the extra boilerplate overhead.</p>\n<p>We need something better than callbacks. They’ve served us well to this point, but the <em>future</em> of JavaScript demands more sophisticated and capable async patterns.</p>\n<h2 id="chapter-3-promises">Chapter 3: Promises</h2>\n<p>To b continued…</p>\n',P.path="~/contents/Terminal/20190517-you-dont-know-js-note.md",B.attributes={title:"Notes on Types & Grammer (YDJS)",author:e,tags:["js",bs,ss],status:a,summary:"Notes on the first two chapters. I just started taking notes. Js is kinda confusing.",date:"2019-05-07 17:00",modified:"2019-05-17 22:24",Series:Xs,category:n,published:s},B.html='<p>Just started taking notes. Forgot to take notes on the former three. To summerize, js is about one object linked to another. A lot to learn for me. So it’s best to learn it quickly the first time and then start learning by doing. I’ll try Firebase function.</p>\n<h2 id="chapter-1">Chapter 1</h2>\n<p>In JavaScript, variables don’t have types – values have types. Variables can hold any value, at any time.</p>\n<p>“not defined” means the var being not declared.<br>\nundefined means the var doesn’t have a value.<br>\nundefined is our friend to check if the var has a value.<br>\ntypeof returns undefined for both undeclared and undefined var</p>\n<h2 id="chapter-2">Chapter 2</h2>\n<p>Array are also objects which can have keys/values.</p>\n<p>String is an array consisting of immutable chars. Meanwhile array has lots of usable functions String don’t have.<br>\nUse split to convert string to array then do the things.<br>\nOr use the array from the start.</p>\n<p>Number:toFixed(digit) is similar to toPrecision(digit)<br>\n0.1+0.2 !== 0.3</p>\n<p>We can use this Number.EPSILON to compare two numbers for “equality” (within the rounding error tolerance)</p>\n<p>void: here’s where don’t understand, what’s the use? I might look into it sometimes.</p>\n<p>isNaN: 2 / “foo” etc</p>\n<p>Infinity: 1/0</p>\n<p>Object.is(a,b): Special Equality</p>\n<h2 id="chapter-3">Chapter 3</h2>\n<p>They are constructors of type wrappers:</p>\n<ul>\n<li><code>String()</code></li>\n<li><code>Number()</code></li>\n<li><code>Boolean()</code></li>\n<li><code>Array()</code></li>\n<li><code>Object()</code></li>\n<li><code>Function()</code></li>\n<li><code>RegExp()</code></li>\n<li><code>Date()</code></li>\n<li><code>Error()</code></li>\n<li><code>Symbol()</code> – added in ES6!</li>\n</ul>\n<p>For example, <code>var s = new String( &quot;Hello World!&quot; );</code> constructs a String wrapper. To convert it to String, <code>s.toString()</code>.<br>\nInternal <code>[[class]]</code> can be inspected using <code>Object.prototype.toString.call()</code>.<br>\nBoxing wrapper is type wrapper having methods. Thankfully, JS will automatically box the primitive value to do methods. No need in doing things like <code>new String(&quot;abc&quot;)</code>, just use the primitive values like <code>&quot;abc&quot;</code>.<br>\nBoolean wrapper created by <code>new boolean()</code> is truthy itself no matter it’s true or false.<br>\nUse <code>valueof()</code> to unbox the warpper and get the value.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">"abc"</span>);\na.valueof();\n</code></pre>\n<p>Unboxing can happen implicitly:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>( <span class="hljs-string">"abc"</span> );\n<span class="hljs-keyword">var</span> b = a + <span class="hljs-string">""</span>; <span class="hljs-comment">// `b` has the unboxed primitive value "abc"</span>\n\n<span class="hljs-keyword">typeof</span> a; <span class="hljs-comment">// "object"</span>\n<span class="hljs-keyword">typeof</span> b; <span class="hljs-comment">// "string"</span>\n</code></pre>\n<p>Just as we’ve seen above with the other natives, these constructor forms should generally be avoided, unless you really know you need them, mostly because they introduce exceptions and gotchas that you probably don’t really want to deal with.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>( <span class="hljs-number">3</span> );\n<span class="hljs-keyword">var</span> b = [ <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span> ];\n<span class="hljs-keyword">var</span> c = [];\nc.length = <span class="hljs-number">3</span>;\n\na;\nb;\nc;\n</code></pre>\n<pre><code class="hljs language-js">a.join( <span class="hljs-string">"-"</span> ); <span class="hljs-comment">// "--"</span>\nb.join( <span class="hljs-string">"-"</span> ); <span class="hljs-comment">// "--"</span>\n\na.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v,i</span>)</span>{ <span class="hljs-keyword">return</span> i; }); <span class="hljs-comment">// [ undefined x 3 ]</span>\nb.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v,i</span>)</span>{ <span class="hljs-keyword">return</span> i; }); <span class="hljs-comment">// [ 0, 1, 2 ]</span>\n</code></pre>\n<p>Bottom line: never ever, under any circumstances, should you intentionally create and use those empty-slot arrays. Just don’t do it. They’re nuts.</p>\n<p>Also optional: Object(…), Function(…), and RegExp(…)</p>\n<p>The <code>Date(..)</code> and <code>Error(..)</code> native constructors are much more useful than the other natives, because there is no literal form for either. <code>Date.now()</code> shows a time value. <code>throw new Error(&quot;x wasn\'t provided&quot;)</code> throw a new error <code>&quot;x wasn\'t provided&quot;</code>. In addition to <code>Error()</code>, there are several specific-error-type natives though it’s rare to use them manually: <code>EvalError(..)</code>, <code>RangeError(..)</code>, <code>ReferenceError(..)</code>, <code>SyntaxError(..)</code>, <code>TypeError(..)</code>, and <code>URIError(..)</code>.</p>\n<p><code>Symbol</code> are unique in that you are not allowed to use <code>new</code> with it. Using them for private or special properties is likely their primary use-case. (Ex: <code>Symbol.ierator</code>, to define use <code>Symbol(&quot;statement&quot;)</code>)</p>\n<p>Some of the native Prototypes are aren’t just plain objects:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Function</span>.prototype;\t\t\t<span class="hljs-comment">// "function"</span>\n<span class="hljs-built_in">Function</span>.prototype();\t\t\t\t<span class="hljs-comment">// it\'s an empty function!</span>\n\n<span class="hljs-built_in">RegExp</span>.prototype.toString();\t\t<span class="hljs-comment">// "/(?:)/" -- empty regex</span>\n<span class="hljs-string">"abc"</span>.match( <span class="hljs-built_in">RegExp</span>.prototype );\t<span class="hljs-comment">// [""]</span>\n</code></pre>\n<p>The chapter leads through a journey about knowing interestings underlying wrappers and prototypes. Hmm… Hope to know something practical.</p>\n<h2 id="chapter-4">Chapter 4</h2>\n<p>Coercion is controversial. Most people run away from them. Try to get it more fully though it can be confusing.</p>\n<h3 id="converting-values">Converting values</h3>\n<p>JavaScript coercions always result in one of the scalar primitive (see Chapter 2) values, like <code>string</code>, <code>number</code>, or <code>boolean</code>.<br>\nIn js, most people call all the types of conversions “coercion”.<br>\nThe author prefer to distinguish all the type conversion as “implicit coercion”(intended) vs. “explicit coercion.”(occurred as a side effect of some other intentional operation)</p>\n<p><strong>Example</strong>:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n\n<span class="hljs-keyword">var</span> b = a + <span class="hljs-string">""</span>;\t\t\t<span class="hljs-comment">// implicit coercion</span>\n\n<span class="hljs-keyword">var</span> c = <span class="hljs-built_in">String</span>( a );\t<span class="hljs-comment">// explicit coercion</span>\n</code></pre>\n<h3 id="abstract-value-operations">Abstract Value Operations</h3>\n<h4 id="tostring"><code>ToString</code></h4>\n<p>The default <code>toString</code> (<code>StObject.prototype.toString()</code>) returns the *internal <code>[[Class]]</code>.<br>\nIf an object has its own <code>toString</code>, the result will be <code>string</code> instead.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];\n\na.toString(); <span class="hljs-comment">// "1,2,3"</span>\n</code></pre>\n<h5 id="json-stringification">JSON Stringification</h5>\n<p>Another task that seems awfully related to <code>ToString</code> is when you use the <code>JSON.stringify(..)</code> utility to serialize a value to a JSON-compatible <code>string</code> value.</p>\n<pre><code class="hljs language-js"><span class="hljs-built_in">JSON</span>.stringify( <span class="hljs-number">42</span> );\t<span class="hljs-comment">// "42"</span>\n<span class="hljs-built_in">JSON</span>.stringify( <span class="hljs-string">"42"</span> );\t<span class="hljs-comment">// ""42"" (a string with a quoted string value in it)</span>\n<span class="hljs-built_in">JSON</span>.stringify( <span class="hljs-literal">null</span> );\t<span class="hljs-comment">// "null"</span>\n<span class="hljs-built_in">JSON</span>.stringify( <span class="hljs-literal">true</span> );\t<span class="hljs-comment">// "true"</span>\n</code></pre>\n<p><code>JSON.stringify(..)</code> with an <code>object</code> as argument can make an error thrown.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> o = { };\n\n<span class="hljs-keyword">var</span> a = {\n\t<span class="hljs-attr">b</span>: <span class="hljs-number">42</span>,\n\t<span class="hljs-attr">c</span>: o,\n\t<span class="hljs-attr">d</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{}\n};\n\n<span class="hljs-comment">// create a circular reference inside `a`</span>\no.e = a;\n\n<span class="hljs-comment">// would throw an error on the circular reference</span>\n<span class="hljs-comment">// JSON.stringify( a );</span>\n\n<span class="hljs-comment">// define a custom JSON value serialization</span>\na.toJSON = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-comment">// only include the `b` property for serialization</span>\n\t<span class="hljs-keyword">return</span> { <span class="hljs-attr">b</span>: <span class="hljs-keyword">this</span>.b };\n};\n\n<span class="hljs-built_in">JSON</span>.stringify( a ); <span class="hljs-comment">// "{"b":42}"</span>\n</code></pre>\n<p><code>toJSON()</code> should be interpreted as “to a JSON-safe value suitable for stringification,” not “to a JSON string” as many developers mistakenly assume.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = {\n\t<span class="hljs-attr">val</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],\n\n\t<span class="hljs-comment">// probably correct!</span>\n\t<span class="hljs-attr">toJSON</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.val.slice( <span class="hljs-number">1</span> );\n\t}\n};\n\n<span class="hljs-keyword">var</span> b = {\n\t<span class="hljs-attr">val</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],\n\n\t<span class="hljs-comment">// probably incorrect!</span>\n\t<span class="hljs-attr">toJSON</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-string">"["</span> +\n\t\t\t<span class="hljs-keyword">this</span>.val.slice( <span class="hljs-number">1</span> ).join() +\n\t\t<span class="hljs-string">"]"</span>;\n\t}\n};\n\n<span class="hljs-built_in">JSON</span>.stringify( a ); <span class="hljs-comment">// "[2,3]"</span>\n\n<span class="hljs-built_in">JSON</span>.stringify( b ); <span class="hljs-comment">// ""[2,3]""</span>\n</code></pre>\n<p>Lesser known functionality:<br>\n<strong>replacer</strong>: An optional second argument can be passed to <code>JSON.stringify(..)</code>. Can be an <code>array</code> or a <code>function</code>.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = {\n\t<span class="hljs-attr">b</span>: <span class="hljs-number">42</span>,\n\t<span class="hljs-attr">c</span>: <span class="hljs-string">"42"</span>,\n\t<span class="hljs-attr">d</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]\n};\n\n<span class="hljs-built_in">JSON</span>.stringify( a, [<span class="hljs-string">"b"</span>,<span class="hljs-string">"c"</span>] ); <span class="hljs-comment">// "{"b":42,"c":"42"}"</span>\n\n<span class="hljs-built_in">JSON</span>.stringify( a, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">k,v</span>)</span>{\n\t<span class="hljs-keyword">if</span> (k !== <span class="hljs-string">"c"</span>) <span class="hljs-keyword">return</span> v;\n} );\n<span class="hljs-comment">// "{"b":42,"d":[1,2,3]}"</span>\n</code></pre>\n<p><code>space</code>: A third argument passed to <code>JSON.stringify(..)</code>. Can be a positive number (how many space characters shoule be used at each indentation level) or a <code>string</code> (up to the first ten characters of its value will be used for each indentation level).</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = {\n\t<span class="hljs-attr">b</span>: <span class="hljs-number">42</span>,\n\t<span class="hljs-attr">c</span>: <span class="hljs-string">"42"</span>,\n\t<span class="hljs-attr">d</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]\n};\n\n<span class="hljs-built_in">JSON</span>.stringify( a, <span class="hljs-literal">null</span>, <span class="hljs-number">3</span> );\n<span class="hljs-comment">// "{</span>\n<span class="hljs-comment">//    "b": 42,</span>\n<span class="hljs-comment">//    "c": "42",</span>\n<span class="hljs-comment">//    "d": [</span>\n<span class="hljs-comment">//       1,</span>\n<span class="hljs-comment">//       2,</span>\n<span class="hljs-comment">//       3</span>\n<span class="hljs-comment">//    ]</span>\n<span class="hljs-comment">// }"</span>\n\n<span class="hljs-built_in">JSON</span>.stringify( a, <span class="hljs-literal">null</span>, <span class="hljs-string">"-----"</span> );\n<span class="hljs-comment">// "{</span>\n<span class="hljs-comment">// -----"b": 42,</span>\n<span class="hljs-comment">// -----"c": "42",</span>\n<span class="hljs-comment">// -----"d": [</span>\n<span class="hljs-comment">// ----------1,</span>\n<span class="hljs-comment">// ----------2,</span>\n<span class="hljs-comment">// ----------3</span>\n<span class="hljs-comment">// -----]</span>\n<span class="hljs-comment">// }"</span>\n</code></pre>\n<ol>\n<li><code>string</code>, <code>number</code>, <code>boolean</code>, and <code>null</code> values all stringify for JSON basically the same as how they coerce to <code>string</code> values via the rules of the <code>ToString</code> abstract operation.</li>\n<li>If you pass an <code>object</code> value to <code>JSON.stringify(..)</code>, and that <code>object</code> has a <code>toJSON()</code> method on it, <code>toJSON()</code> is automatically called to (sort of) “coerce” the value to be <em>JSON-safe</em> before stringification.</li>\n</ol>\n<h4 id="tonumber"><code>toNumber</code></h4>\n<p>Convert a non-<code>number</code> value to a <code>number</code>. If the conversion fails, it will return a <code>NaN</code> instead.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = {\n\t<span class="hljs-attr">valueOf</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-string">"42"</span>;\n\t}\n};\n\n<span class="hljs-keyword">var</span> b = {\n\t<span class="hljs-attr">toString</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-string">"42"</span>;\n\t}\n};\n\n<span class="hljs-keyword">var</span> c = [<span class="hljs-number">4</span>,<span class="hljs-number">2</span>];\nc.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n\t<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.join( <span class="hljs-string">""</span> );\t<span class="hljs-comment">// "42"</span>\n};\n\n<span class="hljs-built_in">Number</span>( a );\t\t\t<span class="hljs-comment">// 42</span>\n<span class="hljs-built_in">Number</span>( b );\t\t\t<span class="hljs-comment">// 42</span>\n<span class="hljs-built_in">Number</span>( c );\t\t\t<span class="hljs-comment">// 42</span>\n<span class="hljs-built_in">Number</span>( <span class="hljs-string">""</span> );\t\t\t<span class="hljs-comment">// 0</span>\n<span class="hljs-built_in">Number</span>( [] );\t\t\t<span class="hljs-comment">// 0</span>\n<span class="hljs-built_in">Number</span>( [ <span class="hljs-string">"abc"</span> ] );\t<span class="hljs-comment">// NaN</span>\n</code></pre>\n<h4 id="toboolean"><code>toBoolean</code></h4>\n<p>One thing to notice: <code>0</code> can be coerced to <code>false</code>, or <code>1</code> to <code>true</code> (and vice versa). But they r not the same.</p>\n<h5 id="falsy-values">Falsy Values</h5>\n<p>So-called falsy values will be coerced into <code>false</code> if you force a <code>boolean</code> coercion on it:</p>\n<ul>\n<li><code>undefined</code></li>\n<li><code>null</code></li>\n<li><code>false</code></li>\n<li><code>+0</code>, <code>-0</code>, and <code>NaN</code></li>\n<li><code>&quot;&quot;</code></li>\n</ul>\n<h5 id="falsy-objects">Falsy Objects</h5>\n<p>As the name says, they r objects … <code>false</code> … <code>boolean</code> coercion …</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Boolean</span>( <span class="hljs-literal">false</span> );\n<span class="hljs-keyword">var</span> b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Number</span>( <span class="hljs-number">0</span> );\n<span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>( <span class="hljs-string">""</span> );\n</code></pre>\n<p>THey seem to be falsy, but that’s not true:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Boolean</span>(<span class="hljs-literal">false</span>);\n<span class="hljs-keyword">var</span> b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Boolean</span>(<span class="hljs-number">0</span>);\n<span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Boolean</span>(<span class="hljs-string">""</span>);\na &amp;&amp; b &amp;&amp; c;\n<span class="hljs-comment">// Boolean { false }</span>\na;\n<span class="hljs-comment">// Boolean { false }</span>\n<span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Boolean</span>(a &amp;&amp; b &amp;&amp; c);\nd;\n<span class="hljs-comment">// true</span>\n<span class="hljs-keyword">var</span> d = a &amp;&amp; b &amp;&amp; c;\nd;\n<span class="hljs-comment">// Boolean { false }</span>\nb;\n<span class="hljs-comment">// Boolean { false }</span>\nc;\n<span class="hljs-comment">// Boolean { false }</span>\n<span class="hljs-built_in">Boolean</span>(a);\n<span class="hljs-comment">// true</span>\n<span class="hljs-built_in">Boolean</span>(b);\n<span class="hljs-comment">// true</span>\n<span class="hljs-built_in">Boolean</span>(c);\n<span class="hljs-comment">// true</span>\n\n</code></pre>\n<p>A most well-known case:</p>\n<pre><code class="hljs language-js"><span class="hljs-built_in">Boolean</span>(<span class="hljs-built_in">document</span>.all);\n<span class="hljs-comment">// false</span>\n</code></pre>\n<p><code>document.all</code> itself was never really “standard” and has long since been deprecated/abandoned. They are used as a means of detecting old, nonstandard IE.</p>\n<h5 id="truthy-values">Truthy Values</h5>\n<p>It’s the counterpart of the falsy values.</p>\n<p>My runs for the examples:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"false"</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-string">"0"</span>;\n<span class="hljs-keyword">var</span> c = <span class="hljs-string">"\'\'"</span>;\n<span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Boolean</span>(a &amp;&amp; b &amp;&amp; c);\nd;\n<span class="hljs-comment">// true</span>\na;\n<span class="hljs-comment">// "false"</span>\nb;\n<span class="hljs-comment">// "0"</span>\nc;\n<span class="hljs-comment">// "\'\'"</span>\na &amp;&amp; b &amp;&amp; c;\n<span class="hljs-comment">// "\'\'"</span>\n<span class="hljs-keyword">var</span> a = [];\n<span class="hljs-keyword">var</span> b = {};\n<span class="hljs-keyword">var</span> c = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{};\n<span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Boolean</span>(a &amp;&amp; b &amp;&amp; c);\nd;\n<span class="hljs-comment">// true</span>\n</code></pre>\n<p>To know whether a value is truthy, consult a finite falsy list. A truthy list would be infinitely long.</p>\n<h3 id="explicit-coercion">Explicit Coercion</h3>\n<p>As the name says, the coercion is explicit and obvious.</p>\n<h4 id="strings-numbers">Strings &lt;==&gt; Numbers</h4>\n<p>Don’t use the <code>new</code> keyword as in doing such a wrapped object will be created.<br>\nMy runs:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-built_in">String</span>(a);\n<span class="hljs-keyword">var</span> c = <span class="hljs-string">"3.14"</span>;\n<span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Number</span>(c);\nb;\n<span class="hljs-comment">// "42"</span>\nd;\n<span class="hljs-comment">// 3.14</span>\n</code></pre>\n<p>My runs on another way:</p>\n<pre><code class="hljs language-js"><span class="hljs-comment">//inherited from previously created var a, c</span>\n<span class="hljs-keyword">var</span> b = a.toString();\n<span class="hljs-keyword">var</span> d = +c;\nb;\n<span class="hljs-comment">// "42"</span>\nd;\n<span class="hljs-comment">// 3.14</span>\n</code></pre>\n<p>Something implicit happened here: <code>a</code> was automatically boxed as the primitive value doesn’t have the function.<br>\nTHe unary <code>+</code> is explicitly intended for <code>number</code> coercion.</p>\n<p><code>++</code> and <code>--</code> have the side effect like they do in c/c++.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> c = <span class="hljs-string">"3.14"</span>;\n<span class="hljs-keyword">var</span> d = <span class="hljs-number">5</span> + -c;\nd;\n<span class="hljs-comment">// 1.8599999999999999</span>\n<span class="hljs-keyword">var</span> d = <span class="hljs-number">5</span> + +c;\nd;\n<span class="hljs-comment">// 8.14</span>\n<span class="hljs-keyword">var</span> d = <span class="hljs-number">5</span> + ++c;\nd;\n<span class="hljs-comment">// 9.14</span>\n<span class="hljs-keyword">var</span> d = <span class="hljs-number">5</span> + --c;\nd;\n<span class="hljs-comment">// 8.14</span>\nc;\n<span class="hljs-comment">// 3.1400000000000006</span>\n<span class="hljs-keyword">var</span> d = <span class="hljs-number">5</span> + --c;\nc;\n<span class="hljs-comment">// 2.1400000000000006</span>\n</code></pre>\n<p>Trying to be explicit and <strong>reduce confusion</strong>, not make it worse.</p>\n<h5 id="date-to-number"><code>Date</code> To <code>Number</code></h5>\n<p>Use <code>+</code> to coerce a date into a <code>number</code> that is the unix timestamp.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">"2019-05-09 20:00"</span>);\n\n+d;\n<span class="hljs-comment">// 1557403200000</span>\n</code></pre>\n<p><code>+</code> get the now moment as a timestamp:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> now_timestamp = +<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();\nnow_timestamp;\n<span class="hljs-comment">// 1557403504691</span>\n</code></pre>\n<p>Due to a peculiar syntactic “trick”, it’s doable to omit <code>()</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> now_timestamp = +<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>;\nnow_timestamp;\n<span class="hljs-comment">// 1557403628543</span>\n</code></pre>\n<p>A noncoercion approach is preferred:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();\ntimestamp\n<span class="hljs-comment">// 1557405924752</span>\n</code></pre>\n<p>A more prefferred and recommended way:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> timestamp = <span class="hljs-built_in">Date</span>.now();\n\ntimestamp;\n<span class="hljs-comment">// 1557406018081</span>\n</code></pre>\n<h5 id="the-curious-case-of-the-~">The Curious Case of the <code>~</code></h5>\n<p>It’s a bitwise operator.</p>\n<p>It’s pretty common to try to use <code>indexOf(..)</code> not just as an operation to get the position, but as a <code>boolean</code> check of presence/absence of a substring in another <code>string</code>. Here’s how developers usually perform such checks:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"Hello world"</span>;\n<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">"lo"</span>) &gt;= <span class="hljs-number">0</span>) {\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"True hmm......."</span>);\n}\n<span class="hljs-comment">// True hmm.......</span>\n<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">"lo"</span>) != <span class="hljs-number">-1</span>) {\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Uh"</span>);\n}\n<span class="hljs-comment">// Uh</span>\n<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">"ol"</span>) &lt; <span class="hljs-number">0</span>) {\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Uh"</span>);\n}\n<span class="hljs-comment">// Uh</span>\n<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">"ol"</span>) == <span class="hljs-number">-1</span>) {\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Uh"</span>);\n}\n<span class="hljs-comment">// Uh</span>\na.indexOf(<span class="hljs-string">"lo"</span>)\n<span class="hljs-comment">// 3</span>\na.indexOf(<span class="hljs-string">"ol"</span>)\n<span class="hljs-comment">// -1</span>\n</code></pre>\n<p>Whether the substring is found or not, the number is treated as true in <code>if</code>.</p>\n<pre><code class="hljs language-js">~a.indexOf(<span class="hljs-string">"lo"</span>);\n<span class="hljs-comment">// -4</span>\n<span class="hljs-keyword">if</span> (~a.indexOf(<span class="hljs-string">"lo"</span>)) {\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Found \'lo\'"</span>);\n}\n<span class="hljs-comment">// Found \'lo\'</span>\n~a.indexOf(<span class="hljs-string">"ol"</span>);\n<span class="hljs-comment">// 0</span>\n!~a.indexOf(<span class="hljs-string">"ol"</span>);\n<span class="hljs-comment">// true</span>\n!~a.indexOf(<span class="hljs-string">"lo"</span>);\n<span class="hljs-comment">// false</span>\n<span class="hljs-keyword">if</span> (!~a.indexOf(<span class="hljs-string">"ol"</span>)) {\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Not found"</span>);\n}\n<span class="hljs-comment">// Not found</span>\n<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">"ol"</span>)) {\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Found"</span>);\n}\n<span class="hljs-comment">// no output</span>\n</code></pre>\n<p><code>~</code> takes the return value of <code>indexOf(..)</code> and transforms it: for the “failure” <code>-1</code> we get the falsy <code>0</code>, and every other value is truthy.</p>\n<h6 id="truncating-bits">Truncating Bits</h6>\n<p><code>~~</code> to truncate the decimal part of a <code>number</code>. First, it only works reliably on 32-bit values. But more importantly, it doesn’t work the same on negative numbers as <code>Math.floor(..)</code> does:</p>\n<pre><code class="hljs language-js"><span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">-49.6</span>);\n<span class="hljs-comment">// -50</span>\n~~<span class="hljs-number">-49.6</span>;\n<span class="hljs-comment">// -49</span>\n</code></pre>\n<p><code>x | 0</code> does the same job, but:</p>\n<pre><code class="hljs language-JS">~~<span class="hljs-number">1E20</span> /<span class="hljs-number">10</span>;\n<span class="hljs-comment">// 166199296</span>\n~~<span class="hljs-number">1E20</span> | <span class="hljs-number">0</span> /<span class="hljs-number">10</span>;\n<span class="hljs-comment">// 1661992960</span>\n(~~<span class="hljs-number">1E20</span> | <span class="hljs-number">0</span>) /<span class="hljs-number">10</span>;\n<span class="hljs-comment">// 166199296</span>\n</code></pre>\n<h4 id="explicitly-parsing-numeric-strings">Explicitly: Parsing Numeric Strings</h4>\n<p>Between parsing and type conversion:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"42"</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-string">"42px"</span>;\n<span class="hljs-built_in">Number</span>(a);\n<span class="hljs-comment">// 42</span>\n<span class="hljs-built_in">Number</span>(b);\n<span class="hljs-comment">// NaN</span>\n<span class="hljs-built_in">parseInt</span>(a);\n<span class="hljs-comment">// 42</span>\n<span class="hljs-built_in">parseInt</span>(b);\n<span class="hljs-comment">// 42</span>\n</code></pre>\n<p>a twin of <code>parseInt</code>: <code>parseFloat</code></p>\n<p>In <code>parseInt</code>, it’s safe to pass the second parameter to set the base:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> min = <span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"09"</span>);\n<span class="hljs-keyword">var</span> hour = <span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"08"</span>);\nmin;\n<span class="hljs-comment">// 9</span>\nhour;\n<span class="hljs-comment">// 8</span>\n<span class="hljs-keyword">var</span> hour = <span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"08"</span>, <span class="hljs-number">8</span>);\nhour;\n<span class="hljs-comment">// 0</span>\n<span class="hljs-keyword">var</span> hour = <span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"09"</span>, <span class="hljs-number">8</span>);\nhour;\n<span class="hljs-comment">// 0</span>\n</code></pre>\n<h5 id="parsing-non-strings">Parsing Non-Strings</h5>\n<p>All output are predictable in that all <code>js</code> representation have some sort of default <code>string</code> representation:</p>\n<pre><code class="hljs language-js"><span class="hljs-built_in">parseInt</span>(<span class="hljs-number">1</span>/<span class="hljs-number">0</span>, <span class="hljs-number">18</span>);\n<span class="hljs-comment">// NaN</span>\n<span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">"42"</span>));\n<span class="hljs-comment">// 42</span>\n<span class="hljs-keyword">var</span> a = {\n    <span class="hljs-attr">num</span>: <span class="hljs-number">21</span>,\n    <span class="hljs-attr">toString</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>( <span class="hljs-keyword">this</span>.num * <span class="hljs-number">2</span> ); }\n};\n<span class="hljs-built_in">parseInt</span>( a );\n<span class="hljs-comment">// 42</span>\n<span class="hljs-built_in">parseInt</span>(<span class="hljs-number">0.000008</span>);\n<span class="hljs-comment">// 0</span>\n<span class="hljs-built_in">parseInt</span>(<span class="hljs-number">0.0000008</span>);\n<span class="hljs-comment">// 8</span>\n<span class="hljs-built_in">parseInt</span>(<span class="hljs-literal">false</span>, <span class="hljs-number">16</span>);\n<span class="hljs-comment">// 250</span>\n<span class="hljs-built_in">parseInt</span>(<span class="hljs-built_in">parseInt</span>, <span class="hljs-number">16</span>);\n<span class="hljs-comment">// 15</span>\n<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"0x10"</span>);\n<span class="hljs-comment">// 16</span>\n<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"103"</span>, <span class="hljs-number">2</span>);\n<span class="hljs-comment">// 2</span>\n</code></pre>\n<h4 id="explicitly-boolean">Explicitly: * --&gt; Boolean</h4>\n<p>This is not recommended in js:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n\n<span class="hljs-keyword">var</span> b = a ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;\n</code></pre>\n<p><code>a</code> should be coerced to <code>boolean</code> first.</p>\n<p><code>Boolean(a)</code> and <code>!!a</code> are far better as <em>explicit</em> coercion options.</p>\n<pre><code class="hljs language-js">\n<span class="hljs-keyword">var</span> a = <span class="hljs-string">"0"</span>;\n<span class="hljs-keyword">var</span> b = [];\n<span class="hljs-keyword">var</span> b = {};\n<span class="hljs-keyword">var</span> c = [];\n<span class="hljs-keyword">var</span> d = <span class="hljs-string">""</span>;\n<span class="hljs-keyword">var</span> e = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> f = <span class="hljs-literal">null</span>;\n<span class="hljs-keyword">var</span> g;\n<span class="hljs-built_in">Boolean</span>(a);\n<span class="hljs-comment">// true</span>\n<span class="hljs-built_in">Boolean</span>(b);\n<span class="hljs-comment">// true</span>\n<span class="hljs-built_in">Boolean</span>(c);\n<span class="hljs-comment">// true</span>\n<span class="hljs-built_in">Boolean</span>(d);\n<span class="hljs-comment">// false</span>\n<span class="hljs-built_in">Boolean</span>(e);\n<span class="hljs-comment">// false</span>\n<span class="hljs-built_in">Boolean</span>(f);\n<span class="hljs-comment">// false</span>\n<span class="hljs-built_in">Boolean</span>(g);\n<span class="hljs-comment">// false</span>\n!!a;\n<span class="hljs-comment">// true</span>\n!!b;\n<span class="hljs-comment">// true</span>\n!!c;\n<span class="hljs-comment">// true</span>\n!!d;\n<span class="hljs-comment">// false</span>\n!!e;\n<span class="hljs-comment">// false</span>\n!!f;\n<span class="hljs-comment">// false</span>\n!!g;\n<span class="hljs-comment">// false</span>\n<span class="hljs-keyword">var</span> a = [\n    <span class="hljs-number">1</span>,\n    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-comment">/*..*/</span> },\n    <span class="hljs-number">2</span>,\n    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-comment">/*..*/</span> }\n];\n<span class="hljs-built_in">JSON</span>.stringify( a );\n<span class="hljs-comment">// "[1,null,2,null]"</span>\n<span class="hljs-built_in">JSON</span>.stringify( a, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key,val</span>)</span>{\n    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val == <span class="hljs-string">"function"</span>) {\n        <span class="hljs-comment">// force `ToBoolean` coercion of the function</span>\n        <span class="hljs-keyword">return</span> !!val;\n    }\n    <span class="hljs-keyword">else</span> {\n        <span class="hljs-keyword">return</span> val;\n    }\n} );\n<span class="hljs-comment">// "[1,true,2,true]"</span>\n</code></pre>\n<h3 id="implicit-coercion">Implicit Coercion</h3>\n<h4 id="simplifying-implicitly">Simplifying Implicitly</h4>\n<p>There are good part in “implicit”, don’t refuse it. I guess that what it talks about.</p>\n<h4 id="implicitly-strings-numbers">Implicitly: Strings &lt;==&gt; Numbers</h4>\n<p>Common concatenation:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"42"</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-string">"0"</span>;\n\n<span class="hljs-keyword">var</span> c = <span class="hljs-number">42</span>;\n<span class="hljs-keyword">var</span> d = <span class="hljs-number">0</span>;\n\na + b; <span class="hljs-comment">// "420"</span>\nc + d; <span class="hljs-comment">// 42</span>\n</code></pre>\n<p>Array turned into string:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>];\n<span class="hljs-keyword">var</span> b = [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>];\n\na + b; <span class="hljs-comment">// "1,23,4"</span>\n</code></pre>\n<p>According to ES5 spec section 11.6.1, the <code>+</code> algorithm (when an <code>object</code> value is an operand) will concatenate if either operand is either already a <code>string</code>, or if the following steps produce a <code>string</code> representation. So, when <code>+</code> receives an <code>object</code> (including <code>array</code>) for either operand, it first calls the <code>ToPrimitive</code> abstract operation (section 9.1) on the value, which then calls the <code>[[DefaultValue]]</code> algorithm (section 8.12.8) with a context hint of <code>number</code>.</p>\n<p>Coerce a number to a string:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n<span class="hljs-keyword">var</span> b = a + <span class="hljs-string">""</span>;\n\nb; <span class="hljs-comment">// "42"</span>\n</code></pre>\n<p>If you’re using an <code>object</code> instead of a regular primitive <code>number</code> value, you may not necessarily get the <em>same</em> <code>string</code> value!</p>\n<p>Consider:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = {\n\t<span class="hljs-attr">valueOf</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>; },\n\t<span class="hljs-attr">toString</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>; }\n};\n\na + <span class="hljs-string">""</span>;\t\t\t<span class="hljs-comment">// "42"</span>\n\n<span class="hljs-built_in">String</span>( a );\t<span class="hljs-comment">// "4"</span>\n</code></pre>\n<p>Implicitly coerce* from <code>string</code> to <code>number</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"3.14"</span>;\n<span class="hljs-keyword">var</span> b = a - <span class="hljs-number">0</span>;\n\nb; <span class="hljs-comment">// 3.14</span>\n</code></pre>\n<p>The <code>-</code> operator is defined only for numeric subtraction, so <code>a - 0</code> forces <code>a</code>\'s value to be coerced to a <code>number</code>. While far less common, <code>a * 1</code> or <code>a / 1</code> would accomplish the same result, as those operators are also only defined for numeric operations.</p>\n<p>Object value with <code>-</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = [<span class="hljs-number">3</span>];\n<span class="hljs-keyword">var</span> b = [<span class="hljs-number">1</span>];\n\na - b; <span class="hljs-comment">// 2</span>\n</code></pre>\n<h4 id="implicitly-booleans-numbers">Implicitly: Booleans --&gt; Numbers</h4>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onlyOne</span>(<span class="hljs-params">a,b,c</span>) </span>{\n  <span class="hljs-keyword">return</span> !!((a &amp;&amp; !b &amp;&amp; !c) ||\n            (!a &amp;&amp; b &amp;&amp; !c) || (!a &amp;&amp; !b &amp;&amp; c));\n}\n<span class="hljs-keyword">var</span> a = <span class="hljs-literal">true</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-literal">false</span>;\nonlyOne(a,b,b);\n<span class="hljs-comment">// true</span>\nonlyOne(b,b,b);\n<span class="hljs-comment">// false</span>\n</code></pre>\n<p>If there are four or more to get only one true:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onlyOne</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">var</span> sum = <span class="hljs-number">0</span>;\n\t<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {\n\t\t<span class="hljs-comment">// skip falsy values. same as treating</span>\n\t\t<span class="hljs-comment">// them as 0\'s, but avoids NaN\'s.</span>\n\t\t<span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[i]) {\n\t\t\tsum += <span class="hljs-built_in">arguments</span>[i];\n\t\t}\n\t}\n\t<span class="hljs-keyword">return</span> sum == <span class="hljs-number">1</span>;\n}\n\n<span class="hljs-keyword">var</span> a = <span class="hljs-literal">true</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-literal">false</span>;\n\nonlyOne( b, a );\t\t<span class="hljs-comment">// true</span>\nonlyOne( b, a, b, b, b );\t<span class="hljs-comment">// true</span>\n\nonlyOne( b, b );\t\t<span class="hljs-comment">// false</span>\nonlyOne( b, a, b, b, b, a );\t<span class="hljs-comment">// false</span>\n</code></pre>\n<p>A version using <code>reduce(..)</code><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onlyOne</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.values(<span class="hljs-built_in">arguments</span>).reduce(<span class="hljs-function">(<span class="hljs-params">total, current</span>) =&gt;</span> total + current) == <span class="hljs-number">1</span>;\n}\nonlyOne(a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a);\n<span class="hljs-comment">// false</span>\nonlyOne(a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b);\n<span class="hljs-comment">// true</span>\n</code></pre>\n<p>Explicit version:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onlyOne</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">var</span> sum = <span class="hljs-number">0</span>;\n\t<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {\n\t\tsum += <span class="hljs-built_in">Number</span>( !!<span class="hljs-built_in">arguments</span>[i] );\n\t}\n\t<span class="hljs-keyword">return</span> sum === <span class="hljs-number">1</span>;\n}\n</code></pre>\n<h4 id="implicitly-boolean">Implicitly: * --&gt; Boolean</h4>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-string">"abc"</span>;\n<span class="hljs-keyword">var</span> c;\n<span class="hljs-keyword">var</span> d = <span class="hljs-literal">null</span>;\n\n<span class="hljs-keyword">if</span> (a) {\n\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"yep"</span> );\t\t<span class="hljs-comment">// yep</span>\n}\n\n<span class="hljs-keyword">while</span> (c) {\n\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"nope, never runs"</span> );\n}\n\nc = d ? a : b;\nc;\t\t\t\t\t<span class="hljs-comment">// "abc"</span>\n\n<span class="hljs-keyword">if</span> ((a &amp;&amp; d) || c) {\n\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"yep"</span> );\t\t<span class="hljs-comment">// yep</span>\n}\n</code></pre>\n<h4 id="operators-and">Operators <code>||</code> and <code>&amp;&amp;</code></h4>\n<p>Quoting the ES5 spec from section 11.11:</p>\n<blockquote>\n<p>The value produced by a &amp;&amp; or || operator is not necessarily of type Boolean. The value produced will always be the value of one of the two operand expressions.</p>\n</blockquote>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-string">"abc"</span>;\n<span class="hljs-keyword">var</span> c = <span class="hljs-literal">null</span>;\n\na || b;\t\t<span class="hljs-comment">// 42</span>\na &amp;&amp; b;\t\t<span class="hljs-comment">// "abc"</span>\n\nc || b;\t\t<span class="hljs-comment">// "abc"</span>\nc &amp;&amp; b;\t\t<span class="hljs-comment">// null</span>\n</code></pre>\n<p>Both operators will always test the first operands.</p>\n<p>Below, “RES” == “The result of the first operands”.</p>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">RES\\Operand</th>\n<th style="text-align:left"><code>||</code></th>\n<th style="text-align:left"><code>&amp;&amp;</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left"><code>true</code></td>\n<td style="text-align:left">The first</td>\n<td style="text-align:left">The second</td>\n</tr>\n<tr>\n<td style="text-align:left"><code>false</code></td>\n<td style="text-align:left">The second</td>\n<td style="text-align:left">The first</td>\n</tr>\n</tbody>\n</table>\n<p>The table tells that what will be returned from the operator in certain condition.</p>\n<h4 id="symbol-coercion">Symbol Coercion</h4>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> s1 = <span class="hljs-built_in">Symbol</span>( <span class="hljs-string">"cool"</span> );\n<span class="hljs-built_in">String</span>( s1 );\t\t\t\t\t<span class="hljs-comment">// "Symbol(cool)"</span>\n\n<span class="hljs-keyword">var</span> s2 = <span class="hljs-built_in">Symbol</span>( <span class="hljs-string">"not cool"</span> );\ns2 + <span class="hljs-string">""</span>;\t\t\t\t\t\t<span class="hljs-comment">// TypeError</span>\n</code></pre>\n<p>The good news: it’s probably going to be exceedingly rare for you to need to coerce a <code>symbol</code> value. The way they’re typically used (see Chapter 3) will probably not call for coercion on a normal basis.</p>\n<h3 id="loose-equals-vs-strict-equals">Loose Equals vs. Strict Equals</h3>\n<p>Loose equals is the <code>==</code> operator, and strict equals is the <code>===</code> operator. Both operators are used for comparing two values for “equality,” but the “loose” vs. “strict” indicates a <strong>very important</strong> difference in behavior between the two, specifically in how they decide “equality.”</p>\n<p>A very common misconception about these two operators is: &quot;<code>==</code> checks values for equality and <code>===</code> checks both values and types for equality.&quot;</p>\n<p>The correct description is: &quot;<code>==</code> allows coercion in the equality comparison and <code>===</code> disallows coercion.&quot;</p>\n<h4 id="equality-performance">Equality Performance</h4>\n<p>If you want coercion, use <code>==</code> loose equality, but if you don’t want coercion, use <code>===</code> strict equality.</p>\n<p><strong>Note:</strong> The implication here then is that both <code>==</code> and <code>===</code> check the types of their operands. The difference is in how they respond if the types don’t match.</p>\n<h4 id="abstract-equality">Abstract Equality</h4>\n<p>Basically, the first clause (11.9.3.1) says, if the two values being compared are of the same type, they are simply and naturally compared via Identity as you’d expect. For example, <code>42</code> is only equal to <code>42</code>, and <code>&quot;abc&quot;</code> is only equal to <code>&quot;abc&quot;</code>.</p>\n<p>Some minor exceptions to normal expectation to be aware of:</p>\n<ul>\n<li><code>NaN</code> is never equal to itself (see Chapter 2)</li>\n<li><code>+0</code> and <code>-0</code> are equal to each other (see Chapter 2)</li>\n</ul>\n<p>The final provision in clause 11.9.3.1 is for <code>==</code> loose equality comparison with <code>object</code>s (including <code>function</code>s and <code>array</code>s). Two such values are only <em>equal</em> if they are both references to <em>the exact same value</em>. No coercion occurs here.</p>\n<p><strong>Note:</strong> The <code>===</code> strict equality comparison is defined identically to 11.9.3.1, including the provision about two <code>object</code> values. It’s a very little known fact that <strong><code>==</code> and <code>===</code> behave identically</strong> in the case where two <code>object</code>s are being compared!</p>\n<p>The rest of the algorithm in 11.9.3 specifies that if you use <code>==</code> loose equality to compare two values of different types, one or both of the values will need to be <em>implicitly</em> coerced. This coercion happens so that both values eventually end up as the same type, which can then directly be compared for equality using simple value Identity.</p>\n<p><strong>Note:</strong> The <code>!=</code> loose not-equality operation is defined exactly as you’d expect, in that it’s literally the <code>==</code> operation comparison performed in its entirety, then the negation of the result. The same goes for the <code>!==</code> strict not-equality operation.</p>\n<h5 id="comparing-strings-to-numbers">Comparing: <code>string</code>s to <code>number</code>s</h5>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-string">"42"</span>;\n\na === b;\t<span class="hljs-comment">// false</span>\na == b;\t\t<span class="hljs-comment">// true</span>\n</code></pre>\n<p>In the ES5 spec, clauses 11.9.3.4-5 say:</p>\n<blockquote>\n<ol start="4">\n<li>If Type(x) is Number and Type(y) is String,<br>\nreturn the result of the comparison x == ToNumber(y).</li>\n<li>If Type(x) is String and Type(y) is Number,<br>\nreturn the result of the comparison ToNumber(x) == y.</li>\n</ol>\n</blockquote>\n<p>According to this, it’s the string <code>&quot;42&quot;</code> coerced into the number <code>42</code> when the <code>==</code> is used.</p>\n<h5 id="comparing-anything-to-boolean">Comparing: anything to <code>boolean</code></h5>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"42"</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-literal">true</span>;\n\na == b;\t<span class="hljs-comment">// false</span>\n</code></pre>\n<p>Let’s again quote the spec, clauses 11.9.3.6-7:</p>\n<blockquote>\n<ol start="6">\n<li>If Type(x) is Boolean,<br>\nreturn the result of the comparison ToNumber(x) == y.</li>\n<li>If Type(y) is Boolean,<br>\nreturn the result of the comparison x == ToNumber(y).</li>\n</ol>\n</blockquote>\n<p>It’s <strong>not performing a boolean test</strong>. The boolean was just coerced into number <code>1</code>.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"42"</span>;\n\n<span class="hljs-comment">// bad (will fail!):</span>\n<span class="hljs-keyword">if</span> (a == <span class="hljs-literal">true</span>) {\n\t<span class="hljs-comment">// ..</span>\n}\n\n<span class="hljs-comment">// also bad (will fail!):</span>\n<span class="hljs-keyword">if</span> (a === <span class="hljs-literal">true</span>) {\n\t<span class="hljs-comment">// ..</span>\n}\n\n<span class="hljs-comment">// good enough (works implicitly):</span>\n<span class="hljs-keyword">if</span> (a) {\n\t<span class="hljs-comment">// ..</span>\n}\n\n<span class="hljs-comment">// better (works explicitly):</span>\n<span class="hljs-keyword">if</span> (!!a) {\n\t<span class="hljs-comment">// ..</span>\n}\n\n<span class="hljs-comment">// also great (works explicitly):</span>\n<span class="hljs-keyword">if</span> (<span class="hljs-built_in">Boolean</span>( a )) {\n\t<span class="hljs-comment">// ..</span>\n}\n</code></pre>\n<h5 id="comparing-nulls-to-undefineds">Comparing: <code>null</code>s to <code>undefined</code>s</h5>\n<p>Another example of <em>implicit</em> coercion can be seen with <code>==</code> loose equality between <code>null</code> and <code>undefined</code> values. Yet again quoting the ES5 spec, clauses 11.9.3.2-3:</p>\n<blockquote>\n<ol start="2">\n<li>If x is null and y is undefined, return true.</li>\n<li>If x is undefined and y is null, return true.</li>\n</ol>\n</blockquote>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-literal">null</span>;\n<span class="hljs-keyword">var</span> b;\n\na == b;\t\t<span class="hljs-comment">// true</span>\na == <span class="hljs-literal">null</span>;\t<span class="hljs-comment">// true</span>\nb == <span class="hljs-literal">null</span>;\t<span class="hljs-comment">// true</span>\n\na == <span class="hljs-literal">false</span>;\t<span class="hljs-comment">// false</span>\nb == <span class="hljs-literal">false</span>;\t<span class="hljs-comment">// false</span>\na == <span class="hljs-string">""</span>;\t<span class="hljs-comment">// false</span>\nb == <span class="hljs-string">""</span>;\t<span class="hljs-comment">// false</span>\na == <span class="hljs-number">0</span>;\t\t<span class="hljs-comment">// false</span>\nb == <span class="hljs-number">0</span>;\t\t<span class="hljs-comment">// false</span>\n</code></pre>\n<p>The author recommends using this coercion to allow <code>null</code> and <code>undefined</code> to be indistinguishable and thus treated as the same value.</p>\n<p>For example:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = doSomething();\n\n<span class="hljs-keyword">if</span> (a == <span class="hljs-literal">null</span>) {\n\t<span class="hljs-comment">// ..</span>\n}\n</code></pre>\n<p>The <code>a == null</code> only pass when a is either <code>null</code> or <code>undefined</code></p>\n<p>THe uglier explicit version:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = doSomething();\n\n<span class="hljs-keyword">if</span> (a === <span class="hljs-literal">undefined</span> || a === <span class="hljs-literal">null</span>) {\n\t<span class="hljs-comment">// ..</span>\n}\n</code></pre>\n<p>It’s reliable safe way of using implicit coersion.</p>\n<h5 id="comparing-objects-to-non-objects">Comparing: <code>object</code>s to non-<code>object</code>s</h5>\n<p>If an <code>object</code>/<code>function</code>/<code>array</code> is compared to a simple scalar primitive (<code>string</code>, <code>number</code>, or <code>boolean</code>), the ES5 spec says in clauses 11.9.3.8-9:</p>\n<blockquote>\n<ol start="8">\n<li>If Type(x) is either String or Number and Type(y) is Object,<br>\nreturn the result of the comparison x == ToPrimitive(y).</li>\n<li>If Type(x) is Object and Type(y) is either String or Number,<br>\nreturn the result of the comparison ToPrimitive(x) == y.</li>\n</ol>\n</blockquote>\n<p>No boolean \'cause in a <code>==</code> sentence a boolean will always be coerced into a <code>Number</code> first.</p>\n<p>There are some values where this is not the case, though, because of other overriding rules in the <code>==</code> algorithm. Consider:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-literal">null</span>;\n<span class="hljs-keyword">var</span> b = <span class="hljs-built_in">Object</span>( a );\t<span class="hljs-comment">// same as `Object()`</span>\na == b;\t\t\t\t\t<span class="hljs-comment">// false</span>\n\n<span class="hljs-keyword">var</span> c = <span class="hljs-literal">undefined</span>;\n<span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Object</span>( c );\t<span class="hljs-comment">// same as `Object()`</span>\nc == d;\t\t\t\t\t<span class="hljs-comment">// false</span>\n\n<span class="hljs-keyword">var</span> e = <span class="hljs-literal">NaN</span>;\n<span class="hljs-keyword">var</span> f = <span class="hljs-built_in">Object</span>( e );\t<span class="hljs-comment">// same as `new Number( e )`</span>\ne == f;\t\t\t\t\t<span class="hljs-comment">// false</span>\n</code></pre>\n<p>The <code>null</code> and <code>undefined</code> values cannot be boxed – they have no object wrapper equivalent – so <code>Object(null)</code> is just like <code>Object()</code> in that both just produce a normal object.</p>\n<p><code>NaN</code> can be boxed to its <code>Number</code> object wrapper equivalent, but when <code>==</code> causes an unboxing, the <code>NaN == NaN</code> comparison fails because <code>NaN</code> is never equal to itself (see Chapter 2).</p>\n<h4 id="edge-cases">Edge Cases</h4>\n<p>This section the worst, craziest corner cases will be called so we can see what we need to avoid to not get bitten with coercion bugs.</p>\n<h5 id="a-number-by-any-other-value-would">A Number By Any Other Value Would…</h5>\n<pre><code class="hljs language-js"><span class="hljs-built_in">Number</span>.prototype.valueOf = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;\n};\n\n<span class="hljs-keyword">new</span> <span class="hljs-built_in">Number</span>( <span class="hljs-number">2</span> ) == <span class="hljs-number">3</span>;\t<span class="hljs-comment">// true</span>\n</code></pre>\n<p>It’s trap that should be avoided.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> i = <span class="hljs-number">2</span>;\n\n<span class="hljs-built_in">Number</span>.prototype.valueOf = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">return</span> i++;\n};\n\n<span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Number</span>( <span class="hljs-number">42</span> );\n\n<span class="hljs-keyword">if</span> (a == <span class="hljs-number">2</span> &amp;&amp; a == <span class="hljs-number">3</span>) {\n\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"Yep, this happened."</span> );\n}\n<span class="hljs-comment">// Yep, this happened.</span>\n</code></pre>\n<p>Avoid these crazy tricks, and stick only with valid and proper usage of coercion.</p>\n<h5 id="false-y-comparisons">False-y Comparisons</h5>\n<pre><code class="hljs language-js"><span class="hljs-string">"0"</span> == <span class="hljs-literal">null</span>;\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">"0"</span> == <span class="hljs-literal">undefined</span>;\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">"0"</span> == <span class="hljs-literal">false</span>;\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-string">"0"</span> == <span class="hljs-literal">NaN</span>;\t\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">"0"</span> == <span class="hljs-number">0</span>;\t\t\t\t<span class="hljs-comment">// true</span>\n<span class="hljs-string">"0"</span> == <span class="hljs-string">""</span>;\t\t\t\t<span class="hljs-comment">// false</span>\n\n<span class="hljs-literal">false</span> == <span class="hljs-literal">null</span>;\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-literal">false</span> == <span class="hljs-literal">undefined</span>;\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-literal">false</span> == <span class="hljs-literal">NaN</span>;\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-literal">false</span> == <span class="hljs-number">0</span>;\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-literal">false</span> == <span class="hljs-string">""</span>;\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-literal">false</span> == [];\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-literal">false</span> == {};\t\t\t<span class="hljs-comment">// false</span>\n\n<span class="hljs-string">""</span> == <span class="hljs-literal">null</span>;\t\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">""</span> == <span class="hljs-literal">undefined</span>;\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">""</span> == <span class="hljs-literal">NaN</span>;\t\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">""</span> == <span class="hljs-number">0</span>;\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-string">""</span> == [];\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-string">""</span> == {};\t\t\t\t<span class="hljs-comment">// false</span>\n\n<span class="hljs-number">0</span> == <span class="hljs-literal">null</span>;\t\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-number">0</span> == <span class="hljs-literal">undefined</span>;\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-number">0</span> == <span class="hljs-literal">NaN</span>;\t\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-number">0</span> == [];\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-number">0</span> == {};\t\t\t\t<span class="hljs-comment">// false</span>\n</code></pre>\n<p><code>UH OH!</code> comparisons are false positives.</p>\n<pre><code class="hljs language-js">[] == ![];\t\t<span class="hljs-comment">// true</span>\n</code></pre>\n<pre><code class="hljs language-js"><span class="hljs-number">2</span> == [<span class="hljs-number">2</span>];\t\t<span class="hljs-comment">// true</span>\n<span class="hljs-string">""</span> == [<span class="hljs-literal">null</span>];\t<span class="hljs-comment">// true</span>\n</code></pre>\n<pre><code class="hljs language-js"><span class="hljs-number">0</span> == <span class="hljs-string">"\\n"</span>;\t\t<span class="hljs-comment">// true</span>\n</code></pre>\n<p>To contrast against these 24 likely suspects for coercion gotchas, consider another list like this:</p>\n<pre><code class="hljs language-js"><span class="hljs-number">42</span> == <span class="hljs-string">"43"</span>;\t\t\t\t\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">"foo"</span> == <span class="hljs-number">42</span>;\t\t\t\t\t\t<span class="hljs-comment">// false</span>\n<span class="hljs-string">"true"</span> == <span class="hljs-literal">true</span>;\t\t\t\t\t\t<span class="hljs-comment">// false</span>\n\n<span class="hljs-number">42</span> == <span class="hljs-string">"42"</span>;\t\t\t\t\t\t\t<span class="hljs-comment">// true</span>\n<span class="hljs-string">"foo"</span> == [ <span class="hljs-string">"foo"</span> ];\t\t\t\t\t<span class="hljs-comment">// true</span>\n</code></pre>\n<p>In these nonfalsy, noncorner cases (and there are literally an infinite number of comparisons we could put on this list), the coercion results are totally safe, reasonable, and explainable.</p>\n<h4 id="sanity-check">Sanity Check</h4>\n<p>Avoid list in coercion:</p>\n<pre><code class="hljs language-js"><span class="hljs-string">"0"</span> == <span class="hljs-literal">false</span>;\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-literal">false</span> == <span class="hljs-number">0</span>;\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-literal">false</span> == <span class="hljs-string">""</span>;\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-literal">false</span> == [];\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-string">""</span> == <span class="hljs-number">0</span>;\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-string">""</span> == [];\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-number">0</span> == [];\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n</code></pre>\n<p>Boolean in <code>==</code> should be avoided. And it was mentioned before. So the list is down to three:</p>\n<pre><code class="hljs language-js"><span class="hljs-string">""</span> == <span class="hljs-number">0</span>;\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-string">""</span> == [];\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n<span class="hljs-number">0</span> == [];\t\t\t\t<span class="hljs-comment">// true -- UH OH!</span>\n</code></pre>\n<h5 id="safely-using-implicit-coercion">Safely Using Implicit Coercion</h5>\n<p>Some heuristic rules to follow:</p>\n<ol>\n<li>If either side of the comparison can have <code>true</code> or <code>false</code> values, don’t ever, EVER use <code>==</code>.</li>\n<li>If either side of the comparison can have <code>[]</code>, <code>&quot;&quot;</code>, or <code>0</code> values, seriously consider not using <code>==</code>.</li>\n</ol>\n<p><strong>Being more explicit/verbose in these cases will save you from a lot of headaches.</strong></p>\n<h3 id="abstract-relational-comparison">Abstract Relational Comparison</h3>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = [ <span class="hljs-number">42</span> ];\n<span class="hljs-keyword">var</span> b = [ <span class="hljs-string">"43"</span> ];\n\na &lt; b;\t<span class="hljs-comment">// true</span>\nb &lt; a;\t<span class="hljs-comment">// false</span>\n</code></pre>\n<p>Similar to <code>==</code></p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = [ <span class="hljs-string">"42"</span> ];\n<span class="hljs-keyword">var</span> b = [ <span class="hljs-string">"043"</span> ];\n\na &lt; b;\t<span class="hljs-comment">// false</span>\n</code></pre>\n<p><code>a</code> and <code>b</code> are <em>not</em> coerced to <code>number</code>s, because both of them end up as <code>string</code>s after the <code>ToPrimitive</code> coercion on the two <code>array</code>s. So, <code>&quot;42&quot;</code> is compared character by character to <code>&quot;043&quot;</code>, starting with the first characters <code>&quot;4&quot;</code> and <code>&quot;0&quot;</code>, respectively. Since <code>&quot;0&quot;</code> is lexicographically <em>less than</em> than <code>&quot;4&quot;</code>, the comparison returns <code>false</code>.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = { <span class="hljs-attr">b</span>: <span class="hljs-number">42</span> };\n<span class="hljs-keyword">var</span> b = { <span class="hljs-attr">b</span>: <span class="hljs-number">43</span> };\n\na &lt; b;\t<span class="hljs-comment">// ??</span>\n</code></pre>\n<p><code>a &lt; b</code> is also <code>false</code>, because <code>a</code> becomes <code>[object Object]</code> and <code>b</code> becomes <code>[object Object]</code>, and so clearly <code>a</code> is not lexicographically less than <code>b</code>.</p>\n<p>Strange:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = { <span class="hljs-attr">b</span>: <span class="hljs-number">42</span> };\n<span class="hljs-keyword">var</span> b = { <span class="hljs-attr">b</span>: <span class="hljs-number">43</span> };\n\na &lt; b;\t<span class="hljs-comment">// false</span>\na == b;\t<span class="hljs-comment">// false</span>\na &gt; b;\t<span class="hljs-comment">// false</span>\n\na &lt;= b;\t<span class="hljs-comment">// true</span>\na &gt;= b;\t<span class="hljs-comment">// true</span>\n</code></pre>\n<p><code>a &lt;= b</code> is just the opposite result of <code>a &lt; b</code></p>\n<p>If coercion is helpful and reasonably safe, like in a <code>42 &lt; &quot;43&quot;</code> comparison, <strong>use it</strong>. On the other hand, if you need to be safe about a relational comparison, <em>explicitly coerce</em> the values first, before using <code>&lt;</code> (or its counterparts).</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = [ <span class="hljs-number">42</span> ];\n<span class="hljs-keyword">var</span> b = <span class="hljs-string">"043"</span>;\n\na &lt; b;\t\t\t\t\t\t<span class="hljs-comment">// false -- string comparison!</span>\n<span class="hljs-built_in">Number</span>( a ) &lt; <span class="hljs-built_in">Number</span>( b );\t<span class="hljs-comment">// true -- number comparison!</span>\n</code></pre>\n<h2 id="chapter-5">Chapter 5</h2>\n<p>Talking about js’ grammer.</p>\n<h3 id="statements-expressions">Statements &amp; Expressions</h3>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">3</span> * <span class="hljs-number">6</span>;\n<span class="hljs-keyword">var</span> b = a;\nb;\n</code></pre>\n<p>Expressions: <code>3 * 6</code> on the first line, <code>a</code> on the second line.<br>\nStatements: each of the three lines.</p>\n<h4 id="statement-completion-values">Statement Completion Values</h4>\n<p><code>var</code>\'s completion value is empty (<code>undefined</code>) due to the value swallowed up.</p>\n<p><code>undefined</code> is quite common as completion values.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> b;\n\n<span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {\n\tb = <span class="hljs-number">4</span> + <span class="hljs-number">38</span>;\n}\n</code></pre>\n<p>This returns 42. In other words, the completion value of a block is like an <em>implicit return</em> of the last statement value in the block.</p>\n<p>To catch the completion value: (Only demo, don’t do it. <code>eval(..)</code> sometimes pronounced “evil”)</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a, b;\n\na = <span class="hljs-built_in">eval</span>( <span class="hljs-string">"if (true) { b = 4 + 38; }"</span> );\n\na;\t<span class="hljs-comment">// 42</span>\n</code></pre>\n<p>There’s a proposal for ES7 called “do expression.” Here’s how it might work:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a, b;\n\na = <span class="hljs-keyword">do</span> {\n\t<span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {\n\t\tb = <span class="hljs-number">4</span> + <span class="hljs-number">38</span>;\n\t}\n};\n\na;\t<span class="hljs-comment">// 42</span>\n</code></pre>\n<h4 id="expression-side-effects">Expression Side Effects</h4>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n\ta = a + <span class="hljs-number">1</span>;\n}\n\n<span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;\nfoo();\t\t<span class="hljs-comment">// result: `undefined`, side effect: changed `a`</span>\n</code></pre>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n<span class="hljs-keyword">var</span> b = a++;\n\na;\t<span class="hljs-comment">// 43</span>\nb;\t<span class="hljs-comment">// 42</span>\n</code></pre>\n<p>THe same behaviour in C code:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n\na++;\t<span class="hljs-comment">// 42</span>\na;\t\t<span class="hljs-comment">// 43</span>\n\n++a;\t<span class="hljs-comment">// 44</span>\na;\t\t<span class="hljs-comment">// 44</span>\n</code></pre>\n<p>The expression <code>a++</code> has two separate behaviors. <em>First</em>, it returns the current value of <code>a</code>, which is <code>42</code> (which then gets assigned to <code>b</code>). But <em>next</em>, it changes the value of <code>a</code> itself, incrementing it by one.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>, b;\nb = ( a++, a );\n\na;\t<span class="hljs-comment">// 43</span>\nb;\t<span class="hljs-comment">// 43</span>\n</code></pre>\n<p><strong>Note:</strong> The <code>( .. )</code> around <code>a++, a</code> is required here. The reason is operator precedence, which we’ll cover later in this chapter.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> obj = {\n\t<span class="hljs-attr">a</span>: <span class="hljs-number">42</span>\n};\n\nobj.a;\t\t\t<span class="hljs-comment">// 42</span>\n<span class="hljs-keyword">delete</span> obj.a;\t<span class="hljs-comment">// true</span>\nobj.a;\t\t\t<span class="hljs-comment">// undefined</span>\n</code></pre>\n<p>The result value of the <code>delete</code> operator is <code>true</code> if the requested operation is valid/allowable, or <code>false</code> otherwise. But the side effect of the operator is that it removes the property (or array slot).</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a;\n\na = <span class="hljs-number">42</span>;\t\t<span class="hljs-comment">// 42</span>\na;\t\t\t<span class="hljs-comment">// 42</span>\n</code></pre>\n<p>It may not seem like <code>=</code> in <code>a = 42</code> is a side-effecting operator for the expression. But if we examine the result value of the <code>a = 42</code> statement, it’s the value that was just assigned (<code>42</code>), so the assignment of that same value into <code>a</code> is essentially a side effect.</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a, b, c;\n\na = b = c = <span class="hljs-number">42</span>;\n</code></pre>\n<p>Here, <code>c = 42</code> is evaluated to <code>42</code> (with the side effect of assigning <code>42</code> to <code>c</code>), then <code>b = 42</code> is evaluated to <code>42</code> (with the side effect of assigning <code>42</code> to <code>b</code>), and finally <code>a = 42</code> is evaluated (with the side effect of assigning <code>42</code> to <code>a</code>).</p>\n<p>Another scenario to consider:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vowels</span>(<span class="hljs-params">str</span>) </span>{\n\t<span class="hljs-keyword">var</span> matches;\n\n\t<span class="hljs-keyword">if</span> (str) {\n\t\t<span class="hljs-comment">// pull out all the vowels</span>\n\t\tmatches = str.match( <span class="hljs-regexp">/[aeiou]/g</span> );\n\n\t\t<span class="hljs-keyword">if</span> (matches) {\n\t\t\t<span class="hljs-keyword">return</span> matches;\n\t\t}\n\t}\n}\n\nvowels( <span class="hljs-string">"Hello World"</span> ); <span class="hljs-comment">// ["e","o","o"]</span>\n</code></pre>\n<p>This works, and many developers prefer such. But using an idiom where we take advantage of the assignment side effect, we can simplify by combining the two <code>if</code> statements into one:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vowels</span>(<span class="hljs-params">str</span>) </span>{\n\t<span class="hljs-keyword">var</span> matches;\n\n\t<span class="hljs-comment">// pull out all the vowels</span>\n\t<span class="hljs-keyword">if</span> (str &amp;&amp; (matches = str.match( <span class="hljs-regexp">/[aeiou]/g</span> ))) {\n\t\t<span class="hljs-keyword">return</span> matches;\n\t}\n}\n\nvowels( <span class="hljs-string">"Hello World"</span> ); <span class="hljs-comment">// ["e","o","o"]</span>\n</code></pre>\n<p><strong>Note:</strong> The <code>( .. )</code> around <code>matches = str.match..</code> is required. The reason is operator precedence, which we’ll cover in the “Operator Precedence” section later in this chapter.</p>\n<p>I prefer this shorter style, as I think it makes it clearer that the two conditionals are in fact related rather than separate. But as with most stylistic choices in JS, it’s purely opinion which one is <em>better</em>.</p>\n<h4 id="contextual-rules">Contextual Rules</h4>\n<h5 id="curly-braces"><code>{ .. }</code> Curly Braces</h5>\n<h6 id="object-literals">Object Literals</h6>\n<pre><code class="hljs language-js"><span class="hljs-comment">// assume there\'s a `bar()` function defined</span>\n\n<span class="hljs-keyword">var</span> a = {\n\t<span class="hljs-attr">foo</span>: bar()\n};\n</code></pre>\n<p>How do we know this is an <code>object</code> literal? Because the <code>{ .. }</code> pair is a value that’s getting assigned to <code>a</code>.</p>\n<h6 id="labels">Labels</h6>\n<p>JS <em>does</em> support a limited, special form of <code>goto</code>: labeled jumps.</p>\n<pre><code class="hljs language-js"><span class="hljs-comment">// `foo` labeled-loop</span>\n<span class="hljs-attr">foo</span>: <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++) {\n\t<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">4</span>; j++) {\n\t\t<span class="hljs-comment">// whenever the loops meet, continue outer loop</span>\n\t\t<span class="hljs-keyword">if</span> (j == i) {\n\t\t\t<span class="hljs-comment">// jump to the next iteration of</span>\n\t\t\t<span class="hljs-comment">// the `foo` labeled-loop</span>\n\t\t\t<span class="hljs-keyword">continue</span> foo;\n\t\t}\n\n\t\t<span class="hljs-comment">// skip odd multiples</span>\n\t\t<span class="hljs-keyword">if</span> ((j * i) % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) {\n\t\t\t<span class="hljs-comment">// normal (non-labeled) `continue` of inner loop</span>\n\t\t\t<span class="hljs-keyword">continue</span>;\n\t\t}\n\n\t\t<span class="hljs-built_in">console</span>.log( i, j );\n\t}\n}\n<span class="hljs-comment">// 1 0</span>\n<span class="hljs-comment">// 2 0</span>\n<span class="hljs-comment">// 2 1</span>\n<span class="hljs-comment">// 3 0</span>\n<span class="hljs-comment">// 3 2</span>\n</code></pre>\n<p>The use of <code>break</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-comment">// `foo` labeled-loop</span>\n<span class="hljs-attr">foo</span>: <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++) {\n\t<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">4</span>; j++) {\n\t\t<span class="hljs-keyword">if</span> ((i * j) &gt;= <span class="hljs-number">3</span>) {\n\t\t\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"stopping!"</span>, i, j );\n\t\t\t<span class="hljs-comment">// break out of the `foo` labeled loop</span>\n\t\t\t<span class="hljs-keyword">break</span> foo;\n\t\t}\n\n\t\t<span class="hljs-built_in">console</span>.log( i, j );\n\t}\n}\n<span class="hljs-comment">// 0 0</span>\n<span class="hljs-comment">// 0 1</span>\n<span class="hljs-comment">// 0 2</span>\n<span class="hljs-comment">// 0 3</span>\n<span class="hljs-comment">// 1 0</span>\n<span class="hljs-comment">// 1 1</span>\n<span class="hljs-comment">// 1 2</span>\n<span class="hljs-comment">// stopping! 1 3</span>\n</code></pre>\n<h6 id="blocks">Blocks</h6>\n<pre><code class="hljs language-js">[] + {}; <span class="hljs-comment">// "[object Object]"</span>\n{} + []; <span class="hljs-comment">// 0</span>\n</code></pre>\n<h6 id="object-destructuring">Object Destructuring</h6>\n<p>Starting with ES6, another place that you’ll see <code>{ .. }</code> pairs showing up is with “destructuring assignments” (see the <em>ES6 &amp; Beyond</em> title of this series for more info), specifically <code>object</code> destructuring. Consider:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-comment">// ..</span>\n\t<span class="hljs-keyword">return</span> {\n\t\t<span class="hljs-attr">a</span>: <span class="hljs-number">42</span>,\n\t\t<span class="hljs-attr">b</span>: <span class="hljs-string">"foo"</span>\n\t};\n}\n\n<span class="hljs-keyword">var</span> { a, b } = getData();\n\n<span class="hljs-built_in">console</span>.log( a, b ); <span class="hljs-comment">// 42 "foo"</span>\n</code></pre>\n<p>Object destructuring with a <code>{ .. }</code> pair can also be used for named function arguments, which is sugar for this same sort of implicit object property assignment:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">{ a, b, c }</span>) </span>{\n\t<span class="hljs-comment">// no need for:</span>\n\t<span class="hljs-comment">// var a = obj.a, b = obj.b, c = obj.c</span>\n\t<span class="hljs-built_in">console</span>.log( a, b, c );\n}\n\nfoo( {\n\t<span class="hljs-attr">c</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],\n\t<span class="hljs-attr">a</span>: <span class="hljs-number">42</span>,\n\t<span class="hljs-attr">b</span>: <span class="hljs-string">"foo"</span>\n} );\t<span class="hljs-comment">// 42 "foo" [1, 2, 3]</span>\n</code></pre>\n<h5 id="else-if-and-optional-blocks"><code>else if</code> And Optional Blocks</h5>\n<p>It’s a common misconception that JavaScript has an <code>else if</code> clause, because you can do:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">if</span> (a) {\n\t<span class="hljs-comment">// ..</span>\n}\n<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (b) {\n\t<span class="hljs-comment">// ..</span>\n}\n<span class="hljs-keyword">else</span> {\n\t<span class="hljs-comment">// ..</span>\n}\n</code></pre>\n<p>But there’s a hidden characteristic of the JS grammar here: there is no <code>else if</code>. But <code>if</code> and <code>else</code> statements are allowed to omit the <code>{ }</code> around their attached block if they only contain a single statement. You’ve seen this many times before, undoubtedly:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">if</span> (a) doSomething( a );\n</code></pre>\n<p>However, the exact same grammar rule applies to the <code>else</code> clause, so the <code>else if</code> form you’ve likely always coded is <em>actually</em> parsed as:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">if</span> (a) {\n\t<span class="hljs-comment">// ..</span>\n}\n<span class="hljs-keyword">else</span> {\n\t<span class="hljs-keyword">if</span> (b) {\n\t\t<span class="hljs-comment">// ..</span>\n\t}\n\t<span class="hljs-keyword">else</span> {\n\t\t<span class="hljs-comment">// ..</span>\n\t}\n}\n</code></pre>\n<p>Recall the example from above:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>, b;\nb = ( a++, a );\n\na;\t<span class="hljs-comment">// 43</span>\nb;\t<span class="hljs-comment">// 43</span>\n</code></pre>\n<p>But what would happen if we remove the <code>( )</code>?</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>, b;\nb = a++, a;\n\na;\t<span class="hljs-comment">// 43</span>\nb;\t<span class="hljs-comment">// 42</span>\n</code></pre>\n<p>Because the <code>,</code> operator has a lower precedence than the <code>=</code> operator.</p>\n<p>Now, recall this example from above:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">if</span> (str &amp;&amp; (matches = str.match( <span class="hljs-regexp">/[aeiou]/g</span> ))) {\n\t<span class="hljs-comment">// ..</span>\n}\n</code></pre>\n<p>We said the <code>( )</code> around the assignment is required, but why? Because <code>&amp;&amp;</code> has higher precedence than <code>=</code>, so without the <code>( )</code> to force the binding, the expression would instead be treated as <code>(str &amp;&amp; matches) = str.match..</code>. But this would be an error, because the result of <code>(str &amp;&amp; matches)</code> isn’t going to be a variable, but instead a value (in this case <code>undefined</code>), and so it can’t be the left-hand side of an <code>=</code> assignment!</p>\n<h4 id="short-circuited">Short Circuited</h4>\n<p>This short circuiting can be very helpful and is commonly used:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomething</span>(<span class="hljs-params">opts</span>) </span>{\n\t<span class="hljs-keyword">if</span> (opts &amp;&amp; opts.cool) {\n\t\t<span class="hljs-comment">// ..</span>\n\t}\n}\n</code></pre>\n<p>Similarly, you can use <code>||</code> short circuiting:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomething</span>(<span class="hljs-params">opts</span>) </span>{\n\t<span class="hljs-keyword">if</span> (opts.cache || primeCache()) {\n\t\t<span class="hljs-comment">// ..</span>\n\t}\n}\n</code></pre>\n<h4 id="tighter-binding">Tighter Binding</h4>\n<pre><code class="hljs language-js">a &amp;&amp; b || c ? c || b ? a : c &amp;&amp; b : a\n</code></pre>\n<p>Is that more like this:</p>\n<pre><code class="hljs language-js">a &amp;&amp; b || (c ? c || (b ? a : c) &amp;&amp; b : a)\n</code></pre>\n<p>or this?</p>\n<pre><code class="hljs language-js">(a &amp;&amp; b || c) ? (c || b) ? a : (c &amp;&amp; b) : a\n</code></pre>\n<p>The answer is the second one. But why?</p>\n<p><strong>Because <code>&amp;&amp;</code> is more precedent than <code>||</code>, and <code>||</code> is more precedent than <code>? :</code>.</strong> (<code>&amp;&amp;</code> &gt; <code>||</code> &gt; <code>||</code>)</p>\n<h4 id="associativity">Associativity</h4>\n<p>In general, operators are either left-associative or right-associative, referring to whether <strong>grouping happens from the left or from the right</strong>.</p>\n<p>Technically, <code>a &amp;&amp; b &amp;&amp; c</code> will be handled as <code>(a &amp;&amp; b) &amp;&amp; c</code>, because <code>&amp;&amp;</code> is left-associative (so is <code>||</code>, by the way). However, the right-associative alternative <code>a &amp;&amp; (b &amp;&amp; c)</code> behaves observably the same way. For the same values, the same expressions are evaluated in the same order.</p>\n<p>So it doesn’t really matter that much that <code>&amp;&amp;</code> and <code>||</code> are left-associative, other than to be accurate in how we discuss their definitions.</p>\n<p>But that’s not always the case. Some operators would behave very differently depending on left-associativity vs. right-associativity.</p>\n<p>The <code>? :</code> (“ternary” or “conditional”) operator is right-associative:</p>\n<pre><code class="hljs language-js">a ? b : c ? d : e;\n</code></pre>\n<h4 id="disambiguation">Disambiguation</h4>\n<p><strong>use operator precedence/associativity where it leads to shorter and cleaner code, but use <code>( )</code> manual grouping in places where it helps create clarity and reduce confusion.</strong></p>\n<h3 id="automatic-semicolons">Automatic Semicolons</h3>\n<p>JS won’t treat <code>c</code> as the next line as part of the <code>var</code> statement if no <code>,</code> is between <code>b</code> and <code>c</code>:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>, b\nc;\n</code></pre>\n<p>Similar:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>, b = <span class="hljs-string">"foo"</span>;\n\na\nb\t<span class="hljs-comment">// "foo"</span>\n</code></pre>\n<p>Where ASI is helpful:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n\n<span class="hljs-keyword">do</span> {\n\t<span class="hljs-comment">// ..</span>\n} <span class="hljs-keyword">while</span> (a)\t<span class="hljs-comment">// &lt;-- ; expected here!</span>\na;\n</code></pre>\n<p>Statement blocks do not require <code>;</code> termination, so ASI isn’t necessary:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">42</span>;\n\n<span class="hljs-keyword">while</span> (a) {\n\t<span class="hljs-comment">// ..</span>\n} <span class="hljs-comment">// &lt;-- no ; expected here</span>\na;\n</code></pre>\n<p>The other major case where ASI kicks in is with the <code>break</code>, <code>continue</code>, <code>return</code>, and (ES6) <code>yield</code> keywords:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">a</span>) </span>{\n\t<span class="hljs-keyword">if</span> (!a) <span class="hljs-keyword">return</span>\n\ta *= <span class="hljs-number">2</span>;\n\t<span class="hljs-comment">// ..</span>\n}\n</code></pre>\n<p>The <code>return</code> statement doesn’t carry across the newline to the <code>a *= 2</code> expression, as ASI assumes the <code>;</code> terminating the <code>return</code> statement. Of course, <code>return</code> statements <em>can</em> easily break across multiple lines, just not when there’s nothing after <code>return</code> but the newline/line break.</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">a</span>) </span>{\n\t<span class="hljs-keyword">return</span> (\n\t\ta * <span class="hljs-number">2</span> + <span class="hljs-number">3</span> / <span class="hljs-number">12</span>\n\t);\n}\n</code></pre>\n<p>Identical reasoning applies to <code>break</code>, <code>continue</code>, and <code>yield</code>.</p>\n<h4 id="error-correction">Error Correction</h4>\n<p>The author: <strong>use semicolons wherever you know they are “required,” and limit your assumptions about ASI to a minimum.</strong></p>\n<p>But don’t just take my word for it. Back in 2012, creator of JavaScript Brendan Eich said (http://brendaneich.com/2012/04/the-infernal-semicolon/) the following:</p>\n<blockquote>\n<p>The moral of this story: ASI is (formally speaking) a syntactic error correction procedure. If you start to code as if it were a universal significant-newline rule, you will get into trouble.<br>\n…<br>\nI wish I had made newlines more significant in JS back in those ten days in May, 1995.<br>\n…<br>\nBe careful not to use ASI as if it gave JS significant newlines.</p>\n</blockquote>\n<h3 id="errors">Errors</h3>\n<p>Invalid syntax:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-regexp">/+foo/</span>;\t\t<span class="hljs-comment">// Error!</span>\n</code></pre>\n<p>The wrong target of an assignment:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a;\n<span class="hljs-number">42</span> = a;\t\t<span class="hljs-comment">// Error!</span>\n</code></pre>\n<p>ES5’s <code>strict</code> mode defines even more early errors. For example, in <code>strict</code> mode, function parameter names cannot be duplicated:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">a,b,a</span>) </span>{ }\t\t\t\t\t<span class="hljs-comment">// just fine</span>\n\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params">a,b,a</span>) </span>{ <span class="hljs-string">"use strict"</span>; }\t<span class="hljs-comment">// Error!</span>\n</code></pre>\n<p>Another <code>strict</code> mode early error is an object literal having more than one property of the same name:</p>\n<pre><code class="hljs language-js">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n\t<span class="hljs-string">"use strict"</span>;\n\n\t<span class="hljs-keyword">var</span> a = {\n\t\t<span class="hljs-attr">b</span>: <span class="hljs-number">42</span>,\n\t\t<span class="hljs-attr">b</span>: <span class="hljs-number">43</span>\n\t};\t\t\t<span class="hljs-comment">// Error!</span>\n})();\n</code></pre>\n<h4 id="using-variables-too-early">Using Variables Too Early</h4>\n<p>ES6 defines a (frankly confusingly named) new concept called the TDZ (“Temporal Dead Zone”).</p>\n<p>The TDZ refers to places in code where a variable reference cannot yet be made, because it hasn’t reached its required initialization.</p>\n<pre><code class="hljs language-js">{\n\ta = <span class="hljs-number">2</span>;\t\t<span class="hljs-comment">// ReferenceError!</span>\n\t<span class="hljs-keyword">let</span> a;\n}\n</code></pre>\n<p>The assignment <code>a = 2</code> is accessing the <code>a</code> variable (which is indeed block-scoped to the <code>{ .. }</code> block) before it’s been initialized by the <code>let a</code> declaration, so it’s in the TDZ for <code>a</code> and throws an error.</p>\n<p>Interestingly, while <code>typeof</code> has an exception to be safe for undeclared variables (see Chapter 1), no such safety exception is made for TDZ references:</p>\n<pre><code class="hljs language-js">{\n\t<span class="hljs-keyword">typeof</span> a;\t<span class="hljs-comment">// undefined</span>\n\t<span class="hljs-keyword">typeof</span> b;\t<span class="hljs-comment">// ReferenceError! (TDZ)</span>\n\t<span class="hljs-keyword">let</span> b;\n}\n</code></pre>\n<h3 id="function-arguments">Function Arguments</h3>\n<p>Another example of a TDZ violation can be seen with ES6 default parameter values (see the <em>ES6 &amp; Beyond</em> title of this series):</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> b = <span class="hljs-number">3</span>;\n\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"> a = <span class="hljs-number">42</span>, b = a + b + <span class="hljs-number">5</span> </span>) </span>{\n\t<span class="hljs-comment">// ..</span>\n}\n</code></pre>\n<p>The <code>b</code> reference in the assignment would happen in the TDZ for the parameter <code>b</code> (not pull in the outer <code>b</code> reference), so it will throw an error. However, the <code>a</code> in the assignment is fine since by that time it’s past the TDZ for parameter <code>a</code>.</p>\n<p>When using ES6’s default parameter values, the default value is applied to the parameter if you either omit an argument, or you pass an <code>undefined</code> value in its place:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"> a = <span class="hljs-number">42</span>, b = a + <span class="hljs-number">1</span> </span>) </span>{\n\t<span class="hljs-built_in">console</span>.log( a, b );\n}\n\nfoo();\t\t\t\t\t<span class="hljs-comment">// 42 43</span>\nfoo( <span class="hljs-literal">undefined</span> );\t\t<span class="hljs-comment">// 42 43</span>\nfoo( <span class="hljs-number">5</span> );\t\t\t\t<span class="hljs-comment">// 5 6</span>\nfoo( <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>, <span class="hljs-number">7</span> );\t\t<span class="hljs-comment">// 42 7</span>\nfoo( <span class="hljs-literal">null</span> );\t\t\t<span class="hljs-comment">// null 1</span>\n</code></pre>\n<p><strong>Note:</strong> <code>null</code> is coerced to a <code>0</code> value in the <code>a + 1</code> expression. See Chapter 4 for more info.</p>\n<p>Even though the default parameter values are applied to the <code>a</code> and <code>b</code> parameters, if no arguments were passed in those slots, the <code>arguments</code> array will not have entries:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"> a = <span class="hljs-number">42</span>, b = a + <span class="hljs-number">1</span> </span>) </span>{\n\t<span class="hljs-built_in">console</span>.log(\n\t\t<span class="hljs-built_in">arguments</span>.length, a, b,\n\t\t<span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>], <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>]\n\t);\n}\n\nfoo();\t\t\t\t\t<span class="hljs-comment">// 0 42 43 undefined undefined</span>\nfoo( <span class="hljs-number">10</span> );\t\t\t\t<span class="hljs-comment">// 1 10 11 10 undefined</span>\nfoo( <span class="hljs-number">10</span>, <span class="hljs-literal">undefined</span> );\t<span class="hljs-comment">// 2 10 11 10 undefined</span>\nfoo( <span class="hljs-number">10</span>, <span class="hljs-literal">null</span> );\t\t<span class="hljs-comment">// 2 10 null 10 null</span>\n</code></pre>\n<p>While ES6 default parameter values can create divergence between the <code>arguments</code> array slot and the corresponding named parameter variable, this same disjointedness can also occur in tricky ways in ES5:</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">a</span>) </span>{\n\ta = <span class="hljs-number">42</span>;\n\t<span class="hljs-built_in">console</span>.log( <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] );\n}\n\nfoo( <span class="hljs-number">2</span> );\t<span class="hljs-comment">// 42 (linked)</span>\nfoo();\t\t<span class="hljs-comment">// undefined (not linked)</span>\n</code></pre>\n<p>Note: <strong>Never refer to a named parameter <em>and</em> its corresponding <code>arguments</code> slot at the same time.</strong></p>\n<h3 id="tryfinally"><code>try..finally</code></h3>\n<p>What happens if there’s a <code>return</code> statement inside a <code>try</code> clause? It obviously will return a value, right? But does the calling code that receives that value run before or after the <code>finally</code>?</p>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">try</span> {\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;\n\t}\n\t<span class="hljs-keyword">finally</span> {\n\t\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"Hello"</span> );\n\t}\n\n\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"never runs"</span> );\n}\n\n<span class="hljs-built_in">console</span>.log( foo() );\n<span class="hljs-comment">// Hello</span>\n<span class="hljs-comment">// 42</span>\n</code></pre>\n<p>The exact same behavior is true of a <code>throw</code> inside <code>try</code>:</p>\n<pre><code class="hljs language-js"> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">try</span> {\n\t\t<span class="hljs-keyword">throw</span> <span class="hljs-number">42</span>;\n\t}\n\t<span class="hljs-keyword">finally</span> {\n\t\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"Hello"</span> );\n\t}\n\n\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"never runs"</span> );\n}\n\n<span class="hljs-built_in">console</span>.log( foo() );\n<span class="hljs-comment">// Hello</span>\n<span class="hljs-comment">// Uncaught Exception: 42</span>\n</code></pre>\n<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">try</span> {\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;\n\t}\n\t<span class="hljs-keyword">finally</span> {\n\t\t<span class="hljs-comment">// no `return ..` here, so no override</span>\n\t}\n}\n\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">try</span> {\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;\n\t}\n\t<span class="hljs-keyword">finally</span> {\n\t\t<span class="hljs-comment">// override previous `return 42`</span>\n\t\t<span class="hljs-keyword">return</span>;\n\t}\n}\n\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">baz</span>(<span class="hljs-params"></span>) </span>{\n\t<span class="hljs-keyword">try</span> {\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;\n\t}\n\t<span class="hljs-keyword">finally</span> {\n\t\t<span class="hljs-comment">// override previous `return 42`</span>\n\t\t<span class="hljs-keyword">return</span> <span class="hljs-string">"Hello"</span>;\n\t}\n}\n\nfoo();\t<span class="hljs-comment">// 42</span>\nbar();\t<span class="hljs-comment">// undefined</span>\nbaz();\t<span class="hljs-comment">// "Hello"</span>\n</code></pre>\n<p>Using a <code>finally</code> + labeled <code>break</code> to effectively cancel a <code>return</code> is doing your best to create the most confusing code possible.</p>\n<h3 id="switch"><code>switch</code></h3>\n<p>Coersive equality:</p>\n<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> a = <span class="hljs-string">"42"</span>;\n\n<span class="hljs-keyword">switch</span> (<span class="hljs-literal">true</span>) {\n\t<span class="hljs-keyword">case</span> a == <span class="hljs-number">10</span>:\n\t\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"10 or \'10\'"</span> );\n\t\t<span class="hljs-keyword">break</span>;\n\t<span class="hljs-keyword">case</span> a == <span class="hljs-number">42</span>:\n\t\t<span class="hljs-built_in">console</span>.log( <span class="hljs-string">"42 or \'42\'"</span> );\n\t\t<span class="hljs-keyword">break</span>;\n\t<span class="hljs-keyword">default</span>:\n\t\t<span class="hljs-comment">// never gets here</span>\n}\n<span class="hljs-comment">// 42 or \'42\'</span>\n</code></pre>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce">Array.prototype.reduce() - JavaScript | MDN</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',B.path="~/contents/Terminal/20190507-you-dont-know-js-note.md",H.attributes={title:"Cold Winter in 2018!",date:"2018-12-08 15:00",modified:"2018-12-09 20:00",tags:["Winter",Cs,ne],authors:e,summary:"So cold~",category:x,published:s},H.html='<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/NLhL32Qm3UI" frameborder="0"></iframe>  \n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/yVyiQTp-MuI" frameborder="0"></iframe>  \n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/ves4W2ymrGs" frameborder="0"></iframe>  \n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/TeG4I6VyR00" frameborder="0"></iframe>  \n',H.path="~/contents/Browser/20181208-cold-winter-in-2018.md",$.attributes={title:"ifup cannot bring up eth1 after upgrading",date:"2019-08-08 22:39",author:e,tags:[Hs,I],status:a,summary:"Happened after I upgraded to Debian Buster on my Bandwagonhost VPS.",category:n,published:s},$.html='<p>This happened some hours after I upgraded to Debian Buster on my Bandwagonhost VPS. The IP timed out all over the world. Then I did a research in the root shell. It turned out to be <code>networking.service</code> failure:</p>\n<pre><code class="hljs">ifup[<span class="hljs-number">478</span>]: <span class="hljs-symbol">Failed</span> to bring up eth1.\nsystemd[<span class="hljs-number">1</span>]: networking.service: <span class="hljs-symbol">Failed</span> with result <span class="hljs-string">\'exit-code\'</span>.\n</code></pre>\n<p>Searched and found a solution<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>:</p>\n<pre><code class="hljs"><span class="hljs-meta"># apt install network-manager</span>\n<span class="hljs-meta"># systemctl enable systemd-networkd</span>\n<span class="hljs-meta"># systemctl enable systemd-resolved</span>\n<span class="hljs-meta"># systemctl start systemd-networkd</span>\n<span class="hljs-meta"># systemctl start systemd-resolved</span>\n<span class="hljs-meta"># apt install isc-dhcp-client</span>\n<span class="hljs-meta"># dpkg-reconfigure resolvconf</span>\n</code></pre>\n<p>Then the IP worked again, but <code>networking.service</code> still failed with the same error. I searched again and found it related to <code>/etc/network/interfaces</code><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>.</p>\n<p>My <code>/etc/network/interfaces</code> looked like this:</p>\n<pre><code class="hljs"><span class="hljs-attr">source</span> <span class="hljs-string">/etc/network/interfaces.d/*</span>\n<span class="hljs-attr">auto</span> <span class="hljs-string">lo</span>\n<span class="hljs-attr">iface</span> <span class="hljs-string">lo inet loopback</span>\n<span class="hljs-attr">auto</span> <span class="hljs-string">eth0</span>\n<span class="hljs-attr">iface</span> <span class="hljs-string">eth0 inet dhcp</span>\n<span class="hljs-attr">auto</span> <span class="hljs-string">eth1</span>\n<span class="hljs-attr">iface</span> <span class="hljs-string">eth1 inet dhcp</span>\n</code></pre>\n<p>Meanwhile the output of <code>networkctl</code> looked like this:</p>\n<pre><code class="hljs">IDX LINK            <span class="hljs-built_in"> TYPE </span>              OPERATIONAL SETUP     \n  1 lo               loopback           carrier     unmanaged\n  2 eth0             ether              routable    unmanaged\n</code></pre>\n<p>There’s nothing to do with so-called eth1, so this is my edited <code>/etc/network/interfaces</code> now:</p>\n<pre><code class="hljs"><span class="hljs-attr">source</span> <span class="hljs-string">/etc/network/interfaces.d/*</span>\n<span class="hljs-attr">auto</span> <span class="hljs-string">lo</span>\n<span class="hljs-attr">iface</span> <span class="hljs-string">lo inet loopback</span>\n<span class="hljs-attr">auto</span> <span class="hljs-string">eth0</span>\n<span class="hljs-attr">iface</span> <span class="hljs-string">eth0 inet dhcp</span>\n<span class="hljs-comment">#auto eth1</span>\n<span class="hljs-comment">#iface eth1 inet dhcp</span>\n</code></pre>\n<p>The reason why that happened might be due to my selection of using the config file from maintainer’s package when I did the upgrade.</p>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://askubuntu.com/a/769239">networking - ifup cannot bring up eth0 after upgrading to 16.04 - Ask Ubuntu</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://askubuntu.com/questions/824376/failed-to-start-raise-network-interfaces-after-upgrading-to-16-04">networking - Failed to start Raise network interfaces after upgrading to 16.04 - Ask Ubuntu</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',$.path="~/contents/Terminal/20190808-bwg-cant-bring-up-eth1.md",z.attributes={title:"My Isso Configuration",author:e,date:zs,tags:[y,hs],summary:"I love it!",category:n,published:s},z.html='<div id="series">\n        <p>This post is a part of "<b>My Isso Style</b>" Series.</p>\n        <ol class="parts">\n\t\t\t\t\t<li>\n\t\t\t\t\t<a href="/terminal/2016/07/12/start-to-use-isso/">Installation</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li id="i">\n\t\t\t\t\t<b>Configuration</b>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t<a href="/terminal/2019/06/10/inside-the-isso-database/">Inside the Database</a>\n\t\t\t\t\t</li>\n        </ol>\n</div>\n<h2 id="server-configuration">Server Configuration</h2>\n<pre><code class="hljs language-ini"><span class="hljs-section">[general]</span>\n<span class="hljs-attr">dbpath</span> = /var/lib/isso/comments.db\n<span class="hljs-attr">host</span> = https://snorl.ax\n<span class="hljs-attr">notify</span> = smtp\n<span class="hljs-attr">log-file</span> = /var/lib/isso/snorl.ax.log\n<span class="hljs-attr">gravatar</span> = <span class="hljs-literal">true</span>\n<span class="hljs-attr">gravatar-url</span> = https://www.gravatar.com/avatar/{}?d=https%%<span class="hljs-number">3</span>A%%<span class="hljs-number">2</span>F%%<span class="hljs-number">2</span>Fstatic.snorl.ax%%<span class="hljs-number">2</span>Ftheme%%<span class="hljs-number">2</span>Fimages%%<span class="hljs-number">2</span>Ficon_anonymous.png\n<span class="hljs-attr">reply-notifications</span>=<span class="hljs-literal">true</span>\n<span class="hljs-section">\n[moderation]</span>\n<span class="hljs-attr">enabled</span> = <span class="hljs-literal">true</span>\n<span class="hljs-section">\n[guard]</span>\n<span class="hljs-attr">enabled</span> = <span class="hljs-literal">true</span>\n<span class="hljs-attr">ratelimit</span> = <span class="hljs-number">1</span>\n<span class="hljs-attr">direct-reply</span> = <span class="hljs-number">3</span>\n<span class="hljs-attr">reply-to-self</span> = <span class="hljs-literal">true</span>\n<span class="hljs-section">\n[smtp]</span>\n<span class="hljs-attr">host</span> = localhost\n<span class="hljs-attr">port</span> = <span class="hljs-number">25</span>\n<span class="hljs-attr">security</span> = none\n<span class="hljs-attr">to</span> = sim@snorl.ax\n<span class="hljs-attr">from</span> = <span class="hljs-string">"Simputer"</span> &lt;admin@snorl.ax&gt;\n<span class="hljs-attr">timeout</span> = <span class="hljs-number">10</span>\n<span class="hljs-section">\n[admin]</span>\n<span class="hljs-attr">enabled</span> = <span class="hljs-literal">false</span>\n</code></pre>\n<p>For other options I haven’t set u could check <a href="https://posativ.org/isso/docs/configuration/server/" target="_blank">the official documentation</a><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p>\n<ol>\n<li>\n<p>In <code>[general]</code>:</p>\n<ul>\n<li><code>dbpath</code> is the path of the sqlite database file where I store the data.</li>\n<li><code>host</code> is the url where I want the isso to be shown, for isso to be shown in both http and https version, it should be set as:</li>\n</ul>\n<pre><code class="hljs">host =\n<span class="hljs-symbol">\thttp:</span><span class="hljs-comment">//snorl.ax</span>\n<span class="hljs-symbol">\thttps:</span><span class="hljs-comment">//snorl.ax</span>\n</code></pre>\n<ul>\n<li><code>notify</code> is the notification backend for new comments, I set <code>notify = smtp</code> so I’ll receive a new email when a new comment is successfully submitted to the server, it also make the reply notification possible.</li>\n<li><code>log-file</code> is the path of log showing the status of the isso.</li>\n<li><code>gravatar = true</code> enables the use of gravatar.</li>\n<li><code>gravatar-url</code> defines url for gravatar images. The “{}” is where the email hash will be placed. The value after <code>d=</code> defines the defalut image  to show if there is no image associated with the requested email hash. If you choose not to set this option, isso will automatically set the value to identicon, which is a geometric pattern based on an email hash.<br>\nTo set my own default image for the situation, I need to urlencode the url for that image. Now for me <code>https://static.snorl.ax/theme/images/icon_anonymous.png</code> is the url, so I do it with python<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>:</li>\n</ul>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>python\n</code></pre>\n<p>Import the required library for it and do it:</p>\n<pre><code class="hljs"><span class="hljs-meta">&gt;&gt;</span>&gt; import urllib.parse\n<span class="hljs-meta">&gt;&gt;</span>&gt; the = urllib.parse.quote_plus(<span class="hljs-string">\'https://static.snorl.ax/theme/images/icon_anonymous.png\'</span>)\n<span class="hljs-meta">&gt;&gt;</span>&gt; the.replace(<span class="hljs-string">\'%\'</span>,<span class="hljs-string">\'%%\'</span>)\n</code></pre>\n<p>Then it’ll return the required url-encoded string:</p>\n<pre><code class="hljs">\'https<span class="hljs-variable">%%3</span>A<span class="hljs-variable">%%2</span>F<span class="hljs-variable">%%2</span>Fstatic.snorl.ax<span class="hljs-variable">%%2</span>Ftheme<span class="hljs-variable">%%2</span>Fimages<span class="hljs-variable">%%2</span>Ficon_anonymous.png\'\n</code></pre>\n<p>Now I can set <code>gravatar-url = https://www.gravatar.com/avatar/{}?d=https%%3A%%2F%%2Fstatic.snorl.ax%%2Ftheme%%2Fimages%%2Ficon_anonymous.png</code> to see it working. Normally we don’t need to replace <code>%</code> with <code>%%</code>, however in isso if I don’t do so, the following error will happen:</p>\n<pre><code class="hljs">InterpolationSyntaxError: <span class="hljs-string">\'%\'</span> must be followed by <span class="hljs-string">\'%\'</span> or <span class="hljs-string">\'(\'</span>, found: <span class="hljs-string">u\'%3A%2F%2Fstatic.snorl.ax%2Ftheme%2Fimages%2Ficon_anonymous.png\'</span>  \n</code></pre>\n<p>To know more about how to tango with Gravatar, see <a href="https://en.gravatar.com/site/implement/images/" target="_blank">the documentation</a>.</p>\n<ul>\n<li><code>reply-notification=true</code> enables email notifications of replies to the commenters who have previously subcribed to email notification of replies.</li>\n</ul>\n</li>\n<li>\n<p>In <code>[moderation]</code>:</p>\n<ul>\n<li><code>enabled</code> enables comment moderation queue and only affects new comments. Comments in moderation queue are not visible to other users until I activate them.</li>\n</ul>\n</li>\n<li>\n<p>In <code>[guard]</code>:</p>\n<ul>\n<li><code>enabled</code> enable guard, for the rest of the section to take into effect.</li>\n<li><code>ratelimit</code> is the number of comments each IP address can send in a thread per minute.</li>\n<li><code>direct-reply</code> is the number of comments a thread can receive per minute.</li>\n<li><code>replt-to-self</code> allows a commenter to reply to his own comment.</li>\n</ul>\n</li>\n<li>\n<p>In <code>[smtp]</code>:</p>\n<ul>\n<li><code>host</code>, <code>port</code>, <code>security</code>: the SMTP server, port and security used when a notification is sent through email. Since the isso is located in the same server as my email, the configuration works without <code>password</code>. If u want to set email service on ur server and haven’t got a clue, u could check out <a href="/terminal/2018/12/27/running-email-service-on-my-own-server/">my post</a>.</li>\n<li><code>from</code>: The sender address of the email notification.</li>\n<li><code>to</code>: The receiver address of the email notification for every new comments(with their moderation address if moderation is enabled).</li>\n<li><code>timeout</code>: Specify a timeout in seconds for blocking operations like the connection attempt.</li>\n</ul>\n</li>\n<li>\n<p>In <code>[admin]</code>:</p>\n<ul>\n<li><code>enabled=false</code> disable the administration page in <code>https://isso.snorl.ax/admin/</code>. No need to open an admin page for that while u could <a href="/terminal/2019/06/10/inside-the-isso-database/">look into the sqlite urself</a>.</li>\n</ul>\n</li>\n<li>\n<p><code>[server]</code> block has been deleted \'cause it won’t work with uwsgi.</p>\n</li>\n</ol>\n<h2 id="client-configuration">Client Configuration</h2>\n<p>This is the configuration I use on my site:</p>\n<pre><code class="hljs">&lt;section <span class="hljs-attribute">id</span>=comments <span class="hljs-attribute">data-title</span>=<span class="hljs-string">"{{ title }}"</span> <span class="hljs-attribute">data-isso-id</span>=<span class="hljs-string">"/the/path/to/the/page/"</span>&gt;\n\n&lt;script <span class="hljs-attribute">data-isso</span>=https://isso.snorl.ax/ <span class="hljs-attribute">data-isso-gravatar</span>=<span class="hljs-literal">true</span> <span class="hljs-attribute">data-isso-avatar</span>=<span class="hljs-literal">false</span> <span class="hljs-attribute">data-isso-reply-notifications</span>=<span class="hljs-literal">true</span> <span class="hljs-attribute">data-isso-reply-to-self</span>=<span class="hljs-literal">true</span> <span class="hljs-attribute">data-isso-css</span>=<span class="hljs-literal">false</span> <span class="hljs-attribute">src</span>=https://static.snorl.ax/theme/js/embed.min.js <span class="hljs-attribute">data-isso-lang</span>=en&gt;&lt;/script&gt;\n</code></pre>\n<p>For other options I don’t use, u can check <a href="https://posativ.org/isso/docs/configuration/client/" target="_blank">the official documention</a>.</p>\n<ol>\n<li>The id of the section is <code>comments</code>, not <code>isso-thread</code>, \'cause I use the edited version of <code>embed.min.js</code>, where I replace all the occurences of <code>isso-thread</code> with <code>comments</code>. That’s generally not a recommended practice. Each update of isso will get me busy replacing. So maybe one day I’ll revert it back. The <code>data-title</code> parses the title to the database as the title of the thread, not working on the thread existing in the database. <code>data-isso-id</code> resolves the problem when the same page has several urls. (For example, a soft link on a directory can cause the result.)</li>\n<li>I set <code>data-isso</code> in the script tag \'cause the <code>src</code> is not the original path of the isso.</li>\n<li>To get Gravatar working on the site, <code>data-isso-gravatar=true data-isso-avatar=false</code> is a must.</li>\n<li>To enable the reply notifications on the site, <code>data-isso-reply-notifications=true</code> should be set.</li>\n<li><code>data-isso-reply-to-self=true</code> allows the commenter to reply to himself.</li>\n<li><code>data-isso-lang=en</code> set the language to English. So the language of the running isso on the site won’t vary based on the very language the viewer is using.</li>\n<li>For my css style of isso to get into effect completely without being interfered, <code>data-isso-css=false</code> is a must.<br>\nClick <a href="https://static.snorl.ax/isso.css">here</a> to seethe css code inside the <code>embed.min.js</code> of the newest version of isso as of December 27, 2018. Before applying my own css style completely to the running isso, editing the style based on the original code is generally a recommended practice.</li>\n</ol>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://posativ.org/isso/docs/" target="_blank">Isso Official Documentation</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://stackoverflow.com/a/28874886/9850945" target="_blank">Configparser and string with % - StackOverFlow</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',z.path="~/contents/Terminal/isso-config.md",X.attributes={title:"Inside The Isso Database",author:e,date:zs,tags:[y,ms],summary:"Of course it's a table with threads and comments",category:n,published:s},X.html='<div id="series">\n        <p>This post is a part of "<b>My Isso Style</b>" Series.</p>\n        <ol class="parts">\n\t\t\t\t\t<li>\n\t\t\t\t\t<a href="/terminal/2016/07/12/start-to-use-isso/">Installation</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t<a href="/terminal/2019/06/10/my-isso-configuration/">Configuration</a>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li id="i">\n\t\t\t\t\t<b>Inside the Database</b>\n\t\t\t\t\t</li>\n        </ol>\n</div>\n<h2 id="the-tables">The Tables</h2>\n<p>Remember the time when the admin interface was not a feature in isso, I submitted two issues in Github: <a href="https://github.com/posativ/isso/issues/264" target="_blank">#264</a>, <a href="https://github.com/posativ/isso/issues/270" target="_blank">#270</a>.<br>\nNow looking back, I think that more and more questions alike could be there without a knowledge for the very database file we r using. Thus it’s really important to get into it<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.<br>\nSwitch to a user with enough permission to the sqlite databse file and get into the directory where there’s database file:</p>\n<pre><code class="hljs"><span class="hljs-meta">$</span><span class="bash"> su isso</span>\n<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~</span>\n</code></pre>\n<p>It’s recommended to backup the database before editing:</p>\n<pre><code class="hljs">$ <span class="hljs-keyword">cp</span> comments<span class="hljs-meta">.db</span> comments<span class="hljs-meta">.db</span>.bak\n</code></pre>\n<p>Now launch the sqlite3 utility.</p>\n<pre><code class="hljs"><span class="hljs-variable">$ </span>sqlite3\n</code></pre>\n<p>Turn the headers on and attach the database to the variable for editing.</p>\n<pre><code class="hljs">sqlite&gt; .headers <span class="hljs-keyword">ON</span>\nsqlite&gt; ATTACH <span class="hljs-string">\'comments.db\'</span> <span class="hljs-keyword">AS</span> isso;\n</code></pre>\n<p>List the tables.</p>\n<pre><code class="hljs"><span class="hljs-selector-tag">sqlite</span>&gt; <span class="hljs-selector-class">.tables</span>\n</code></pre>\n<p>The output are three self-explaining table names:</p>\n<pre><code class="hljs"><span class="hljs-selector-tag">isso</span><span class="hljs-selector-class">.comments</span>     <span class="hljs-selector-tag">isso</span><span class="hljs-selector-class">.preferences</span>  <span class="hljs-selector-tag">isso</span><span class="hljs-selector-class">.threads</span>\n</code></pre>\n<p>Check the contents in <code>isso.comments</code>:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> isso.comments;\n</code></pre>\n<p>Take a glimpse of a part of them:</p>\n<pre><code class="hljs">tid|<span class="hljs-type">id</span>|<span class="hljs-type">parent</span>|<span class="hljs-type">created</span>|<span class="hljs-type">modified</span>|<span class="hljs-type">mode</span>|<span class="hljs-type">remote_addr</span>|<span class="hljs-type">text</span>|<span class="hljs-type">author</span>|<span class="hljs-type">email</span>|<span class="hljs-type">website</span>|<span class="hljs-type">likes</span>|<span class="hljs-type">dislikes</span>|<span class="hljs-type">voters</span>|<span class="hljs-type">notification</span>\n<span class="hljs-number">1</span>|<span class="hljs-type">1</span>|<span class="hljs-type">|1469977655</span><span class="hljs-number">.38995</span>|<span class="hljs-type">1469977994</span><span class="hljs-number">.84019</span>|<span class="hljs-type">1</span>|<span class="hljs-type">104</span><span class="hljs-number">.86</span><span class="hljs-number">.45</span><span class="hljs-number">.0</span>|<span class="hljs-type">Goodbye</span> Disqus!  \nHello __ISSO__!  \nIt\'s really amazing and I could use __MarkDown__ to comment!  \n__I\'m So GLAD To Become an _ISSO USER_!__  \nBTW, much faster than Disqus!|<span class="hljs-type">Sim</span>|<span class="hljs-type">sim</span>@snorl.ax|<span class="hljs-type">|2</span>|<span class="hljs-type">0</span>|<span class="hljs-type">|0</span>\n</code></pre>\n<p>It’s a comment table with columns named <code>tid</code>, <code>id</code>, <code>parent</code>, <code>created</code>, <code>modified</code>, <code>mode</code>, <code>remote_addr</code>, <code>text</code>, <code>author</code>, <code>email</code>, <code>website</code>, <code>likes</code>, <code>dislikes</code>, <code>voters</code>, <code>notification</code>.</p>\n<ul>\n<li><code>tid</code>: The id of the thread the comment belongs to.</li>\n<li><code>id</code>: The id of the comment.</li>\n<li><code>parent</code>: If the comment is meant to reply to a comment, then the comment has the id of the comment it’s meant to reply to.</li>\n<li><code>created</code>: The time when the comment is created. Stored in Unix Time format.</li>\n<li><code>modified</code>: The time when the comment is modified. Stored in Unix Time format.</li>\n<li><code>mode</code>: 1 if the comment is published. 2 if the comment is waiting for approval.</li>\n<li><code>remote_addr</code>: The IP address of the commenter.</li>\n<li><code>text</code>: The content of the comment.</li>\n<li><code>author</code>: The name of the user. Blank if the user didn’t fill in the field.</li>\n<li><code>email</code>: The email of the user. Blank if the user didn’t fill in the field.</li>\n<li><code>website</code>: The url of the website of the user. Blank if the user didn’t fill in the field.</li>\n<li><code>likes</code>: Likes the comment has received so far.</li>\n<li><code>dislikes</code>: Dislikes the comment has received so far.</li>\n<li><code>voters</code>: The number of voters of the comments.</li>\n<li><code>notification</code>: 1 if the author chose to receive reply notification.</li>\n</ul>\n<p>Check the contents in <code>isso.preferences</code>:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> isso.preferences;\n</code></pre>\n<p>Take a glimpse of it:</p>\n<pre><code class="hljs"><span class="hljs-built_in">key</span>|<span class="hljs-built_in">value</span>\nsession-<span class="hljs-built_in">key</span>|s0394578gjhsa23sadjhg23asxcnjk423xjzg2131xzmjhde\n</code></pre>\n<p>It’s table with a session key. I haven’t done anything with it. It might be not much useful in sqlite editing.</p>\n<p>Check the contents in <code>isso.threads</code>:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> isso.threads;\n</code></pre>\n<p>Take a glimpse of a part of them:</p>\n<pre><code class="hljs">id|uri|title\n<span class="hljs-number">1</span>|/terminal/<span class="hljs-number">2016</span>/<span class="hljs-number">07</span>/<span class="hljs-number">12</span>/start-to-use-isso/|Tried ISSO <span class="hljs-keyword">and</span>......\n<span class="hljs-number">7</span>|/terminal/<span class="hljs-number">2016</span>/<span class="hljs-number">05</span>/<span class="hljs-number">27</span>/make-full-use-of-cloudflare/|Make full use of CloudFlare\n<span class="hljs-number">9</span>|/browser/<span class="hljs-number">2016</span>/<span class="hljs-number">06</span>/<span class="hljs-number">04</span>/panic-at-the-disco-bohemian-rhapsody/|Panic! At The Disco - Bohemian Rhapsody\n</code></pre>\n<p>It’s a thread table with columns named <code>id</code>, <code>uri</code> and <code>title</code>.</p>\n<ul>\n<li><code>id</code>: The id of the thread.</li>\n<li><code>uri</code>: The URL of the page the thread serves to.</li>\n<li><code>title</code>: The title of the thread, used in the title of email notification of the thread.</li>\n</ul>\n<p>The following examples might help.</p>\n<h2 id="ex-1-delete-comments">Ex 1: Delete Comments</h2>\n<p>In the examples above, the contents in <code>isso.comments</code> was checked:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> isso.comments;\n</code></pre>\n<p>Take a glimpse of a part of them:</p>\n<pre><code class="hljs">tid|<span class="hljs-type">id</span>|<span class="hljs-type">parent</span>|<span class="hljs-type">created</span>|<span class="hljs-type">modified</span>|<span class="hljs-type">mode</span>|<span class="hljs-type">remote_addr</span>|<span class="hljs-type">text</span>|<span class="hljs-type">author</span>|<span class="hljs-type">email</span>|<span class="hljs-type">website</span>|<span class="hljs-type">likes</span>|<span class="hljs-type">dislikes</span>|<span class="hljs-type">voters</span>|<span class="hljs-type">notification</span>\n<span class="hljs-number">1</span>|<span class="hljs-type">1</span>|<span class="hljs-type">|1469977655</span><span class="hljs-number">.38995</span>|<span class="hljs-type">1469977994</span><span class="hljs-number">.84019</span>|<span class="hljs-type">1</span>|<span class="hljs-type">104</span><span class="hljs-number">.86</span><span class="hljs-number">.45</span><span class="hljs-number">.0</span>|<span class="hljs-type">Goodbye</span> Disqus!  \nHello __ISSO__!  \nIt\'s really amazing and I could use __MarkDown__ to comment!  \n__I\'m So GLAD To Become an _ISSO USER_!__  \nBTW, much faster than Disqus!|<span class="hljs-type">Sim</span>|<span class="hljs-type">sim</span>@snorl.ax|<span class="hljs-type">|2</span>|<span class="hljs-type">0</span>|<span class="hljs-type">|0</span>\n<span class="hljs-number">7</span>|<span class="hljs-type">2</span>|<span class="hljs-type">|1470373481</span><span class="hljs-number">.55917</span>|<span class="hljs-type">|1</span>|<span class="hljs-type">54</span><span class="hljs-number">.210</span><span class="hljs-number">.166</span><span class="hljs-number">.0</span>|<span class="hljs-type">nice</span> blog i like it|<span class="hljs-type">|||0</span>|<span class="hljs-type">0</span>|<span class="hljs-type">|0</span>\n</code></pre>\n<p>Suppose I’m gonna delete the first comment in the table, that’s all I have to do:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> id=<span class="hljs-number">1</span>;\n</code></pre>\n<p>To deal similar things with the author Sim, check with care first, to simplify the thngs, only show the column I need:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> id, author, <span class="hljs-type">text</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> author=<span class="hljs-string">\'Sim\'</span>;\n</code></pre>\n<p>A part of the output:</p>\n<pre><code class="hljs">id|<span class="hljs-type">author</span>|<span class="hljs-type">text</span>\n<span class="hljs-number">8</span>|<span class="hljs-type">Sim</span>|<span class="hljs-type">&lt;p</span>&gt;It depends.<span class="hljs-keyword">If</span> u prefer a FBI icon,just <span class="hljs-built_in">do</span> it!&lt;/p&gt;\n<span class="hljs-number">12</span>|<span class="hljs-type">Sim</span>|<span class="hljs-type">&lt;p</span>&gt;It\'s not easy to keep balanced diet&lt;/p&gt;\n</code></pre>\n<p>To delete the first comment of the table:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> id=<span class="hljs-number">8</span>;\n</code></pre>\n<p>To delete all of Sim’s comments:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> author=<span class="hljs-string">\'Sim\'</span>;\n</code></pre>\n<p>To delete all of Anonymous user’s comments:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> author <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;\n</code></pre>\n<p>To delete the comments whose <code>id</code> are between 1 and 7 (1 and 7 included):</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> id&gt;=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> id&lt;=<span class="hljs-number">7</span>;\n</code></pre>\n<p>To delete the comment of which <code>id</code> is 1 or 7:</p>\n<pre><code class="hljs">sqlite&gt; DELETE <span class="hljs-keyword">FROM</span> isso.comments WHERE <span class="hljs-attribute">id</span>==1 <span class="hljs-keyword">AND</span> <span class="hljs-attribute">id</span>==7;\n</code></pre>\n<h2 id="ex-2-approve-comments">Ex 2: Approve Comments</h2>\n<p>This can be useful when u r not able to receive the moderation link via email.<br>\nTo check all the comments under approval in sqlite:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> id,author,text <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> mode=<span class="hljs-number">2</span>;\n</code></pre>\n<p>The output:</p>\n<pre><code class="hljs">id|<span class="hljs-type">author</span>|<span class="hljs-type">text</span>\n<span class="hljs-number">72</span>|<span class="hljs-type">Sim</span>|<span class="hljs-type">Test</span>\n<span class="hljs-number">73</span>|<span class="hljs-type">Sim</span>|<span class="hljs-type">Test</span>\n</code></pre>\n<p>To publish the first comment:</p>\n<pre><code class="hljs">sqlite&gt; UPDATE isso.comments <span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">mode</span>=1 WHERE <span class="hljs-attribute">id</span>=72;\n</code></pre>\n<p>To publish all the comments waiting for approval:</p>\n<pre><code class="hljs">sqlite&gt; UPDATE isso.comments <span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">mode</span>=1 WHERE <span class="hljs-attribute">mode</span>=2;\n</code></pre>\n<p>To delete all the comments waiting for approval:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> mode=<span class="hljs-number">2</span>;\n</code></pre>\n<h2 id="ex-3-delete-and-update-threads">Ex 3: Delete And Update Threads</h2>\n<p>To check the threads:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> isso.threads;\n</code></pre>\n<p>Take a glimpse of a part of them:</p>\n<pre><code class="hljs">id|uri|title\n<span class="hljs-number">1</span>|/terminal/<span class="hljs-number">2016</span>/<span class="hljs-number">07</span>/<span class="hljs-number">12</span>/start-to-use-isso/|Tried ISSO <span class="hljs-keyword">and</span>......\n<span class="hljs-number">7</span>|/terminal/<span class="hljs-number">2016</span>/<span class="hljs-number">05</span>/<span class="hljs-number">27</span>/make-full-use-of-cloudflare/|Make full use of CloudFlare\n<span class="hljs-number">9</span>|/browser/<span class="hljs-number">2016</span>/<span class="hljs-number">06</span>/<span class="hljs-number">04</span>/panic-at-the-disco-bohemian-rhapsody/|Panic! At The Disco - Bohemian Rhapsody\n</code></pre>\n<p>To delete the first thread:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.threads <span class="hljs-keyword">WHERE</span> id=<span class="hljs-number">1</span>;\n</code></pre>\n<p>To delete the comments to the first thread:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.comments <span class="hljs-keyword">WHERE</span> tid=<span class="hljs-number">1</span>;\n</code></pre>\n<p>To move the comments of the first thread to the second one:</p>\n<pre><code class="hljs">sqlite&gt; UPDATE isso.comments <span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">tid</span>=7 WHERE <span class="hljs-attribute">tid</span>=1;\n</code></pre>\n<p>To check all the threads whose url start with <code>/terminal</code>:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> isso.threads <span class="hljs-keyword">WHERE</span> uri <span class="hljs-keyword">LIKE</span> <span class="hljs-string">\'/terminal%\'</span>;\n</code></pre>\n<p>To delete all the threads whose url start with <code>/terminal</code>:</p>\n<pre><code class="hljs">sqlite&gt; <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> isso.threads <span class="hljs-keyword">WHERE</span> uri <span class="hljs-keyword">LIKE</span> <span class="hljs-string">\'/terminal%\'</span>;\n</code></pre>\n<p>To edit the url the third thread is shown on:</p>\n<pre><code class="hljs">sqlite&gt; UPDATE isso.threads <span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">uri</span>=<span class="hljs-string">\'/the/path/to/it/\'</span> WHERE <span class="hljs-attribute">id</span>=9;\n</code></pre>\n<p>To edit the third thread’s title:</p>\n<pre><code class="hljs">sqlite&gt; UPDATE isso.threads <span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">title</span>=<span class="hljs-string">\'The new title\'</span> WHERE <span class="hljs-attribute">id</span>=9;\n</code></pre>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://www.tutorialspoint.com/sqlite/index.htm" target="_blank">SQLite Tutorial - tutorialspoint</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',X.path="~/contents/Terminal/isso-sql.md",Z.attributes={title:"Add Brotli To Nginx On Debian Stretch",date:"2019-06-07 21:08",modified:"2019-06-12 12:30",author:e,tags:[gs,g],status:a,summary:"Owch........",category:n,published:s},Z.html='<h2 id="installation">Installation</h2>\n<p>Normally I just install nginx this way:</p>\n<p>Add the lines to <code>/etc/apt/sources.list</code>:</p>\n<pre><code class="hljs">deb http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/packages/m</span>ainline<span class="hljs-regexp">/debian/</span> stretch nginx\ndeb-src http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/packages/m</span>ainline<span class="hljs-regexp">/debian/</span> stretch nginx\n</code></pre>\n<p>If the key hasn’t been added, add it:</p>\n<pre><code class="hljs">sim@server:~$ wget https://nginx.org/keys/nginx_signing.<span class="hljs-meta">key</span> <span class="hljs-variable">&amp;&amp;</span> sudo apt-<span class="hljs-meta">key</span> <span class="hljs-meta">add</span> nginx_signing.<span class="hljs-meta">key</span>\n</code></pre>\n<p>Then install it:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo apt update &amp;&amp; sudo apt install nginx\n</code></pre>\n<h2 id="brotli-basic-settings">Brotli: Basic Settings</h2>\n<p>THe brotli is not included in the prebuilt package. So I have to build it from source.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>\n<p>Get the source:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo apt source nginx\n</code></pre>\n<p>Then clone <code>ngx_brotli</code> from github:</p>\n<pre><code class="hljs">sim@server:~$ git clone http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/eustas/ngx_brotli.git\nsim@server:~$ <span class="hljs-keyword">cd</span> ngx_brotli &amp;&amp; git submodule <span class="hljs-keyword">update</span> --init &amp;&amp; <span class="hljs-keyword">cd</span> ~\n</code></pre>\n<p>Install the build dependencies:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo apt build-dep nginx\n</code></pre>\n<p>Make the modules and copy it to the right place:</p>\n<pre><code class="hljs"><span class="hljs-symbol">sim@</span>server:~$ cd ~/nginx-*\n<span class="hljs-symbol">sim@</span>server:~/nginx<span class="hljs-number">-1.17</span><span class="hljs-number">.0</span>$ ./configure --with-compat --add-dynamic-module=../ngx_brotli\n<span class="hljs-symbol">sim@</span>server:~/nginx<span class="hljs-number">-1.17</span><span class="hljs-number">.0</span>$ make modules\n<span class="hljs-symbol">sim@</span>server:~/nginx<span class="hljs-number">-1.17</span><span class="hljs-number">.0</span>$ sudo cp objs<span class="hljs-comment">/*.so /usr/lib/nginx/modules\n</span></code></pre>\n<p><code>/etc/nginx/nginx.conf</code>:</p>\n<pre><code class="hljs">load_module modules/ngx_http_brotli_filter_module.so<span class="hljs-comment">;</span>\nload_module modules/ngx_http_brotli_static_module.so<span class="hljs-comment">;</span>\n...\n</code></pre>\n<p>Include the lines in server blocks that need the brotli:</p>\n<pre><code class="hljs">server {\n  ...\n  brotli <span class="hljs-keyword">on</span>;\n  brotli_static <span class="hljs-keyword">on</span>;\n  brotli_types *;\n  ...\n}\n</code></pre>\n<p>Don’t include the lines in http block directly since it will force all the server blocks to use brotli, which will a nightmire when it affects a backend server… Things like brotli should be only used in frontend server blocks.</p>\n<p>Restart nginx:</p>\n<pre><code class="hljs">sim<span class="hljs-variable">@server</span><span class="hljs-symbol">:~/nginx-</span><span class="hljs-number">1.17</span>.0<span class="hljs-variable">$ </span>sudo systemctl restart nginx\n</code></pre>\n<p>The other third party modules not included in the prebuilt package can be installed this way as well.</p>\n<h2 id="brotli-more-on-settings">Brotli: More ON settings</h2>\n<p>The following settings might be useful due to the following reasons<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>:</p>\n<ol>\n<li>Brotli with setting 4 is both significantly smaller AND compresses faster than gzip</li>\n<li>Brotli is made text-based file formats like HTML (included by default), plaintext, JavaScript, JSON, SVG and RSS</li>\n<li>Pre-compress the static formats so these can be served immediately for every request</li>\n</ol>\n<p>But it is not useful for me when I’m using <code>proxy_pass</code> to a backend from a frontend. So <code>brotli_static</code> means nothing when I fetch the files from another server. Proxying static files lowers the speed. I’d rather upload files to multiple servers (<a href="/terminal/2019/06/07/git-an-excellent-file-transferer/">My way of doing this via Git</a>.</p>\n<p><code>/etc/nginx/conf.d/default.conf</code>:</p>\n<pre><code class="hljs">load_module modules/ngx_http_brotli_filter_module.so;\nload_module modules/ngx_http_brotli_static_module.so;\n\n<span class="hljs-built_in">..</span>.<span class="hljs-built_in">\nserver </span>{\n  server_name snorl.ax;\n  <span class="hljs-built_in">..</span>.\n  brotli on;\n  brotli_comp_level 4;\n  brotli_types text/plain text/css application/javascript application/json image/svg+xml application/xml+rss;\n\n  brotli_static on;\n  <span class="hljs-built_in">..</span>.\n}\n</code></pre>\n<p>The site is generated by Pelican, a static site generator, which means the site files are mostly text-based formats. So a bash is made to process them before the files are published:</p>\n<pre><code class="hljs language-bash"><span class="hljs-meta">#!/bin/bash\n</span>\n<span class="hljs-keyword">for</span> FILE <span class="hljs-keyword">in</span> $(find public -<span class="hljs-built_in">type</span> f -iname <span class="hljs-string">\'*.css\'</span> -o -iname <span class="hljs-string">\'*.js\'</span> -o -iname <span class="hljs-string">\'*.svg\'</span> -o -iname <span class="hljs-string">\'*.json\'</span> -o -iname <span class="hljs-string">\'*.html\'</span> -o -iname <span class="hljs-string">\'*.xml\'</span>); <span class="hljs-keyword">do</span>\n    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Compressing <span class="hljs-variable">${FILE}</span>..."</span>\n    brotli -f <span class="hljs-variable">${FILE}</span> -o <span class="hljs-variable">${FILE}</span>.br;\n    <span class="hljs-built_in">echo</span> <span class="hljs-string">"done."</span>\n<span class="hljs-keyword">done</span>\n</code></pre>\n<p>Then after publishing the files, the pre-processed <code>.br</code>s will be served.</p>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://www.vultr.com/docs/add-brotli-support-to-nginx-on-ubuntu-18-04">Add Brotli support to Nginx on Ubuntu 18.04 - Vultr.com</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://certsimple.com/blog/nginx-brotli">CertSimple | ‘You can’t use Brotli for dynamic content’</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',Z.path="~/contents/Terminal/20190607-add-brotli-to-nginx.md",as.attributes={title:"Resolving Conflicts in Git",date:"2019-04-15T20:46:32.000Z",author:e,tags:[K,Qs],status:a,summary:"Recently when I was working with my branch of isso, I found a conflict on a file. Easy to resolve but kinda important for my future work with git.",category:n,published:s},as.html='<p>First add the upstream remote then fetch it. <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>\n<pre><code class="hljs">git remote add upstream https://repoA\ngit fetch upstream\n</code></pre>\n<p>Check out the branch (in this case, <code>notification</code>) and auto-merge it with the upstream master. <sup class="footnote-ref"><a href="#fn1" id="fnref1:1">[1:1]</a></sup></p>\n<pre><code class="hljs">git checkout notification\ngit merge upstream/master\n</code></pre>\n<p>Resolve the conflicts by fully accept my or their version<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>:</p>\n<p>Accept my version (local, ours):</p>\n<pre><code class="hljs">git checkout --ours -- [filename]\ngit add [filename]\ngit commit -m &quot;merged bla bla&quot;\n</code></pre>\n<p>Accept their version (remote, theirs):</p>\n<pre><code class="hljs">git checkout --theirs -- [filename]\ngit add [filename]\ngit commit -m &quot;merged bla bla&quot;\n</code></pre>\n<p>Do <strong>all conflict files</strong> with either mine or theirs:</p>\n<pre><code class="hljs">git merge --strategy-option ours\n</code></pre>\n<p>or</p>\n<pre><code class="hljs">git merge --strategy-option theirs\n</code></pre>\n<hr class="footnotes-sep">\n<section class="footnotes">\n<ol class="footnotes-list">\n<li id="fn1" class="footnote-item"><p><a href="https://stackoverflow.com/a/38955036/9850945">How to solve merge conflicts across forks? - stackoverflow</a> <a href="#fnref1" class="footnote-backref">↩︎</a> <a href="#fnref1:1" class="footnote-backref">↩︎</a></p>\n</li>\n<li id="fn2" class="footnote-item"><p><a href="https://stackoverflow.com/a/39771096/9850945">How to resolve merge conflicts in Git - stackoverflow</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>\n</li>\n</ol>\n</section>\n',as.path="~/contents/Terminal/20190415-resolving-conflicts-in-git.md",ls.attributes={title:"Waiting for Pray For The Wicked",date:"2018-05-04 00:00",modified:"2018-05-05 12:00",tags:[ae,te],authors:e,summary:"It will be available on June 22, 2018!",ogimage:"/images/og/pray-for-the-wicked-twitter.png",category:x,published:s},ls.html='<p><img src="/images/posts/pray-for-the-wicked-200.jpg" alt="Album Cover"><br>\nReleased videos…</p>\n<ol>\n<li>Say Amen</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/jVXauWq9Hwg" frameborder="0"></iframe>  \n<p>Naughty story!😏</p>\n<ol start="2">\n<li>(Fuck A) Silver Lining (Audio)</li>\n</ol>\n<iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/aZUopuhqwCM" frameborder="0"></iframe>  \n<p>Beyoncé~ Lemonade~ Another cite to a song of a celebrity🐼 Reminds me of “Oops, I did it again” things~</p>\n<p>It is certainly a brilliant year with Fall Out Boy and Panic! At The Disco releasing their album😇Looking forward to it!</p>\n',ls.path="~/contents/Browser/20180504-waiting-for-pray-for-the-wicked.md",ps.attributes={title:"A mania you can't miss",date:"2018-01-23 02:02",tags:[As,Ns],authors:e,summary:"Ready for a mania?",ogimage:"/images/og/fobmania-twitter.png",category:x,published:s},ps.html='<p><img alt="mania" src="/images/posts/fobmania.jpg" title="Album Cover"><br><strong>On January 18,</strong><br>Mania, Fall Out Boy\'s new studio album, was released on Google Play Music one day ahead of the release date of the Audio CD form.<br>The music video of a album track, "Church", was released on Youtube.<br><iframe class="youtube" allow="autoplay; encrypted-media" allowfullscreen="" src="https://www.youtube.com/embed/l3vbvF8bQfI" frameborder="0"></iframe><br>Previously released music video from the album:<br><iframe class="youtube" src="https://www.youtube.com/embed/VtVFTuIZFYU" allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0"></iframe><iframe class="youtube" src="https://www.youtube.com/embed/JJJpRl2cTJc" allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0"></iframe><iframe class="youtube" src="https://www.youtube.com/embed/7YAAyUFL1GQ" allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0"></iframe><iframe class="youtube" src="https://www.youtube.com/embed/jG1JY0rt2Os" allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0"></iframe><iframe class="youtube" src="https://www.youtube.com/embed/wH-by1ydBTM" allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0"></iframe></p><p><strong>On January 19,</strong><br>The audio CD form was released. And they did a LIVE on Good Morning America.<br><iframe class="youtube" src="https://www.youtube.com/embed/Fjr1420IndY" allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0"></iframe><iframe class="youtube" src="https://www.youtube.com/embed/PRLa_q13PgE" allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0"></iframe></p><p><strong>On January 22,</strong><br>Fall Out Boy released the video where Patrick did the magic nerd stuff about "Church" on Twitter.<br></p><blockquote class="twitter-video" data-lang="en"><p lang="en" dir="ltr">The voice of an 👼 watch back when Patrick was in the studio recording vocal takes for Church <a href="https://twitter.com/hashtag/blessed?src=hash&amp;ref_src=twsrc%5Etfw">#blessed</a> <a href="https://twitter.com/hashtag/nerdstuff?src=hash&amp;ref_src=twsrc%5Etfw">#nerdstuff</a> <a href="https://twitter.com/hashtag/FOBMANIA?src=hash&amp;ref_src=twsrc%5Etfw">#FOBMANIA</a> <a href="https://t.co/GpbaogM9Zv">pic.twitter.com/GpbaogM9Zv</a></p>&mdash; Fall Out Boy (@falloutboy) <a href="https://twitter.com/falloutboy/status/955612181751574528?ref_src=twsrc%5Etfw">January 23, 2018</a></blockquote>\n<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"><\/script>\n<p>Pete Wentz did a LIVE with the album music played while bathing and doing some Q&amp;A.<br></p><blockquote class="twitter-tweet" data-lang="en"><p lang="und" dir="ltr"><a href="https://t.co/U9jm3hqX4i">https://t.co/U9jm3hqX4i</a></p>&mdash; pw (@petewentz) <a href="https://twitter.com/petewentz/status/955563045715144706?ref_src=twsrc%5Etfw">January 22, 2018</a></blockquote>\n<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"><\/script>\n<p>Buy a copy if u haven\'t done that! You can\'t miss the mania!<br>I have been listenin\' to the whole album like hundreds of times since buying one on Google Play Music!</p>\n',ps.path="~/contents/Browser/20180123-a-mania-you-cant-miss.md",{layout:"default",data:[{title:n,slug:Rs,description:"",posts:new Map([[h,m]])}],error:null,state:{siteTitle:"Simputer",siteUrl:"https://snorl.ax",isso:"https://isso.snorl.ax/",blog:{category:{all:{title:"Homepage",posts:new Map([[S,T],[L,$],[u,f],[c,i],[j,b],[A,N],[Y,z],[V,X],[h,m],[E,D],[Q,Z],[M,F],[R,P],[w,v],[q,B],[ns,as],[t,l],[O,H],[ts,ls],[k,_],[os,ps],[o,p],[r,d]])},browser:{title:x,slug:"browser",description:"",posts:new Map([[w,v],[O,H],[ts,ls],[k,_],[os,ps]])},terminal:{title:n,slug:Rs,description:"",posts:new Map([[S,T],[L,$],[u,f],[c,i],[j,b],[A,N],[Y,z],[V,X],[h,m],[E,D],[Q,Z],[M,F],[R,P],[q,B],[ns,as],[t,l],[o,p],[r,d]])}},tags:new Map([[y,{title:y,posts:new Map([[Y,z],[V,X],[w,v],[r,d]])}],[cs,{title:Es,posts:new Map([[A,N],[h,m],[o,p],[r,d]])}],[g,{title:g,posts:new Map([[A,N],[h,m],[Q,Z],[r,d]])}],["debian",{title:I,posts:new Map([[L,$],[u,f],[j,b],[t,l]])}],[C,{title:C,posts:new Map([[u,f],[j,b],[t,l]])}],["learning-notes",{title:ss,posts:new Map([[M,F],[R,P],[q,B]])}],["cdn",{title:"CDN",posts:new Map([[o,p],[r,d]])}],[J,{title:J,posts:new Map([[A,N],[o,p]])}],["firebase",{title:ws,posts:new Map([[w,v],[o,p]])}],["fall-out-boy",{title:As,posts:new Map([[k,_],[os,ps]])}],["m-a-n-i-a",{title:Ns,posts:new Map([[k,_],[os,ps]])}],[G,{title:G,posts:new Map([[u,f],[t,l]])}],[W,{title:W,posts:new Map([[u,f],[t,l]])}],[U,{title:U,posts:new Map([[u,f],[t,l]])}],[K,{title:K,posts:new Map([[E,D],[ns,as]])}],["js",{title:"js",posts:new Map([[R,P],[q,B]])}],["you-dont-know-js",{title:bs,posts:new Map([[R,P],[q,B]])}],["panic-at-the-disco",{title:ae,posts:new Map([[ts,ls]])}],[Ms,{title:Ms,posts:new Map([[r,d]])}],[Fs,{title:Fs,posts:new Map([[r,d]])}],["keycdn",{title:"KeyCDN",posts:new Map([[o,p]])}],["gitlab",{title:"Gitlab",posts:new Map([[o,p]])}],["github",{title:"Github",posts:new Map([[o,p]])}],["netlify",{title:ie,posts:new Map([[o,p]])}],["tour",{title:"Tour",posts:new Map([[k,_]])}],["shanghai",{title:oe,posts:new Map([[k,_]])}],["pray-for-the-wicked",{title:te,posts:new Map([[ts,ls]])}],["winter",{title:"Winter",posts:new Map([[O,H]])}],[Cs,{title:Cs,posts:new Map([[O,H]])}],["hangzhou",{title:ne,posts:new Map([[O,H]])}],[vs,{title:vs,posts:new Map([[t,l]])}],[xs,{title:xs,posts:new Map([[t,l]])}],[ks,{title:ks,posts:new Map([[t,l]])}],["sendgrid",{title:Zs,posts:new Map([[t,l]])}],["amazon-ses",{title:se,posts:new Map([[t,l]])}],[_s,{title:_s,posts:new Map([[t,l]])}],["spf",{title:"spf",posts:new Map([[t,l]])}],[Ts,{title:Ts,posts:new Map([[t,l]])}],[Is,{title:Is,posts:new Map([[t,l]])}],["conflicts",{title:Qs,posts:new Map([[ns,as]])}],["pokemon",{title:Ks,posts:new Map([[w,v]])}],[ys,{title:ys,posts:new Map([[w,v]])}],["mdn",{title:"MDN",posts:new Map([[M,F]])}],[js,{title:js,posts:new Map([[M,F]])}],[gs,{title:gs,posts:new Map([[Q,Z]])}],[us,{title:us,posts:new Map([[E,D]])}],["ssh",{title:"ssh",posts:new Map([[E,D]])}],["load-balancing",{title:Ps,posts:new Map([[h,m]])}],["perfops",{title:qs,posts:new Map([[h,m]])}],[hs,{title:hs,posts:new Map([[Y,z]])}],[ms,{title:ms,posts:new Map([[V,X]])}],["buster",{title:"Buster",posts:new Map([[j,b]])}],[ds,{title:ds,posts:new Map([[j,b]])}],["cloudiplc",{title:Ls,posts:new Map([[c,i]])}],["vps",{title:"VPS",posts:new Map([[c,i]])}],["nat",{title:"NAT",posts:new Map([[c,i]])}],["chinese",{title:Ws,posts:new Map([[c,i]])}],["bbr",{title:"BBR",posts:new Map([[c,i]])}],["proxy",{title:"Proxy",posts:new Map([[c,i]])}],["bandwagonhost",{title:Hs,posts:new Map([[L,$]])}],[is,{title:is,posts:new Map([[S,T]])}],["vue",{title:"Vue",posts:new Map([[S,T]])}],["github-pages",{title:Os,posts:new Map([[S,T]])}],["in-the-flight",{title:"In The Flight",posts:new Map([])}],["linda-perry",{title:"Linda Perry",posts:new Map([])}],["spotify",{title:"Spotify",posts:new Map([])}],["bbc-radio-1-big-weekend",{title:"BBC Radio 1 Big Weekend",posts:new Map([])}],["bohemian-rhapsody",{title:"Bohemian Rhapsody",posts:new Map([])}],["live",{title:"LIVE",posts:new Map([])}],["youtube",{title:"Youtube",posts:new Map([])}],["death-of-a-bachelor",{title:"Death of A Bachelor",posts:new Map([])}]])}},serverRendered:s}}(!0,"Sim","Terminal","published","running-email-service-on-my-own-server",{},"site-migration-history",{},"start-to-use-isso","purchased-a-nat-vps-from-cloudiplc",{},{},"doing-site-mirroring-with-nginx-on-the-same-domain",{},"permission-issues-with-dovecot-stats-writer",{},"nginx","updated-to-debian-buster",{},"isso","refresh-the-browser",{},"Browser","mania-in-shanghai",{},"just-switched-to-nuxt",{},"Debian","dovecot","performance-test-on-a-page-cloudflare-vs-bare-nginx",{},"git-an-excellent-file-transferer",{},"notes-on-mdn-web-docs-javascript-guide",{},"notes-on-async-performance-ydjs",{},"notes-on-types-grammer-ydjs",{},"cold-winter-in-2018",{},"ifup-cannot-bring-up-eth1-after-upgrading",{},"email","postfix","spamassassin","speed","my-isso-configuration",{},"inside-the-isso-database",{},"git","add-brotli-to-nginx-on-debian-stretch",{},"learning notes",0,"resolving-conflicts-in-git",{},"waiting-for-pray-for-the-wicked",{},"a-mania-you-cant-miss",{},0,"cloudflare","nuxt","openssl","config","sqlite","file",0,"brotli","javascript","You don't know Js","movie","Firebase","saslauthd","imap","smtp","dkim",0,"dmarc","mailutils","snow","Fall Out Boy","M A N I A","CloudFlare",0,"gevent","uwsgi","terminal","load balancing","PerfOps",0,"Github Pages","Bandwagonhost","CloudIPLC",0,0,"Chinese",0,0,0,"2019-06-10 09:00",0,"You Don't Know JS Read Note","Pokemon","Conflicts","SendGrid","Amazon SES",0,"Hangzhou","Panic! At The Disco","Pray For The Wicked",0,"Shanghai",0,0,0,"Netlify")</script><script src="/_nuxt/54e0ba1691a5a82162af.js" defer></script><script src="/_nuxt/7bf7cf72fb874597fcc9.js" defer></script><script src="/_nuxt/cbe174ed2a30e037b060.js" defer></script><script src="/_nuxt/07d85a408eaceac3d30c.js" defer></script><script src="/_nuxt/f51cc84e40c16151e281.js" defer></script>
  </body>
</html>
